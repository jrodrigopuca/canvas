{"version":3,"file":"index.cjs","sources":["../src/core/utils/id.ts","../src/core/utils/classnames.ts","../src/core/utils/deepMerge.ts","../src/core/utils/geometry.ts","../src/core/utils/layers.ts","../src/core/utils/validation.ts","../src/core/utils/serialization.ts","../src/core/context/ThemeContext.tsx","../src/core/context/ViewportContext.tsx","../src/core/context/SelectionContext.tsx","../src/core/context/HistoryContext.tsx","../src/core/context/CanvasContext.tsx","../src/core/context/CombinedCanvasProvider.tsx","../src/core/hooks/useDraggable.ts","../src/core/hooks/useResizable.ts","../src/core/hooks/useRotatable.ts","../src/core/hooks/useSelectable.ts","../src/core/hooks/useKeyboard.ts","../src/core/hooks/useCanvasActions.ts","../src/elements/ElementBase.tsx","../src/elements/withElementBehavior.tsx","../src/elements/shapes/Rectangle.tsx","../src/elements/shapes/Ellipse.tsx","../src/elements/shapes/Diamond.tsx","../src/elements/shapes/TextElement.tsx","../src/elements/LineBase.tsx","../src/elements/shapes/Line.tsx","../src/elements/uml/Actor.tsx","../src/elements/uml/Lifeline.tsx","../src/elements/uml/Message.tsx","../src/elements/uml/ActivationBar.tsx","../src/components/DrawingCanvas.tsx","../src/components/Canvas.tsx","../src/components/ElementFactory.ts"],"sourcesContent":["// ID generation utility\n// Uses crypto.randomUUID() with fallback for older environments\n\nexport const generateId = (): string => {\n\tif (\n\t\ttypeof crypto !== \"undefined\" &&\n\t\ttypeof crypto.randomUUID === \"function\"\n\t) {\n\t\treturn crypto.randomUUID();\n\t}\n\t// Fallback for environments without crypto.randomUUID\n\treturn `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 11)}`;\n};\n","// Classnames utility\n// Simple alternative to clsx/classnames libraries\n\ntype ClassValue =\n\t| string\n\t| number\n\t| boolean\n\t| undefined\n\t| null\n\t| ClassObject\n\t| ClassValue[];\ntype ClassObject = { [key: string]: boolean | undefined | null };\n\nexport const cx = (...args: ClassValue[]): string => {\n\tconst classes: string[] = [];\n\n\tfor (const arg of args) {\n\t\tif (!arg) continue;\n\n\t\tif (typeof arg === \"string\" || typeof arg === \"number\") {\n\t\t\tclasses.push(String(arg));\n\t\t} else if (Array.isArray(arg)) {\n\t\t\tconst inner = cx(...arg);\n\t\t\tif (inner) classes.push(inner);\n\t\t} else if (typeof arg === \"object\") {\n\t\t\tfor (const [key, value] of Object.entries(arg)) {\n\t\t\t\tif (value) classes.push(key);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn classes.join(\" \");\n};\n","// Deep merge utility\n// Used for merging theme objects\n\nexport function deepMerge<T extends object>(target: T, source: Partial<T>): T {\n\tconst output = { ...target };\n\n\tfor (const key in source) {\n\t\tif (Object.prototype.hasOwnProperty.call(source, key)) {\n\t\t\tconst sourceVal = source[key];\n\t\t\tconst targetVal = target[key];\n\n\t\t\tif (\n\t\t\t\tsourceVal !== null &&\n\t\t\t\ttypeof sourceVal === \"object\" &&\n\t\t\t\t!Array.isArray(sourceVal) &&\n\t\t\t\ttargetVal !== null &&\n\t\t\t\ttypeof targetVal === \"object\" &&\n\t\t\t\t!Array.isArray(targetVal)\n\t\t\t) {\n\t\t\t\toutput[key] = deepMerge(\n\t\t\t\t\ttargetVal as object,\n\t\t\t\t\tsourceVal as object,\n\t\t\t\t) as T[typeof key];\n\t\t\t} else if (sourceVal !== undefined) {\n\t\t\t\toutput[key] = sourceVal as T[typeof key];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn output;\n}\n","// Geometry utilities\n// Position and size calculations\n\nimport type { Point, Size, Bounds } from \"@/types/elements\";\n\n/**\n * Calculate distance between two points\n */\nexport const distance = (p1: Point, p2: Point): number => {\n\tconst dx = p2.x - p1.x;\n\tconst dy = p2.y - p1.y;\n\treturn Math.sqrt(dx * dx + dy * dy);\n};\n\n/**\n * Check if a point is inside bounds\n */\nexport const isPointInBounds = (point: Point, bounds: Bounds): boolean => {\n\treturn (\n\t\tpoint.x >= bounds.x &&\n\t\tpoint.x <= bounds.x + bounds.width &&\n\t\tpoint.y >= bounds.y &&\n\t\tpoint.y <= bounds.y + bounds.height\n\t);\n};\n\n/**\n * Check if two bounds intersect\n */\nexport const boundsIntersect = (a: Bounds, b: Bounds): boolean => {\n\treturn !(\n\t\ta.x + a.width < b.x ||\n\t\tb.x + b.width < a.x ||\n\t\ta.y + a.height < b.y ||\n\t\tb.y + b.height < a.y\n\t);\n};\n\n/**\n * Check if bounds A contains bounds B completely\n */\nexport const boundsContain = (\n\tcontainer: Bounds,\n\tcontained: Bounds,\n): boolean => {\n\treturn (\n\t\tcontained.x >= container.x &&\n\t\tcontained.y >= container.y &&\n\t\tcontained.x + contained.width <= container.x + container.width &&\n\t\tcontained.y + contained.height <= container.y + container.height\n\t);\n};\n\n/**\n * Get center point of bounds\n */\nexport const getBoundsCenter = (bounds: Bounds): Point => ({\n\tx: bounds.x + bounds.width / 2,\n\ty: bounds.y + bounds.height / 2,\n});\n\n/**\n * Snap a value to a grid\n */\nexport const snapToGrid = (value: number, gridSize: number): number => {\n\treturn Math.round(value / gridSize) * gridSize;\n};\n\n/**\n * Snap a point to a grid\n */\nexport const snapPointToGrid = (point: Point, gridSize: number): Point => ({\n\tx: snapToGrid(point.x, gridSize),\n\ty: snapToGrid(point.y, gridSize),\n});\n\n/**\n * Get bounding box that contains all given bounds\n */\nexport const getContainingBounds = (boundsArray: Bounds[]): Bounds | null => {\n\tif (boundsArray.length === 0) return null;\n\n\tlet minX = Infinity;\n\tlet minY = Infinity;\n\tlet maxX = -Infinity;\n\tlet maxY = -Infinity;\n\n\tfor (const bounds of boundsArray) {\n\t\tminX = Math.min(minX, bounds.x);\n\t\tminY = Math.min(minY, bounds.y);\n\t\tmaxX = Math.max(maxX, bounds.x + bounds.width);\n\t\tmaxY = Math.max(maxY, bounds.y + bounds.height);\n\t}\n\n\treturn {\n\t\tx: minX,\n\t\ty: minY,\n\t\twidth: maxX - minX,\n\t\theight: maxY - minY,\n\t};\n};\n\n/**\n * Clamp a value between min and max\n */\nexport const clamp = (value: number, min: number, max: number): number => {\n\treturn Math.min(Math.max(value, min), max);\n};\n\n/**\n * Normalize bounds to ensure positive width/height\n */\nexport const normalizeBounds = (bounds: Bounds): Bounds => {\n\tlet { x, y, width, height } = bounds;\n\n\tif (width < 0) {\n\t\tx += width;\n\t\twidth = Math.abs(width);\n\t}\n\n\tif (height < 0) {\n\t\ty += height;\n\t\theight = Math.abs(height);\n\t}\n\n\treturn { x, y, width, height };\n};\n\n/**\n * Resize handle positions\n */\nexport type ResizeHandle = \"nw\" | \"n\" | \"ne\" | \"e\" | \"se\" | \"s\" | \"sw\" | \"w\";\n\n/**\n * Resize handle info\n */\nexport interface ResizeHandleInfo {\n\tposition: ResizeHandle;\n\tx: number;\n\ty: number;\n}\n\n/**\n * Get resize handle positions for a given bounds\n */\nexport const getResizeHandles = (\n\tbounds: Bounds,\n\thandleSize: number,\n): ResizeHandleInfo[] => {\n\tconst { x, y, width, height } = bounds;\n\tconst halfHandle = handleSize / 2;\n\n\treturn [\n\t\t{ position: \"nw\", x: x - halfHandle, y: y - halfHandle },\n\t\t{ position: \"n\", x: x + width / 2 - halfHandle, y: y - halfHandle },\n\t\t{ position: \"ne\", x: x + width - halfHandle, y: y - halfHandle },\n\t\t{\n\t\t\tposition: \"e\",\n\t\t\tx: x + width - halfHandle,\n\t\t\ty: y + height / 2 - halfHandle,\n\t\t},\n\t\t{ position: \"se\", x: x + width - halfHandle, y: y + height - halfHandle },\n\t\t{\n\t\t\tposition: \"s\",\n\t\t\tx: x + width / 2 - halfHandle,\n\t\t\ty: y + height - halfHandle,\n\t\t},\n\t\t{ position: \"sw\", x: x - halfHandle, y: y + height - halfHandle },\n\t\t{ position: \"w\", x: x - halfHandle, y: y + height / 2 - halfHandle },\n\t];\n};\n\n/**\n * Get connection points for element bounds\n */\nexport const getConnectionPoints = (bounds: Bounds): Record<string, Point> => {\n\tconst { x, y, width, height } = bounds;\n\treturn {\n\t\ttop: { x: x + width / 2, y },\n\t\tright: { x: x + width, y: y + height / 2 },\n\t\tbottom: { x: x + width / 2, y: y + height },\n\t\tleft: { x, y: y + height / 2 },\n\t\tcenter: { x: x + width / 2, y: y + height / 2 },\n\t};\n};\n\n/**\n * Calculate midpoint between two points\n */\nexport const midpoint = (p1: Point, p2: Point): Point => ({\n\tx: (p1.x + p2.x) / 2,\n\ty: (p1.y + p2.y) / 2,\n});\n\n/**\n * Normalize angle to 0-360 range\n */\nexport const normalizeAngle = (angle: number): number => {\n\treturn ((angle % 360) + 360) % 360;\n};\n\n/**\n * Rotate a point around an origin\n */\nexport const rotatePoint = (\n\tpoint: Point,\n\torigin: Point,\n\tangleDegrees: number,\n): Point => {\n\tconst angleRad = (angleDegrees * Math.PI) / 180;\n\tconst cos = Math.cos(angleRad);\n\tconst sin = Math.sin(angleRad);\n\tconst dx = point.x - origin.x;\n\tconst dy = point.y - origin.y;\n\n\treturn {\n\t\tx: origin.x + dx * cos - dy * sin,\n\t\ty: origin.y + dx * sin + dy * cos,\n\t};\n};\n","// Layers / Z-index management utilities\n\nimport type { CanvasElement } from \"@/types/elements\";\n\n/**\n * Sort elements by z-index for rendering\n */\nexport const sortByZIndex = (elements: CanvasElement[]): CanvasElement[] => {\n\treturn [...elements].sort((a, b) => a.zIndex - b.zIndex);\n};\n\n/**\n * Get the maximum z-index from elements\n */\nexport const getMaxZIndex = (elements: CanvasElement[]): number => {\n\tif (elements.length === 0) return 0;\n\treturn Math.max(...elements.map((el) => el.zIndex));\n};\n\n/**\n * Get the minimum z-index from elements\n */\nexport const getMinZIndex = (elements: CanvasElement[]): number => {\n\tif (elements.length === 0) return 0;\n\treturn Math.min(...elements.map((el) => el.zIndex));\n};\n\n/**\n * Bring element to front (highest z-index)\n */\nexport const bringToFront = (\n\telements: CanvasElement[],\n\telementId: string,\n): CanvasElement[] => {\n\tconst maxZ = getMaxZIndex(elements);\n\treturn elements.map((el) =>\n\t\tel.id === elementId ? { ...el, zIndex: maxZ + 1 } : el,\n\t);\n};\n\n/**\n * Send element to back (lowest z-index)\n */\nexport const sendToBack = (\n\telements: CanvasElement[],\n\telementId: string,\n): CanvasElement[] => {\n\tconst minZ = getMinZIndex(elements);\n\treturn elements.map((el) =>\n\t\tel.id === elementId ? { ...el, zIndex: minZ - 1 } : el,\n\t);\n};\n\n/**\n * Bring element one step forward\n */\nexport const bringForward = (\n\telements: CanvasElement[],\n\telementId: string,\n): CanvasElement[] => {\n\tconst sorted = sortByZIndex(elements);\n\tconst index = sorted.findIndex((el) => el.id === elementId);\n\n\tif (index === -1 || index === sorted.length - 1) return elements;\n\n\tconst current = sorted[index];\n\tconst above = sorted[index + 1];\n\n\treturn elements.map((el) => {\n\t\tif (el.id === current.id) return { ...el, zIndex: above.zIndex + 1 };\n\t\treturn el;\n\t});\n};\n\n/**\n * Send element one step backward\n */\nexport const sendBackward = (\n\telements: CanvasElement[],\n\telementId: string,\n): CanvasElement[] => {\n\tconst sorted = sortByZIndex(elements);\n\tconst index = sorted.findIndex((el) => el.id === elementId);\n\n\tif (index <= 0) return elements;\n\n\tconst current = sorted[index];\n\tconst below = sorted[index - 1];\n\n\treturn elements.map((el) => {\n\t\tif (el.id === current.id) return { ...el, zIndex: below.zIndex - 1 };\n\t\treturn el;\n\t});\n};\n\n/**\n * Normalize z-indexes to be sequential (0, 1, 2, ...)\n */\nexport const normalizeZIndexes = (\n\telements: CanvasElement[],\n): CanvasElement[] => {\n\tconst sorted = sortByZIndex(elements);\n\tconst idToNewIndex = new Map<string, number>();\n\n\tsorted.forEach((el, index) => {\n\t\tidToNewIndex.set(el.id, index);\n\t});\n\n\treturn elements.map((el) => ({\n\t\t...el,\n\t\tzIndex: idToNewIndex.get(el.id) ?? el.zIndex,\n\t}));\n};\n","// Validation utilities\n// Schema validation for imported data\n\nimport type { CanvasElement, Connection } from \"@/types/elements\";\nimport type { CanvasData } from \"./serialization\";\n\nexport interface ValidationResult {\n\tvalid: boolean;\n\terrors: string[];\n}\n\n/**\n * Validate canvas data structure\n */\nexport const validateCanvasData = (data: unknown): ValidationResult => {\n\tconst errors: string[] = [];\n\n\tif (!data || typeof data !== \"object\") {\n\t\treturn { valid: false, errors: [\"Data must be an object\"] };\n\t}\n\n\tconst obj = data as Record<string, unknown>;\n\n\t// Check version\n\tif (typeof obj.version !== \"string\") {\n\t\terrors.push(\"Missing or invalid version field\");\n\t}\n\n\t// Check elements array\n\tif (!Array.isArray(obj.elements)) {\n\t\terrors.push(\"Elements must be an array\");\n\t} else {\n\t\tobj.elements.forEach((element, index) => {\n\t\t\tconst elementErrors = validateElement(element, index);\n\t\t\terrors.push(...elementErrors);\n\t\t});\n\t}\n\n\t// Check connections array\n\tif (!Array.isArray(obj.connections)) {\n\t\terrors.push(\"Connections must be an array\");\n\t} else {\n\t\tobj.connections.forEach((connection, index) => {\n\t\t\tconst connectionErrors = validateConnection(connection, index);\n\t\t\terrors.push(...connectionErrors);\n\t\t});\n\t}\n\n\treturn {\n\t\tvalid: errors.length === 0,\n\t\terrors,\n\t};\n};\n\n/**\n * Validate a single element\n */\nexport const validateElement = (element: unknown, index: number): string[] => {\n\tconst errors: string[] = [];\n\tconst prefix = `Element[${index}]`;\n\n\tif (!element || typeof element !== \"object\") {\n\t\treturn [`${prefix}: Must be an object`];\n\t}\n\n\tconst el = element as Record<string, unknown>;\n\n\t// Required fields\n\tif (typeof el.id !== \"string\" || el.id.length === 0) {\n\t\terrors.push(`${prefix}: Missing or invalid id`);\n\t}\n\n\tif (typeof el.type !== \"string\" || el.type.length === 0) {\n\t\terrors.push(`${prefix}: Missing or invalid type`);\n\t}\n\n\tif (typeof el.x !== \"number\" || isNaN(el.x)) {\n\t\terrors.push(`${prefix}: Missing or invalid x coordinate`);\n\t}\n\n\tif (typeof el.y !== \"number\" || isNaN(el.y)) {\n\t\terrors.push(`${prefix}: Missing or invalid y coordinate`);\n\t}\n\n\tif (typeof el.width !== \"number\" || isNaN(el.width) || el.width < 0) {\n\t\terrors.push(`${prefix}: Missing or invalid width`);\n\t}\n\n\tif (typeof el.height !== \"number\" || isNaN(el.height) || el.height < 0) {\n\t\terrors.push(`${prefix}: Missing or invalid height`);\n\t}\n\n\tif (typeof el.zIndex !== \"number\" || isNaN(el.zIndex)) {\n\t\terrors.push(`${prefix}: Missing or invalid zIndex`);\n\t}\n\n\treturn errors;\n};\n\n/**\n * Validate a single connection\n */\nexport const validateConnection = (\n\tconnection: unknown,\n\tindex: number,\n): string[] => {\n\tconst errors: string[] = [];\n\tconst prefix = `Connection[${index}]`;\n\n\tif (!connection || typeof connection !== \"object\") {\n\t\treturn [`${prefix}: Must be an object`];\n\t}\n\n\tconst conn = connection as Record<string, unknown>;\n\n\tif (typeof conn.id !== \"string\" || conn.id.length === 0) {\n\t\terrors.push(`${prefix}: Missing or invalid id`);\n\t}\n\n\tif (typeof conn.fromId !== \"string\" || conn.fromId.length === 0) {\n\t\terrors.push(`${prefix}: Missing or invalid fromId`);\n\t}\n\n\tif (typeof conn.toId !== \"string\" || conn.toId.length === 0) {\n\t\terrors.push(`${prefix}: Missing or invalid toId`);\n\t}\n\n\treturn errors;\n};\n\n/**\n * Check if all connection references exist\n */\nexport const validateConnectionReferences = (\n\telements: CanvasElement[],\n\tconnections: Connection[],\n): ValidationResult => {\n\tconst errors: string[] = [];\n\tconst elementIds = new Set(elements.map((el) => el.id));\n\n\tconnections.forEach((conn, index) => {\n\t\tif (!elementIds.has(conn.fromId)) {\n\t\t\terrors.push(\n\t\t\t\t`Connection[${index}]: fromId '${conn.fromId}' does not exist`,\n\t\t\t);\n\t\t}\n\t\tif (!elementIds.has(conn.toId)) {\n\t\t\terrors.push(`Connection[${index}]: toId '${conn.toId}' does not exist`);\n\t\t}\n\t});\n\n\treturn {\n\t\tvalid: errors.length === 0,\n\t\terrors,\n\t};\n};\n","// Serialization utilities\n// JSON import/export for canvas data\n\nimport type { CanvasElement, Connection } from \"@/types/elements\";\nimport { validateCanvasData } from \"./validation\";\n\nexport interface CanvasData {\n\tversion: string;\n\telements: CanvasElement[];\n\tconnections: Connection[];\n\tmetadata?: Record<string, unknown>;\n}\n\nconst CURRENT_VERSION = \"1.0.0\";\n\n/**\n * Serialize canvas data to JSON string\n */\nexport const serializeToJSON = (\n\telements: CanvasElement[],\n\tconnections: Connection[],\n\tmetadata?: Record<string, unknown>,\n): string => {\n\tconst data: CanvasData = {\n\t\tversion: CURRENT_VERSION,\n\t\telements,\n\t\tconnections,\n\t\tmetadata,\n\t};\n\treturn JSON.stringify(data, null, 2);\n};\n\n/**\n * Deserialize JSON string to canvas data\n */\nexport const deserializeFromJSON = (json: string): CanvasData => {\n\tconst data = JSON.parse(json) as CanvasData;\n\n\tconst validation = validateCanvasData(data);\n\tif (!validation.valid) {\n\t\tthrow new Error(`Invalid canvas data: ${validation.errors.join(\", \")}`);\n\t}\n\n\treturn data;\n};\n\n/**\n * Export canvas as SVG string\n */\nexport const exportToSVG = (\n\tsvgElement: SVGSVGElement,\n\toptions?: { includeStyles?: boolean },\n): string => {\n\tconst clone = svgElement.cloneNode(true) as SVGSVGElement;\n\n\t// Add XML namespace if not present\n\tif (!clone.getAttribute(\"xmlns\")) {\n\t\tclone.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n\t}\n\n\t// Optionally include inline styles\n\tif (options?.includeStyles) {\n\t\tconst styles = document.createElement(\"style\");\n\t\tstyles.textContent = getComputedStyles(svgElement);\n\t\tclone.insertBefore(styles, clone.firstChild);\n\t}\n\n\tconst serializer = new XMLSerializer();\n\treturn serializer.serializeToString(clone);\n};\n\n/**\n * Get computed styles from SVG element\n */\nconst getComputedStyles = (svg: SVGSVGElement): string => {\n\t// Get all unique tag names\n\tconst tags = new Set<string>();\n\tsvg.querySelectorAll(\"*\").forEach((el) => tags.add(el.tagName.toLowerCase()));\n\n\t// Basic SVG styles\n\treturn `\n    svg { font-family: system-ui, sans-serif; }\n    text { user-select: none; }\n  `;\n};\n\n/**\n * Download string content as file\n */\nexport const downloadAsFile = (\n\tcontent: string,\n\tfilename: string,\n\tmimeType: string,\n): void => {\n\tconst blob = new Blob([content], { type: mimeType });\n\tconst url = URL.createObjectURL(blob);\n\tconst link = document.createElement(\"a\");\n\tlink.href = url;\n\tlink.download = filename;\n\tdocument.body.appendChild(link);\n\tlink.click();\n\tdocument.body.removeChild(link);\n\tURL.revokeObjectURL(url);\n};\n\nexport type ImageFormat = \"png\" | \"jpeg\";\n\nexport interface ExportImageOptions {\n\t/** Image format: 'png' or 'jpeg' */\n\tformat?: ImageFormat;\n\t/** Quality for JPEG format (0-1), default 0.92 */\n\tquality?: number;\n\t/** Background color (default: transparent for PNG, white for JPEG) */\n\tbackgroundColor?: string;\n\t/** Scale factor for higher resolution (default: 1) */\n\tscale?: number;\n}\n\n/**\n * Export SVG canvas as PNG or JPEG image\n * Returns a Promise with the image as a data URL or Blob\n */\nexport const exportToImage = async (\n\tsvgElement: SVGSVGElement,\n\toptions: ExportImageOptions = {},\n): Promise<Blob> => {\n\tconst {\n\t\tformat = \"png\",\n\t\tquality = 0.92,\n\t\tbackgroundColor,\n\t\tscale = 1,\n\t} = options;\n\n\t// Get SVG dimensions\n\tconst svgRect = svgElement.getBoundingClientRect();\n\tconst width = svgRect.width * scale;\n\tconst height = svgRect.height * scale;\n\n\t// Clone and prepare SVG\n\tconst clone = svgElement.cloneNode(true) as SVGSVGElement;\n\tclone.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n\tclone.setAttribute(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n\n\t// Add inline styles\n\tconst styleEl = document.createElementNS(\n\t\t\"http://www.w3.org/2000/svg\",\n\t\t\"style\",\n\t);\n\tstyleEl.textContent = getComputedStyles(svgElement);\n\tclone.insertBefore(styleEl, clone.firstChild);\n\n\t// Serialize SVG to string\n\tconst serializer = new XMLSerializer();\n\tconst svgString = serializer.serializeToString(clone);\n\n\t// Create a Blob from SVG string\n\tconst svgBlob = new Blob([svgString], {\n\t\ttype: \"image/svg+xml;charset=utf-8\",\n\t});\n\tconst svgUrl = URL.createObjectURL(svgBlob);\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\n\t\timg.onload = () => {\n\t\t\t// Create canvas\n\t\t\tconst canvas = document.createElement(\"canvas\");\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\t\t\tconst ctx = canvas.getContext(\"2d\");\n\n\t\t\tif (!ctx) {\n\t\t\t\tURL.revokeObjectURL(svgUrl);\n\t\t\t\treject(new Error(\"Failed to get canvas context\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Apply background color\n\t\t\tconst bgColor =\n\t\t\t\tbackgroundColor ?? (format === \"jpeg\" ? \"#ffffff\" : \"transparent\");\n\t\t\tif (bgColor !== \"transparent\") {\n\t\t\t\tctx.fillStyle = bgColor;\n\t\t\t\tctx.fillRect(0, 0, width, height);\n\t\t\t}\n\n\t\t\t// Scale and draw image\n\t\t\tctx.scale(scale, scale);\n\t\t\tctx.drawImage(img, 0, 0);\n\n\t\t\t// Convert to blob\n\t\t\tcanvas.toBlob(\n\t\t\t\t(blob) => {\n\t\t\t\t\tURL.revokeObjectURL(svgUrl);\n\t\t\t\t\tif (blob) {\n\t\t\t\t\t\tresolve(blob);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error(\"Failed to create image blob\"));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tformat === \"jpeg\" ? \"image/jpeg\" : \"image/png\",\n\t\t\t\tformat === \"jpeg\" ? quality : undefined,\n\t\t\t);\n\t\t};\n\n\t\timg.onerror = () => {\n\t\t\tURL.revokeObjectURL(svgUrl);\n\t\t\treject(new Error(\"Failed to load SVG as image\"));\n\t\t};\n\n\t\timg.src = svgUrl;\n\t});\n};\n\n/**\n * Download canvas as image file\n */\nexport const downloadAsImage = async (\n\tsvgElement: SVGSVGElement,\n\tfilename: string,\n\toptions: ExportImageOptions = {},\n): Promise<void> => {\n\tconst { format = \"png\" } = options;\n\tconst blob = await exportToImage(svgElement, options);\n\tconst url = URL.createObjectURL(blob);\n\tconst link = document.createElement(\"a\");\n\tlink.href = url;\n\tlink.download = `${filename}.${format}`;\n\tdocument.body.appendChild(link);\n\tlink.click();\n\tdocument.body.removeChild(link);\n\tURL.revokeObjectURL(url);\n};\n","// Theme Context\n// Manages theming (light/dark/custom)\n\nimport React, { createContext, useContext, useMemo } from 'react';\nimport type { Theme } from '@/types/theme';\nimport { deepMerge } from '@/core/utils';\n\n// Default light theme\nexport const lightTheme: Theme = {\n  name: 'light',\n  colors: {\n    background: '#ffffff',\n    surface: '#f8f9fa',\n    border: '#dee2e6',\n    text: {\n      primary: '#212529',\n      secondary: '#6c757d',\n      disabled: '#adb5bd',\n    },\n    selection: {\n      fill: 'rgba(59, 130, 246, 0.1)',\n      stroke: '#3b82f6',\n    },\n    element: {\n      fill: '#ffffff',\n      stroke: '#212529',\n      hover: '#f1f5f9',\n      active: '#e2e8f0',\n    },\n    handle: {\n      fill: '#ffffff',\n      stroke: '#3b82f6',\n    },\n    grid: {\n      line: '#e5e7eb',\n      dot: '#d1d5db',\n    },\n    connection: {\n      line: '#64748b',\n      arrow: '#64748b',\n    },\n  },\n  spacing: {\n    xs: 4,\n    sm: 8,\n    md: 16,\n    lg: 24,\n    xl: 32,\n  },\n  borderRadius: {\n    sm: 2,\n    md: 4,\n    lg: 8,\n  },\n  fontSize: {\n    xs: 10,\n    sm: 12,\n    md: 14,\n    lg: 16,\n    xl: 20,\n  },\n  strokeWidth: {\n    thin: 1,\n    normal: 2,\n    thick: 3,\n  },\n  shadows: {\n    sm: '0 1px 2px rgba(0,0,0,0.05)',\n    md: '0 4px 6px rgba(0,0,0,0.1)',\n    lg: '0 10px 15px rgba(0,0,0,0.1)',\n    element: '0 2px 4px rgba(0,0,0,0.1)',\n    handle: '0 1px 2px rgba(0,0,0,0.1)',\n  },\n};\n\n// Default dark theme\nexport const darkTheme: Theme = {\n  name: 'dark',\n  colors: {\n    background: '#1e1e1e',\n    surface: '#252526',\n    border: '#3c3c3c',\n    text: {\n      primary: '#ffffff',\n      secondary: '#a0a0a0',\n      disabled: '#5a5a5a',\n    },\n    selection: {\n      fill: 'rgba(59, 130, 246, 0.2)',\n      stroke: '#60a5fa',\n    },\n    element: {\n      fill: '#2d2d2d',\n      stroke: '#ffffff',\n      hover: '#383838',\n      active: '#454545',\n    },\n    handle: {\n      fill: '#2d2d2d',\n      stroke: '#60a5fa',\n    },\n    grid: {\n      line: '#333333',\n      dot: '#444444',\n    },\n    connection: {\n      line: '#94a3b8',\n      arrow: '#94a3b8',\n    },\n  },\n  spacing: lightTheme.spacing,\n  borderRadius: lightTheme.borderRadius,\n  fontSize: lightTheme.fontSize,\n  strokeWidth: lightTheme.strokeWidth,\n  shadows: {\n    sm: '0 1px 2px rgba(0,0,0,0.3)',\n    md: '0 4px 6px rgba(0,0,0,0.4)',\n    lg: '0 10px 15px rgba(0,0,0,0.5)',\n    element: '0 2px 4px rgba(0,0,0,0.3)',\n    handle: '0 1px 2px rgba(0,0,0,0.3)',\n  },\n};\n\n// Context value interface\ninterface ThemeContextValue {\n  theme: Theme;\n  themeName: 'light' | 'dark' | 'custom';\n}\n\n// Create context with default light theme\nconst ThemeContext = createContext<ThemeContextValue>({\n  theme: lightTheme,\n  themeName: 'light',\n});\n\n// Hook to use theme\nexport const useTheme = (): ThemeContextValue => {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n};\n\n// Provider props\ninterface ThemeProviderProps {\n  children: React.ReactNode;\n  theme?: 'light' | 'dark' | Theme;\n}\n\n// Theme Provider component\nexport const ThemeProvider: React.FC<ThemeProviderProps> = ({ children, theme = 'light' }) => {\n  const value = useMemo<ThemeContextValue>(() => {\n    if (theme === 'light') {\n      return { theme: lightTheme, themeName: 'light' };\n    }\n    if (theme === 'dark') {\n      return { theme: darkTheme, themeName: 'dark' };\n    }\n    // Custom theme: merge with light theme as base\n    return {\n      theme: deepMerge(lightTheme, theme) as Theme,\n      themeName: 'custom',\n    };\n  }, [theme]);\n\n  return React.createElement(ThemeContext.Provider, { value }, children);\n};\n\n// CSS custom properties generator\nexport const getThemeCSSVariables = (theme: Theme): Record<string, string> => {\n  return {\n    '--canvas-bg': theme.colors.background,\n    '--canvas-surface': theme.colors.surface,\n    '--canvas-border': theme.colors.border,\n    '--canvas-text-primary': theme.colors.text.primary,\n    '--canvas-text-secondary': theme.colors.text.secondary,\n    '--canvas-text-disabled': theme.colors.text.disabled,\n    '--canvas-selection-fill': theme.colors.selection.fill,\n    '--canvas-selection-stroke': theme.colors.selection.stroke,\n    '--canvas-element-fill': theme.colors.element.fill,\n    '--canvas-element-stroke': theme.colors.element.stroke,\n    '--canvas-element-hover': theme.colors.element.hover,\n    '--canvas-element-active': theme.colors.element.active,\n    '--canvas-handle-fill': theme.colors.handle.fill,\n    '--canvas-handle-stroke': theme.colors.handle.stroke,\n    '--canvas-grid-line': theme.colors.grid.line,\n    '--canvas-grid-dot': theme.colors.grid.dot,\n    '--canvas-connection-line': theme.colors.connection.line,\n    '--canvas-connection-arrow': theme.colors.connection.arrow,\n    '--canvas-spacing-xs': `${theme.spacing.xs}px`,\n    '--canvas-spacing-sm': `${theme.spacing.sm}px`,\n    '--canvas-spacing-md': `${theme.spacing.md}px`,\n    '--canvas-spacing-lg': `${theme.spacing.lg}px`,\n    '--canvas-spacing-xl': `${theme.spacing.xl}px`,\n    '--canvas-radius-sm': `${theme.borderRadius.sm}px`,\n    '--canvas-radius-md': `${theme.borderRadius.md}px`,\n    '--canvas-radius-lg': `${theme.borderRadius.lg}px`,\n    '--canvas-font-xs': `${theme.fontSize.xs}px`,\n    '--canvas-font-sm': `${theme.fontSize.sm}px`,\n    '--canvas-font-md': `${theme.fontSize.md}px`,\n    '--canvas-font-lg': `${theme.fontSize.lg}px`,\n    '--canvas-font-xl': `${theme.fontSize.xl}px`,\n    '--canvas-stroke-thin': `${theme.strokeWidth.thin}px`,\n    '--canvas-stroke-normal': `${theme.strokeWidth.normal}px`,\n    '--canvas-stroke-thick': `${theme.strokeWidth.thick}px`,\n    '--canvas-shadow-sm': theme.shadows.sm,\n    '--canvas-shadow-md': theme.shadows.md,\n    '--canvas-shadow-lg': theme.shadows.lg,\n    '--canvas-shadow-element': theme.shadows.element,\n    '--canvas-shadow-handle': theme.shadows.handle,\n  };\n};\n\nexport { ThemeContext };\n","// Viewport Context\n// Manages zoom, pan, and coordinate transformations\n\nimport React, { createContext, useContext, useReducer, useCallback, useMemo } from 'react';\nimport type { Point, Bounds } from '@/types/elements';\nimport type { ViewportState } from '@/types/canvas';\n\n// Default viewport state\nconst defaultViewport: ViewportState = {\n  zoom: 1,\n  pan: { x: 0, y: 0 },\n  minZoom: 0.1,\n  maxZoom: 5,\n};\n\n// Action types\ntype ViewportAction =\n  | { type: 'SET_ZOOM'; payload: number }\n  | { type: 'ZOOM_IN' }\n  | { type: 'ZOOM_OUT' }\n  | { type: 'ZOOM_TO_FIT'; payload: { bounds: Bounds; padding?: number } }\n  | { type: 'SET_PAN'; payload: Point }\n  | { type: 'PAN_BY'; payload: Point }\n  | { type: 'RESET' }\n  | { type: 'SET_CONSTRAINTS'; payload: { minZoom?: number; maxZoom?: number } };\n\n// Reducer\nconst viewportReducer = (state: ViewportState, action: ViewportAction): ViewportState => {\n  switch (action.type) {\n    case 'SET_ZOOM': {\n      const zoom = Math.max(state.minZoom, Math.min(state.maxZoom, action.payload));\n      return { ...state, zoom };\n    }\n\n    case 'ZOOM_IN': {\n      const zoom = Math.min(state.maxZoom, state.zoom * 1.2);\n      return { ...state, zoom };\n    }\n\n    case 'ZOOM_OUT': {\n      const zoom = Math.max(state.minZoom, state.zoom / 1.2);\n      return { ...state, zoom };\n    }\n\n    case 'ZOOM_TO_FIT': {\n      const { bounds, padding = 50 } = action.payload;\n      // Calculate zoom to fit bounds with padding (using x, y, width, height format)\n      const zoom = Math.max(state.minZoom, Math.min(state.maxZoom, 1));\n      const pan = {\n        x: -(bounds.x - padding),\n        y: -(bounds.y - padding),\n      };\n      return { ...state, zoom, pan };\n    }\n\n    case 'SET_PAN':\n      return { ...state, pan: action.payload };\n\n    case 'PAN_BY':\n      return {\n        ...state,\n        pan: {\n          x: state.pan.x + action.payload.x,\n          y: state.pan.y + action.payload.y,\n        },\n      };\n\n    case 'RESET':\n      return { ...defaultViewport, minZoom: state.minZoom, maxZoom: state.maxZoom };\n\n    case 'SET_CONSTRAINTS':\n      return {\n        ...state,\n        minZoom: action.payload.minZoom ?? state.minZoom,\n        maxZoom: action.payload.maxZoom ?? state.maxZoom,\n      };\n\n    default:\n      return state;\n  }\n};\n\n// Context value interface\ninterface ViewportContextValue {\n  // State\n  viewport: ViewportState;\n\n  // Actions\n  setZoom: (zoom: number) => void;\n  zoomIn: () => void;\n  zoomOut: () => void;\n  zoomToFit: (bounds: Bounds, padding?: number) => void;\n  setPan: (pan: Point) => void;\n  panBy: (delta: Point) => void;\n  resetViewport: () => void;\n  setConstraints: (constraints: { minZoom?: number; maxZoom?: number }) => void;\n\n  // Coordinate transformations\n  screenToCanvas: (point: Point) => Point;\n  canvasToScreen: (point: Point) => Point;\n}\n\n// Create context\nconst ViewportContext = createContext<ViewportContextValue | null>(null);\n\n// Hook to use viewport\nexport const useViewport = (): ViewportContextValue => {\n  const context = useContext(ViewportContext);\n  if (!context) {\n    throw new Error('useViewport must be used within a ViewportProvider');\n  }\n  return context;\n};\n\n// Provider props\ninterface ViewportProviderProps {\n  children: React.ReactNode;\n  initialViewport?: Partial<ViewportState>;\n}\n\n// Viewport Provider component\nexport const ViewportProvider: React.FC<ViewportProviderProps> = ({\n  children,\n  initialViewport,\n}) => {\n  const [viewport, dispatch] = useReducer(viewportReducer, {\n    ...defaultViewport,\n    ...initialViewport,\n  });\n\n  // Actions\n  const setZoom = useCallback((zoom: number) => {\n    dispatch({ type: 'SET_ZOOM', payload: zoom });\n  }, []);\n\n  const zoomIn = useCallback(() => {\n    dispatch({ type: 'ZOOM_IN' });\n  }, []);\n\n  const zoomOut = useCallback(() => {\n    dispatch({ type: 'ZOOM_OUT' });\n  }, []);\n\n  const zoomToFit = useCallback((bounds: Bounds, padding?: number) => {\n    dispatch({ type: 'ZOOM_TO_FIT', payload: { bounds, padding } });\n  }, []);\n\n  const setPan = useCallback((pan: Point) => {\n    dispatch({ type: 'SET_PAN', payload: pan });\n  }, []);\n\n  const panBy = useCallback((delta: Point) => {\n    dispatch({ type: 'PAN_BY', payload: delta });\n  }, []);\n\n  const resetViewport = useCallback(() => {\n    dispatch({ type: 'RESET' });\n  }, []);\n\n  const setConstraints = useCallback(\n    (constraints: { minZoom?: number; maxZoom?: number }) => {\n      dispatch({ type: 'SET_CONSTRAINTS', payload: constraints });\n    },\n    []\n  );\n\n  // Coordinate transformations\n  const screenToCanvas = useCallback(\n    (point: Point): Point => {\n      return {\n        x: (point.x - viewport.pan.x) / viewport.zoom,\n        y: (point.y - viewport.pan.y) / viewport.zoom,\n      };\n    },\n    [viewport.zoom, viewport.pan]\n  );\n\n  const canvasToScreen = useCallback(\n    (point: Point): Point => {\n      return {\n        x: point.x * viewport.zoom + viewport.pan.x,\n        y: point.y * viewport.zoom + viewport.pan.y,\n      };\n    },\n    [viewport.zoom, viewport.pan]\n  );\n\n  const value = useMemo<ViewportContextValue>(\n    () => ({\n      viewport,\n      setZoom,\n      zoomIn,\n      zoomOut,\n      zoomToFit,\n      setPan,\n      panBy,\n      resetViewport,\n      setConstraints,\n      screenToCanvas,\n      canvasToScreen,\n    }),\n    [\n      viewport,\n      setZoom,\n      zoomIn,\n      zoomOut,\n      zoomToFit,\n      setPan,\n      panBy,\n      resetViewport,\n      setConstraints,\n      screenToCanvas,\n      canvasToScreen,\n    ]\n  );\n\n  return React.createElement(ViewportContext.Provider, { value }, children);\n};\n\nexport { ViewportContext };\n","// Selection Context\n// Manages element selection state (single and multi-select)\n\nimport React, { createContext, useContext, useReducer, useCallback, useMemo } from 'react';\n\n// Selection state\ninterface SelectionState {\n  selectedIds: Set<string>;\n  lastSelectedId: string | null;\n}\n\n// Default state\nconst defaultSelection: SelectionState = {\n  selectedIds: new Set(),\n  lastSelectedId: null,\n};\n\n// Action types\ntype SelectionAction =\n  | { type: 'SELECT'; payload: string }\n  | { type: 'SELECT_MULTIPLE'; payload: string[] }\n  | { type: 'ADD_TO_SELECTION'; payload: string }\n  | { type: 'REMOVE_FROM_SELECTION'; payload: string }\n  | { type: 'TOGGLE_SELECTION'; payload: string }\n  | { type: 'CLEAR_SELECTION' }\n  | { type: 'SELECT_ALL'; payload: string[] };\n\n// Reducer\nconst selectionReducer = (state: SelectionState, action: SelectionAction): SelectionState => {\n  switch (action.type) {\n    case 'SELECT':\n      return {\n        selectedIds: new Set([action.payload]),\n        lastSelectedId: action.payload,\n      };\n\n    case 'SELECT_MULTIPLE':\n      return {\n        selectedIds: new Set(action.payload),\n        lastSelectedId: action.payload.length > 0 ? action.payload[action.payload.length - 1] : null,\n      };\n\n    case 'ADD_TO_SELECTION': {\n      const newSet = new Set(state.selectedIds);\n      newSet.add(action.payload);\n      return {\n        selectedIds: newSet,\n        lastSelectedId: action.payload,\n      };\n    }\n\n    case 'REMOVE_FROM_SELECTION': {\n      const newSet = new Set(state.selectedIds);\n      newSet.delete(action.payload);\n      return {\n        selectedIds: newSet,\n        lastSelectedId: newSet.size > 0 ? Array.from(newSet).pop()! : null,\n      };\n    }\n\n    case 'TOGGLE_SELECTION': {\n      const newSet = new Set(state.selectedIds);\n      if (newSet.has(action.payload)) {\n        newSet.delete(action.payload);\n        return {\n          selectedIds: newSet,\n          lastSelectedId: newSet.size > 0 ? Array.from(newSet).pop()! : null,\n        };\n      } else {\n        newSet.add(action.payload);\n        return {\n          selectedIds: newSet,\n          lastSelectedId: action.payload,\n        };\n      }\n    }\n\n    case 'CLEAR_SELECTION':\n      return defaultSelection;\n\n    case 'SELECT_ALL':\n      return {\n        selectedIds: new Set(action.payload),\n        lastSelectedId: action.payload.length > 0 ? action.payload[action.payload.length - 1] : null,\n      };\n\n    default:\n      return state;\n  }\n};\n\n// Context value interface\ninterface SelectionContextValue {\n  // State\n  selectedIds: string[];\n  lastSelectedId: string | null;\n  selectionCount: number;\n  hasSelection: boolean;\n\n  // Queries\n  isSelected: (id: string) => boolean;\n\n  // Actions\n  select: (id: string) => void;\n  selectMultiple: (ids: string[]) => void;\n  addToSelection: (id: string) => void;\n  removeFromSelection: (id: string) => void;\n  toggleSelection: (id: string) => void;\n  clearSelection: () => void;\n  selectAll: (ids: string[]) => void;\n}\n\n// Create context\nconst SelectionContext = createContext<SelectionContextValue | null>(null);\n\n// Hook to use selection\nexport const useSelection = (): SelectionContextValue => {\n  const context = useContext(SelectionContext);\n  if (!context) {\n    throw new Error('useSelection must be used within a SelectionProvider');\n  }\n  return context;\n};\n\n// Provider props\ninterface SelectionProviderProps {\n  children: React.ReactNode;\n  initialSelection?: string[];\n  onSelectionChange?: (selectedIds: string[]) => void;\n}\n\n// Selection Provider component\nexport const SelectionProvider: React.FC<SelectionProviderProps> = ({\n  children,\n  initialSelection,\n  onSelectionChange,\n}) => {\n  const [state, dispatch] = useReducer(selectionReducer, {\n    selectedIds: new Set(initialSelection ?? []),\n    lastSelectedId: initialSelection?.[initialSelection.length - 1] ?? null,\n  });\n\n  // Notify on selection change\n  const selectedIdsArray = useMemo(() => Array.from(state.selectedIds), [state.selectedIds]);\n\n  React.useEffect(() => {\n    onSelectionChange?.(selectedIdsArray);\n  }, [selectedIdsArray, onSelectionChange]);\n\n  // Queries\n  const isSelected = useCallback(\n    (id: string): boolean => {\n      return state.selectedIds.has(id);\n    },\n    [state.selectedIds]\n  );\n\n  // Actions\n  const select = useCallback((id: string) => {\n    dispatch({ type: 'SELECT', payload: id });\n  }, []);\n\n  const selectMultiple = useCallback((ids: string[]) => {\n    dispatch({ type: 'SELECT_MULTIPLE', payload: ids });\n  }, []);\n\n  const addToSelection = useCallback((id: string) => {\n    dispatch({ type: 'ADD_TO_SELECTION', payload: id });\n  }, []);\n\n  const removeFromSelection = useCallback((id: string) => {\n    dispatch({ type: 'REMOVE_FROM_SELECTION', payload: id });\n  }, []);\n\n  const toggleSelection = useCallback((id: string) => {\n    dispatch({ type: 'TOGGLE_SELECTION', payload: id });\n  }, []);\n\n  const clearSelection = useCallback(() => {\n    dispatch({ type: 'CLEAR_SELECTION' });\n  }, []);\n\n  const selectAll = useCallback((ids: string[]) => {\n    dispatch({ type: 'SELECT_ALL', payload: ids });\n  }, []);\n\n  const value = useMemo<SelectionContextValue>(\n    () => ({\n      selectedIds: selectedIdsArray,\n      lastSelectedId: state.lastSelectedId,\n      selectionCount: state.selectedIds.size,\n      hasSelection: state.selectedIds.size > 0,\n      isSelected,\n      select,\n      selectMultiple,\n      addToSelection,\n      removeFromSelection,\n      toggleSelection,\n      clearSelection,\n      selectAll,\n    }),\n    [\n      selectedIdsArray,\n      state.lastSelectedId,\n      state.selectedIds.size,\n      isSelected,\n      select,\n      selectMultiple,\n      addToSelection,\n      removeFromSelection,\n      toggleSelection,\n      clearSelection,\n      selectAll,\n    ]\n  );\n\n  return React.createElement(SelectionContext.Provider, { value }, children);\n};\n\nexport { SelectionContext };\n","// History Context\n// Manages undo/redo history stack\n\nimport React, { createContext, useContext, useReducer, useCallback, useMemo } from 'react';\nimport type { CanvasElement, Connection } from '@/types/elements';\n\n// A snapshot of canvas state\nexport interface CanvasSnapshot {\n  elements: CanvasElement[];\n  connections: Connection[];\n  timestamp: number;\n}\n\n// History state\ninterface HistoryState {\n  past: CanvasSnapshot[];\n  present: CanvasSnapshot;\n  future: CanvasSnapshot[];\n  maxHistorySize: number;\n}\n\n// Action types\ntype HistoryAction =\n  | { type: 'PUSH'; payload: CanvasSnapshot }\n  | { type: 'UNDO' }\n  | { type: 'REDO' }\n  | { type: 'CLEAR' }\n  | { type: 'SET_PRESENT'; payload: CanvasSnapshot }\n  | { type: 'SET_MAX_SIZE'; payload: number };\n\n// Create initial snapshot\nconst createEmptySnapshot = (): CanvasSnapshot => ({\n  elements: [],\n  connections: [],\n  timestamp: Date.now(),\n});\n\n// Reducer\nconst historyReducer = (state: HistoryState, action: HistoryAction): HistoryState => {\n  switch (action.type) {\n    case 'PUSH': {\n      const newPast = [...state.past, state.present];\n      // Limit history size\n      if (newPast.length > state.maxHistorySize) {\n        newPast.shift();\n      }\n      return {\n        ...state,\n        past: newPast,\n        present: action.payload,\n        future: [], // Clear future on new action\n      };\n    }\n\n    case 'UNDO': {\n      if (state.past.length === 0) return state;\n      const previous = state.past[state.past.length - 1];\n      const newPast = state.past.slice(0, -1);\n      return {\n        ...state,\n        past: newPast,\n        present: previous,\n        future: [state.present, ...state.future],\n      };\n    }\n\n    case 'REDO': {\n      if (state.future.length === 0) return state;\n      const next = state.future[0];\n      const newFuture = state.future.slice(1);\n      return {\n        ...state,\n        past: [...state.past, state.present],\n        present: next,\n        future: newFuture,\n      };\n    }\n\n    case 'CLEAR':\n      return {\n        ...state,\n        past: [],\n        present: state.present,\n        future: [],\n      };\n\n    case 'SET_PRESENT':\n      return {\n        ...state,\n        present: action.payload,\n      };\n\n    case 'SET_MAX_SIZE':\n      return {\n        ...state,\n        maxHistorySize: action.payload,\n      };\n\n    default:\n      return state;\n  }\n};\n\n// Context value interface\ninterface HistoryContextValue {\n  // State\n  canUndo: boolean;\n  canRedo: boolean;\n  historySize: number;\n  futureSize: number;\n  present: CanvasSnapshot;\n\n  // Actions\n  pushState: (elements: CanvasElement[], connections: Connection[]) => void;\n  undo: () => void;\n  redo: () => void;\n  clearHistory: () => void;\n  setPresent: (elements: CanvasElement[], connections: Connection[]) => void;\n  setMaxHistorySize: (size: number) => void;\n}\n\n// Create context\nconst HistoryContext = createContext<HistoryContextValue | null>(null);\n\n// Hook to use history\nexport const useHistory = (): HistoryContextValue => {\n  const context = useContext(HistoryContext);\n  if (!context) {\n    throw new Error('useHistory must be used within a HistoryProvider');\n  }\n  return context;\n};\n\n// Provider props\ninterface HistoryProviderProps {\n  children: React.ReactNode;\n  initialElements?: CanvasElement[];\n  initialConnections?: Connection[];\n  maxHistorySize?: number;\n  onStateChange?: (elements: CanvasElement[], connections: Connection[]) => void;\n}\n\n// History Provider component\nexport const HistoryProvider: React.FC<HistoryProviderProps> = ({\n  children,\n  initialElements = [],\n  initialConnections = [],\n  maxHistorySize = 50,\n  onStateChange,\n}) => {\n  const [state, dispatch] = useReducer(historyReducer, {\n    past: [],\n    present: {\n      elements: initialElements,\n      connections: initialConnections,\n      timestamp: Date.now(),\n    },\n    future: [],\n    maxHistorySize,\n  });\n\n  // Notify on state change\n  React.useEffect(() => {\n    onStateChange?.(state.present.elements, state.present.connections);\n  }, [state.present, onStateChange]);\n\n  // Actions\n  const pushState = useCallback((elements: CanvasElement[], connections: Connection[]) => {\n    dispatch({\n      type: 'PUSH',\n      payload: {\n        elements,\n        connections,\n        timestamp: Date.now(),\n      },\n    });\n  }, []);\n\n  const undo = useCallback(() => {\n    dispatch({ type: 'UNDO' });\n  }, []);\n\n  const redo = useCallback(() => {\n    dispatch({ type: 'REDO' });\n  }, []);\n\n  const clearHistory = useCallback(() => {\n    dispatch({ type: 'CLEAR' });\n  }, []);\n\n  const setPresent = useCallback((elements: CanvasElement[], connections: Connection[]) => {\n    dispatch({\n      type: 'SET_PRESENT',\n      payload: {\n        elements,\n        connections,\n        timestamp: Date.now(),\n      },\n    });\n  }, []);\n\n  const setMaxHistorySize = useCallback((size: number) => {\n    dispatch({ type: 'SET_MAX_SIZE', payload: size });\n  }, []);\n\n  const value = useMemo<HistoryContextValue>(\n    () => ({\n      canUndo: state.past.length > 0,\n      canRedo: state.future.length > 0,\n      historySize: state.past.length,\n      futureSize: state.future.length,\n      present: state.present,\n      pushState,\n      undo,\n      redo,\n      clearHistory,\n      setPresent,\n      setMaxHistorySize,\n    }),\n    [state.past.length, state.future.length, state.present, pushState, undo, redo, clearHistory, setPresent, setMaxHistorySize]\n  );\n\n  return React.createElement(HistoryContext.Provider, { value }, children);\n};\n\nexport { HistoryContext };\n","// Canvas Context\n// Manages canvas elements and connections state\n\nimport React, { createContext, useContext, useReducer, useCallback, useMemo } from 'react';\nimport type { CanvasElement, Connection, ElementType } from '@/types/elements';\nimport type { CanvasConfig } from '@/types/canvas';\nimport { generateId, bringToFront, sendToBack, bringForward, sendBackward } from '@/core/utils';\n\n// Canvas state\ninterface CanvasState {\n  elements: CanvasElement[];\n  connections: Connection[];\n  config: CanvasConfig;\n}\n\n// Default config\nconst defaultConfig: CanvasConfig = {\n  width: 800,\n  height: 600,\n  grid: {\n    enabled: false,\n    size: 20,\n    snap: false,\n    visible: false,\n  },\n  readonly: false,\n};\n\n// Action types\ntype CanvasAction =\n  // Element actions\n  | { type: 'ADD_ELEMENT'; payload: CanvasElement }\n  | { type: 'ADD_ELEMENTS'; payload: CanvasElement[] }\n  | { type: 'UPDATE_ELEMENT'; payload: { id: string; updates: Partial<CanvasElement> } }\n  | { type: 'UPDATE_ELEMENTS'; payload: { ids: string[]; updates: Partial<CanvasElement> } }\n  | { type: 'REMOVE_ELEMENT'; payload: string }\n  | { type: 'REMOVE_ELEMENTS'; payload: string[] }\n  | { type: 'MOVE_ELEMENT'; payload: { id: string; x: number; y: number } }\n  | { type: 'MOVE_ELEMENTS'; payload: { ids: string[]; deltaX: number; deltaY: number } }\n  | { type: 'RESIZE_ELEMENT'; payload: { id: string; width: number; height: number; x?: number; y?: number } }\n  | { type: 'BRING_TO_FRONT'; payload: string }\n  | { type: 'SEND_TO_BACK'; payload: string }\n  | { type: 'MOVE_UP'; payload: string }\n  | { type: 'MOVE_DOWN'; payload: string }\n  | { type: 'SET_ELEMENTS'; payload: CanvasElement[] }\n  // Connection actions\n  | { type: 'ADD_CONNECTION'; payload: Connection }\n  | { type: 'UPDATE_CONNECTION'; payload: { id: string; updates: Partial<Connection> } }\n  | { type: 'REMOVE_CONNECTION'; payload: string }\n  | { type: 'SET_CONNECTIONS'; payload: Connection[] }\n  // Config actions\n  | { type: 'UPDATE_CONFIG'; payload: Partial<CanvasConfig> }\n  // Bulk actions\n  | { type: 'CLEAR_CANVAS' }\n  | { type: 'LOAD_STATE'; payload: { elements: CanvasElement[]; connections: Connection[] } };\n\n// Reducer\nconst canvasReducer = (state: CanvasState, action: CanvasAction): CanvasState => {\n  switch (action.type) {\n    // Element actions\n    case 'ADD_ELEMENT':\n      return {\n        ...state,\n        elements: [...state.elements, action.payload],\n      };\n\n    case 'ADD_ELEMENTS':\n      return {\n        ...state,\n        elements: [...state.elements, ...action.payload],\n      };\n\n    case 'UPDATE_ELEMENT':\n      return {\n        ...state,\n        elements: state.elements.map((el) =>\n          el.id === action.payload.id ? { ...el, ...action.payload.updates } : el\n        ),\n      };\n\n    case 'UPDATE_ELEMENTS':\n      return {\n        ...state,\n        elements: state.elements.map((el) =>\n          action.payload.ids.includes(el.id) ? { ...el, ...action.payload.updates } : el\n        ),\n      };\n\n    case 'REMOVE_ELEMENT': {\n      const elementId = action.payload;\n      return {\n        ...state,\n        elements: state.elements.filter((el) => el.id !== elementId),\n        // Also remove connections involving this element\n        connections: state.connections.filter(\n          (conn) => conn.fromId !== elementId && conn.toId !== elementId\n        ),\n      };\n    }\n\n    case 'REMOVE_ELEMENTS': {\n      const idsToRemove = new Set(action.payload);\n      return {\n        ...state,\n        elements: state.elements.filter((el) => !idsToRemove.has(el.id)),\n        connections: state.connections.filter(\n          (conn) => !idsToRemove.has(conn.fromId) && !idsToRemove.has(conn.toId)\n        ),\n      };\n    }\n\n    case 'MOVE_ELEMENT':\n      return {\n        ...state,\n        elements: state.elements.map((el) =>\n          el.id === action.payload.id\n            ? { ...el, x: action.payload.x, y: action.payload.y }\n            : el\n        ),\n      };\n\n    case 'MOVE_ELEMENTS':\n      return {\n        ...state,\n        elements: state.elements.map((el) =>\n          action.payload.ids.includes(el.id)\n            ? { ...el, x: el.x + action.payload.deltaX, y: el.y + action.payload.deltaY }\n            : el\n        ),\n      };\n\n    case 'RESIZE_ELEMENT':\n      return {\n        ...state,\n        elements: state.elements.map((el) =>\n          el.id === action.payload.id\n            ? {\n                ...el,\n                width: action.payload.width,\n                height: action.payload.height,\n                ...(action.payload.x !== undefined && { x: action.payload.x }),\n                ...(action.payload.y !== undefined && { y: action.payload.y }),\n              }\n            : el\n        ),\n      };\n\n    case 'BRING_TO_FRONT':\n      return {\n        ...state,\n        elements: bringToFront(state.elements, action.payload),\n      };\n\n    case 'SEND_TO_BACK':\n      return {\n        ...state,\n        elements: sendToBack(state.elements, action.payload),\n      };\n\n    case 'MOVE_UP':\n      return {\n        ...state,\n        elements: bringForward(state.elements, action.payload),\n      };\n\n    case 'MOVE_DOWN':\n      return {\n        ...state,\n        elements: sendBackward(state.elements, action.payload),\n      };\n\n    case 'SET_ELEMENTS':\n      return {\n        ...state,\n        elements: action.payload,\n      };\n\n    // Connection actions\n    case 'ADD_CONNECTION':\n      return {\n        ...state,\n        connections: [...state.connections, action.payload],\n      };\n\n    case 'UPDATE_CONNECTION':\n      return {\n        ...state,\n        connections: state.connections.map((conn) =>\n          conn.id === action.payload.id ? { ...conn, ...action.payload.updates } : conn\n        ),\n      };\n\n    case 'REMOVE_CONNECTION':\n      return {\n        ...state,\n        connections: state.connections.filter((conn) => conn.id !== action.payload),\n      };\n\n    case 'SET_CONNECTIONS':\n      return {\n        ...state,\n        connections: action.payload,\n      };\n\n    // Config actions\n    case 'UPDATE_CONFIG':\n      return {\n        ...state,\n        config: { ...state.config, ...action.payload },\n      };\n\n    // Bulk actions\n    case 'CLEAR_CANVAS':\n      return {\n        ...state,\n        elements: [],\n        connections: [],\n      };\n\n    case 'LOAD_STATE':\n      return {\n        ...state,\n        elements: action.payload.elements,\n        connections: action.payload.connections,\n      };\n\n    default:\n      return state;\n  }\n};\n\n// Context value interface\ninterface CanvasContextValue {\n  // State\n  elements: CanvasElement[];\n  connections: Connection[];\n  config: CanvasConfig;\n\n  // Element queries\n  getElementById: (id: string) => CanvasElement | undefined;\n  getElementsByType: (type: ElementType) => CanvasElement[];\n\n  // Element actions\n  addElement: (element: Omit<CanvasElement, 'id'> & { id?: string }) => string;\n  addElements: (elements: Array<Omit<CanvasElement, 'id'> & { id?: string }>) => string[];\n  updateElement: (id: string, updates: Partial<CanvasElement>) => void;\n  updateElements: (ids: string[], updates: Partial<CanvasElement>) => void;\n  removeElement: (id: string) => void;\n  removeElements: (ids: string[]) => void;\n  moveElement: (id: string, x: number, y: number) => void;\n  moveElements: (ids: string[], deltaX: number, deltaY: number) => void;\n  resizeElement: (id: string, width: number, height: number, x?: number, y?: number) => void;\n  bringToFront: (id: string) => void;\n  sendToBack: (id: string) => void;\n  moveUp: (id: string) => void;\n  moveDown: (id: string) => void;\n  setElements: (elements: CanvasElement[]) => void;\n\n  // Connection queries\n  getConnectionById: (id: string) => Connection | undefined;\n  getConnectionsForElement: (elementId: string) => Connection[];\n\n  // Connection actions\n  addConnection: (connection: Omit<Connection, 'id'> & { id?: string }) => string;\n  updateConnection: (id: string, updates: Partial<Connection>) => void;\n  removeConnection: (id: string) => void;\n  setConnections: (connections: Connection[]) => void;\n\n  // Config actions\n  updateConfig: (config: Partial<CanvasConfig>) => void;\n\n  // Bulk actions\n  clearCanvas: () => void;\n  loadState: (elements: CanvasElement[], connections: Connection[]) => void;\n}\n\n// Create context\nconst CanvasContext = createContext<CanvasContextValue | null>(null);\n\n// Hook to use canvas\nexport const useCanvas = (): CanvasContextValue => {\n  const context = useContext(CanvasContext);\n  if (!context) {\n    throw new Error('useCanvas must be used within a CanvasProvider');\n  }\n  return context;\n};\n\n// Provider props\ninterface CanvasProviderProps {\n  children: React.ReactNode;\n  initialElements?: CanvasElement[];\n  initialConnections?: Connection[];\n  config?: Partial<CanvasConfig>;\n  onChange?: (elements: CanvasElement[], connections: Connection[]) => void;\n}\n\n// Canvas Provider component\nexport const CanvasProvider: React.FC<CanvasProviderProps> = ({\n  children,\n  initialElements = [],\n  initialConnections = [],\n  config: initialConfig,\n  onChange,\n}) => {\n  const [state, dispatch] = useReducer(canvasReducer, {\n    elements: initialElements,\n    connections: initialConnections,\n    config: { ...defaultConfig, ...initialConfig },\n  });\n\n  // Notify on change\n  React.useEffect(() => {\n    onChange?.(state.elements, state.connections);\n  }, [state.elements, state.connections, onChange]);\n\n  // Element queries\n  const getElementById = useCallback(\n    (id: string) => state.elements.find((el) => el.id === id),\n    [state.elements]\n  );\n\n  const getElementsByType = useCallback(\n    (type: ElementType) => state.elements.filter((el) => el.type === type),\n    [state.elements]\n  );\n\n  // Element actions\n  const addElement = useCallback(\n    (element: Omit<CanvasElement, 'id'> & { id?: string }): string => {\n      const id = element.id ?? generateId();\n      const maxZIndex = state.elements.length > 0\n        ? Math.max(...state.elements.map((el) => el.zIndex))\n        : 0;\n      dispatch({\n        type: 'ADD_ELEMENT',\n        payload: { ...element, id, zIndex: element.zIndex ?? maxZIndex + 1 } as CanvasElement,\n      });\n      return id;\n    },\n    [state.elements]\n  );\n\n  const addElements = useCallback(\n    (elements: Array<Omit<CanvasElement, 'id'> & { id?: string }>): string[] => {\n      const maxZIndex = state.elements.length > 0\n        ? Math.max(...state.elements.map((el) => el.zIndex))\n        : 0;\n      const newElements = elements.map((el, i) => ({\n        ...el,\n        id: el.id ?? generateId(),\n        zIndex: el.zIndex ?? maxZIndex + 1 + i,\n      })) as CanvasElement[];\n      dispatch({ type: 'ADD_ELEMENTS', payload: newElements });\n      return newElements.map((el) => el.id);\n    },\n    [state.elements]\n  );\n\n  const updateElement = useCallback((id: string, updates: Partial<CanvasElement>) => {\n    dispatch({ type: 'UPDATE_ELEMENT', payload: { id, updates } });\n  }, []);\n\n  const updateElements = useCallback((ids: string[], updates: Partial<CanvasElement>) => {\n    dispatch({ type: 'UPDATE_ELEMENTS', payload: { ids, updates } });\n  }, []);\n\n  const removeElement = useCallback((id: string) => {\n    dispatch({ type: 'REMOVE_ELEMENT', payload: id });\n  }, []);\n\n  const removeElements = useCallback((ids: string[]) => {\n    dispatch({ type: 'REMOVE_ELEMENTS', payload: ids });\n  }, []);\n\n  const moveElement = useCallback((id: string, x: number, y: number) => {\n    dispatch({ type: 'MOVE_ELEMENT', payload: { id, x, y } });\n  }, []);\n\n  const moveElements = useCallback((ids: string[], deltaX: number, deltaY: number) => {\n    dispatch({ type: 'MOVE_ELEMENTS', payload: { ids, deltaX, deltaY } });\n  }, []);\n\n  const resizeElement = useCallback(\n    (id: string, width: number, height: number, x?: number, y?: number) => {\n      dispatch({ type: 'RESIZE_ELEMENT', payload: { id, width, height, x, y } });\n    },\n    []\n  );\n\n  const bringToFrontAction = useCallback((id: string) => {\n    dispatch({ type: 'BRING_TO_FRONT', payload: id });\n  }, []);\n\n  const sendToBackAction = useCallback((id: string) => {\n    dispatch({ type: 'SEND_TO_BACK', payload: id });\n  }, []);\n\n  const moveUpAction = useCallback((id: string) => {\n    dispatch({ type: 'MOVE_UP', payload: id });\n  }, []);\n\n  const moveDownAction = useCallback((id: string) => {\n    dispatch({ type: 'MOVE_DOWN', payload: id });\n  }, []);\n\n  const setElements = useCallback((elements: CanvasElement[]) => {\n    dispatch({ type: 'SET_ELEMENTS', payload: elements });\n  }, []);\n\n  // Connection queries\n  const getConnectionById = useCallback(\n    (id: string) => state.connections.find((conn) => conn.id === id),\n    [state.connections]\n  );\n\n  const getConnectionsForElement = useCallback(\n    (elementId: string) =>\n      state.connections.filter(\n        (conn) => conn.fromId === elementId || conn.toId === elementId\n      ),\n    [state.connections]\n  );\n\n  // Connection actions\n  const addConnection = useCallback(\n    (connection: Omit<Connection, 'id'> & { id?: string }): string => {\n      const id = connection.id ?? generateId();\n      dispatch({\n        type: 'ADD_CONNECTION',\n        payload: { ...connection, id } as Connection,\n      });\n      return id;\n    },\n    []\n  );\n\n  const updateConnection = useCallback((id: string, updates: Partial<Connection>) => {\n    dispatch({ type: 'UPDATE_CONNECTION', payload: { id, updates } });\n  }, []);\n\n  const removeConnection = useCallback((id: string) => {\n    dispatch({ type: 'REMOVE_CONNECTION', payload: id });\n  }, []);\n\n  const setConnections = useCallback((connections: Connection[]) => {\n    dispatch({ type: 'SET_CONNECTIONS', payload: connections });\n  }, []);\n\n  // Config actions\n  const updateConfig = useCallback((config: Partial<CanvasConfig>) => {\n    dispatch({ type: 'UPDATE_CONFIG', payload: config });\n  }, []);\n\n  // Bulk actions\n  const clearCanvas = useCallback(() => {\n    dispatch({ type: 'CLEAR_CANVAS' });\n  }, []);\n\n  const loadState = useCallback((elements: CanvasElement[], connections: Connection[]) => {\n    dispatch({ type: 'LOAD_STATE', payload: { elements, connections } });\n  }, []);\n\n  const value = useMemo<CanvasContextValue>(\n    () => ({\n      elements: state.elements,\n      connections: state.connections,\n      config: state.config,\n      getElementById,\n      getElementsByType,\n      addElement,\n      addElements,\n      updateElement,\n      updateElements,\n      removeElement,\n      removeElements,\n      moveElement,\n      moveElements,\n      resizeElement,\n      bringToFront: bringToFrontAction,\n      sendToBack: sendToBackAction,\n      moveUp: moveUpAction,\n      moveDown: moveDownAction,\n      setElements,\n      getConnectionById,\n      getConnectionsForElement,\n      addConnection,\n      updateConnection,\n      removeConnection,\n      setConnections,\n      updateConfig,\n      clearCanvas,\n      loadState,\n    }),\n    [\n      state.elements,\n      state.connections,\n      state.config,\n      getElementById,\n      getElementsByType,\n      addElement,\n      addElements,\n      updateElement,\n      updateElements,\n      removeElement,\n      removeElements,\n      moveElement,\n      moveElements,\n      resizeElement,\n      bringToFrontAction,\n      sendToBackAction,\n      moveUpAction,\n      moveDownAction,\n      setElements,\n      getConnectionById,\n      getConnectionsForElement,\n      addConnection,\n      updateConnection,\n      removeConnection,\n      setConnections,\n      updateConfig,\n      clearCanvas,\n      loadState,\n    ]\n  );\n\n  return React.createElement(CanvasContext.Provider, { value }, children);\n};\n\nexport { CanvasContext };\n","// Combined Canvas Provider\n// Composes all context providers into a single provider\n\nimport React from 'react';\nimport type { CanvasElement, Connection } from '@/types/elements';\nimport type { CanvasConfig, ViewportState } from '@/types/canvas';\nimport type { Theme } from '@/types/theme';\nimport { ThemeProvider } from './ThemeContext';\nimport { ViewportProvider } from './ViewportContext';\nimport { SelectionProvider } from './SelectionContext';\nimport { HistoryProvider } from './HistoryContext';\nimport { CanvasProvider as CanvasStateProvider } from './CanvasContext';\n\nexport interface CombinedCanvasProviderProps {\n  children: React.ReactNode;\n\n  // Initial data\n  initialElements?: CanvasElement[];\n  initialConnections?: Connection[];\n\n  // Configuration\n  config?: Partial<CanvasConfig>;\n  theme?: 'light' | 'dark' | Theme;\n\n  // Viewport settings\n  initialViewport?: Partial<ViewportState>;\n\n  // History settings\n  maxHistorySize?: number;\n\n  // Callbacks\n  onElementsChange?: (elements: CanvasElement[], connections: Connection[]) => void;\n  onSelectionChange?: (selectedIds: string[]) => void;\n\n  // Controlled mode support\n  elements?: CanvasElement[];\n  connections?: Connection[];\n  selectedIds?: string[];\n}\n\n/**\n * Combined provider that composes all canvas contexts\n * Use this for full-featured canvas components\n */\nexport const CombinedCanvasProvider: React.FC<CombinedCanvasProviderProps> = ({\n  children,\n  initialElements = [],\n  initialConnections = [],\n  config,\n  theme = 'light',\n  initialViewport,\n  maxHistorySize = 50,\n  onElementsChange,\n  onSelectionChange,\n  elements,\n  connections,\n  selectedIds,\n}) => {\n  // Use controlled elements if provided, otherwise use initial\n  const effectiveElements = elements ?? initialElements;\n  const effectiveConnections = connections ?? initialConnections;\n\n  return (\n    <ThemeProvider theme={theme}>\n      <ViewportProvider initialViewport={initialViewport}>\n        <SelectionProvider\n          initialSelection={selectedIds}\n          onSelectionChange={onSelectionChange}\n        >\n          <HistoryProvider\n            initialElements={effectiveElements}\n            initialConnections={effectiveConnections}\n            maxHistorySize={maxHistorySize}\n          >\n            <CanvasStateProvider\n              initialElements={effectiveElements}\n              initialConnections={effectiveConnections}\n              config={config}\n              onChange={onElementsChange}\n            >\n              {children}\n            </CanvasStateProvider>\n          </HistoryProvider>\n        </SelectionProvider>\n      </ViewportProvider>\n    </ThemeProvider>\n  );\n};\n\nexport default CombinedCanvasProvider;\n","// useDraggable hook\n// Provides drag functionality for elements\n\nimport { useCallback, useRef, useState } from \"react\";\nimport type { Point } from \"@/types/elements\";\nimport { useViewport } from \"@/core/context\";\n\nexport interface DragState {\n\tisDragging: boolean;\n\tstartPosition: Point | null;\n\tcurrentPosition: Point | null;\n\tdelta: Point;\n}\n\nexport interface UseDraggableOptions {\n\tonDragStart?: (position: Point) => void;\n\tonDrag?: (position: Point, delta: Point) => void;\n\tonDragEnd?: (position: Point, delta: Point) => void;\n\tdisabled?: boolean;\n\tthreshold?: number; // Minimum movement to start dragging\n\tconstrainToParent?: boolean;\n}\n\nexport interface UseDraggableReturn {\n\tdragState: DragState;\n\thandlers: {\n\t\tonMouseDown: (e: React.MouseEvent) => void;\n\t\tonTouchStart: (e: React.TouchEvent) => void;\n\t};\n\tisDragging: boolean;\n}\n\nexport const useDraggable = (\n\toptions: UseDraggableOptions = {},\n): UseDraggableReturn => {\n\tconst {\n\t\tonDragStart,\n\t\tonDrag,\n\t\tonDragEnd,\n\t\tdisabled = false,\n\t\tthreshold = 3,\n\t} = options;\n\n\tconst [dragState, setDragState] = useState<DragState>({\n\t\tisDragging: false,\n\t\tstartPosition: null,\n\t\tcurrentPosition: null,\n\t\tdelta: { x: 0, y: 0 },\n\t});\n\n\tconst startRef = useRef<Point | null>(null);\n\tconst hasPassedThreshold = useRef(false);\n\tconst { screenToCanvas } = useViewport();\n\n\tconst getEventPosition = useCallback(\n\t\t(e: MouseEvent | TouchEvent): Point => {\n\t\t\tif (\"touches\" in e) {\n\t\t\t\tconst touch = e.touches[0] || e.changedTouches[0];\n\t\t\t\treturn screenToCanvas({ x: touch.clientX, y: touch.clientY });\n\t\t\t}\n\t\t\treturn screenToCanvas({ x: e.clientX, y: e.clientY });\n\t\t},\n\t\t[screenToCanvas],\n\t);\n\n\tconst handleMove = useCallback(\n\t\t(e: MouseEvent | TouchEvent) => {\n\t\t\tif (!startRef.current) return;\n\n\t\t\tconst currentPos = getEventPosition(e);\n\t\t\tconst delta = {\n\t\t\t\tx: currentPos.x - startRef.current.x,\n\t\t\t\ty: currentPos.y - startRef.current.y,\n\t\t\t};\n\n\t\t\t// Check threshold\n\t\t\tif (!hasPassedThreshold.current) {\n\t\t\t\tconst distance = Math.sqrt(delta.x ** 2 + delta.y ** 2);\n\t\t\t\tif (distance < threshold) return;\n\t\t\t\thasPassedThreshold.current = true;\n\t\t\t\tonDragStart?.(startRef.current);\n\t\t\t}\n\n\t\t\tsetDragState({\n\t\t\t\tisDragging: true,\n\t\t\t\tstartPosition: startRef.current,\n\t\t\t\tcurrentPosition: currentPos,\n\t\t\t\tdelta,\n\t\t\t});\n\n\t\t\tonDrag?.(currentPos, delta);\n\t\t},\n\t\t[getEventPosition, threshold, onDragStart, onDrag],\n\t);\n\n\tconst handleEnd = useCallback(\n\t\t(e: MouseEvent | TouchEvent) => {\n\t\t\tif (!startRef.current) return;\n\n\t\t\tconst endPos = getEventPosition(e);\n\t\t\tconst delta = {\n\t\t\t\tx: endPos.x - startRef.current.x,\n\t\t\t\ty: endPos.y - startRef.current.y,\n\t\t\t};\n\n\t\t\tif (hasPassedThreshold.current) {\n\t\t\t\tonDragEnd?.(endPos, delta);\n\t\t\t}\n\n\t\t\tsetDragState({\n\t\t\t\tisDragging: false,\n\t\t\t\tstartPosition: null,\n\t\t\t\tcurrentPosition: null,\n\t\t\t\tdelta: { x: 0, y: 0 },\n\t\t\t});\n\n\t\t\tstartRef.current = null;\n\t\t\thasPassedThreshold.current = false;\n\n\t\t\t// Cleanup listeners\n\t\t\tdocument.removeEventListener(\"mousemove\", handleMove);\n\t\t\tdocument.removeEventListener(\"mouseup\", handleEnd);\n\t\t\tdocument.removeEventListener(\"touchmove\", handleMove);\n\t\t\tdocument.removeEventListener(\"touchend\", handleEnd);\n\t\t},\n\t\t[getEventPosition, handleMove, onDragEnd],\n\t);\n\n\tconst handleStart = useCallback(\n\t\t(clientX: number, clientY: number) => {\n\t\t\tif (disabled) return;\n\n\t\t\tconst startPos = screenToCanvas({ x: clientX, y: clientY });\n\t\t\tstartRef.current = startPos;\n\t\t\thasPassedThreshold.current = false;\n\n\t\t\tsetDragState({\n\t\t\t\tisDragging: false,\n\t\t\t\tstartPosition: startPos,\n\t\t\t\tcurrentPosition: startPos,\n\t\t\t\tdelta: { x: 0, y: 0 },\n\t\t\t});\n\n\t\t\t// Add listeners\n\t\t\tdocument.addEventListener(\"mousemove\", handleMove);\n\t\t\tdocument.addEventListener(\"mouseup\", handleEnd);\n\t\t\tdocument.addEventListener(\"touchmove\", handleMove, { passive: false });\n\t\t\tdocument.addEventListener(\"touchend\", handleEnd);\n\t\t},\n\t\t[disabled, screenToCanvas, handleMove, handleEnd],\n\t);\n\n\tconst onMouseDown = useCallback(\n\t\t(e: React.MouseEvent) => {\n\t\t\tif (e.button !== 0) return; // Only left click\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\thandleStart(e.clientX, e.clientY);\n\t\t},\n\t\t[handleStart],\n\t);\n\n\tconst onTouchStart = useCallback(\n\t\t(e: React.TouchEvent) => {\n\t\t\tif (e.touches.length !== 1) return; // Single touch only\n\t\t\tconst touch = e.touches[0];\n\t\t\thandleStart(touch.clientX, touch.clientY);\n\t\t},\n\t\t[handleStart],\n\t);\n\n\treturn {\n\t\tdragState,\n\t\thandlers: {\n\t\t\tonMouseDown,\n\t\t\tonTouchStart,\n\t\t},\n\t\tisDragging: dragState.isDragging,\n\t};\n};\n\nexport default useDraggable;\n","// useResizable hook\n// Provides resize functionality for elements\n\nimport { useCallback, useRef, useState } from \"react\";\nimport type { Point } from \"@/types/elements\";\nimport type { ResizeHandle } from \"@/core/utils/geometry\";\nimport { useViewport } from \"@/core/context\";\n\nexport interface ResizeState {\n\tisResizing: boolean;\n\thandle: ResizeHandle | null;\n\tstartBounds: { x: number; y: number; width: number; height: number } | null;\n\tcurrentBounds: { x: number; y: number; width: number; height: number } | null;\n}\n\nexport interface UseResizableOptions {\n\tonResizeStart?: (handle: ResizeHandle) => void;\n\tonResize?: (bounds: {\n\t\tx: number;\n\t\ty: number;\n\t\twidth: number;\n\t\theight: number;\n\t}) => void;\n\tonResizeEnd?: (bounds: {\n\t\tx: number;\n\t\ty: number;\n\t\twidth: number;\n\t\theight: number;\n\t}) => void;\n\tdisabled?: boolean;\n\tminWidth?: number;\n\tminHeight?: number;\n\tmaxWidth?: number;\n\tmaxHeight?: number;\n\tmaintainAspectRatio?: boolean;\n\taspectRatio?: number;\n}\n\nexport interface UseResizableReturn {\n\tresizeState: ResizeState;\n\tstartResize: (\n\t\thandle: ResizeHandle,\n\t\tbounds: { x: number; y: number; width: number; height: number },\n\t\te: React.MouseEvent | React.TouchEvent,\n\t) => void;\n\tisResizing: boolean;\n}\n\nexport const useResizable = (\n\toptions: UseResizableOptions = {},\n): UseResizableReturn => {\n\tconst {\n\t\tonResizeStart,\n\t\tonResize,\n\t\tonResizeEnd,\n\t\tdisabled = false,\n\t\tminWidth = 20,\n\t\tminHeight = 20,\n\t\tmaxWidth = Infinity,\n\t\tmaxHeight = Infinity,\n\t\tmaintainAspectRatio = false,\n\t\taspectRatio,\n\t} = options;\n\n\tconst [resizeState, setResizeState] = useState<ResizeState>({\n\t\tisResizing: false,\n\t\thandle: null,\n\t\tstartBounds: null,\n\t\tcurrentBounds: null,\n\t});\n\n\tconst startRef = useRef<{\n\t\tposition: Point;\n\t\tbounds: { x: number; y: number; width: number; height: number };\n\t\thandle: ResizeHandle;\n\t\taspectRatio: number;\n\t} | null>(null);\n\n\tconst { screenToCanvas } = useViewport();\n\n\tconst getEventPosition = useCallback(\n\t\t(e: MouseEvent | TouchEvent): Point => {\n\t\t\tif (\"touches\" in e) {\n\t\t\t\tconst touch = e.touches[0] || e.changedTouches[0];\n\t\t\t\treturn screenToCanvas({ x: touch.clientX, y: touch.clientY });\n\t\t\t}\n\t\t\treturn screenToCanvas({ x: e.clientX, y: e.clientY });\n\t\t},\n\t\t[screenToCanvas],\n\t);\n\n\tconst calculateNewBounds = useCallback(\n\t\t(\n\t\t\tcurrentPos: Point,\n\t\t): { x: number; y: number; width: number; height: number } => {\n\t\t\tif (!startRef.current) {\n\t\t\t\treturn { x: 0, y: 0, width: 0, height: 0 };\n\t\t\t}\n\n\t\t\tconst { position: startPos, bounds, handle } = startRef.current;\n\t\t\tconst deltaX = currentPos.x - startPos.x;\n\t\t\tconst deltaY = currentPos.y - startPos.y;\n\n\t\t\tlet newX = bounds.x;\n\t\t\tlet newY = bounds.y;\n\t\t\tlet newWidth = bounds.width;\n\t\t\tlet newHeight = bounds.height;\n\n\t\t\t// Calculate based on handle position\n\t\t\tswitch (handle) {\n\t\t\t\tcase \"nw\":\n\t\t\t\t\tnewX = bounds.x + deltaX;\n\t\t\t\t\tnewY = bounds.y + deltaY;\n\t\t\t\t\tnewWidth = bounds.width - deltaX;\n\t\t\t\t\tnewHeight = bounds.height - deltaY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"n\":\n\t\t\t\t\tnewY = bounds.y + deltaY;\n\t\t\t\t\tnewHeight = bounds.height - deltaY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"ne\":\n\t\t\t\t\tnewY = bounds.y + deltaY;\n\t\t\t\t\tnewWidth = bounds.width + deltaX;\n\t\t\t\t\tnewHeight = bounds.height - deltaY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"e\":\n\t\t\t\t\tnewWidth = bounds.width + deltaX;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"se\":\n\t\t\t\t\tnewWidth = bounds.width + deltaX;\n\t\t\t\t\tnewHeight = bounds.height + deltaY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"s\":\n\t\t\t\t\tnewHeight = bounds.height + deltaY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"sw\":\n\t\t\t\t\tnewX = bounds.x + deltaX;\n\t\t\t\t\tnewWidth = bounds.width - deltaX;\n\t\t\t\t\tnewHeight = bounds.height + deltaY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"w\":\n\t\t\t\t\tnewX = bounds.x + deltaX;\n\t\t\t\t\tnewWidth = bounds.width - deltaX;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Apply constraints\n\t\t\tif (newWidth < minWidth) {\n\t\t\t\tif (handle.includes(\"w\")) {\n\t\t\t\t\tnewX = bounds.x + bounds.width - minWidth;\n\t\t\t\t}\n\t\t\t\tnewWidth = minWidth;\n\t\t\t}\n\t\t\tif (newHeight < minHeight) {\n\t\t\t\tif (handle.includes(\"n\")) {\n\t\t\t\t\tnewY = bounds.y + bounds.height - minHeight;\n\t\t\t\t}\n\t\t\t\tnewHeight = minHeight;\n\t\t\t}\n\t\t\tif (newWidth > maxWidth) {\n\t\t\t\tnewWidth = maxWidth;\n\t\t\t}\n\t\t\tif (newHeight > maxHeight) {\n\t\t\t\tnewHeight = maxHeight;\n\t\t\t}\n\n\t\t\t// Maintain aspect ratio if needed\n\t\t\tif (maintainAspectRatio && startRef.current.aspectRatio) {\n\t\t\t\tconst targetRatio = startRef.current.aspectRatio;\n\t\t\t\tconst currentRatio = newWidth / newHeight;\n\n\t\t\t\tif (currentRatio > targetRatio) {\n\t\t\t\t\tnewWidth = newHeight * targetRatio;\n\t\t\t\t} else {\n\t\t\t\t\tnewHeight = newWidth / targetRatio;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn { x: newX, y: newY, width: newWidth, height: newHeight };\n\t\t},\n\t\t[minWidth, minHeight, maxWidth, maxHeight, maintainAspectRatio],\n\t);\n\n\tconst handleMove = useCallback(\n\t\t(e: MouseEvent | TouchEvent) => {\n\t\t\tif (!startRef.current) return;\n\n\t\t\tconst currentPos = getEventPosition(e);\n\t\t\tconst newBounds = calculateNewBounds(currentPos);\n\n\t\t\tsetResizeState((prev) => ({\n\t\t\t\t...prev,\n\t\t\t\tcurrentBounds: newBounds,\n\t\t\t}));\n\n\t\t\tonResize?.(newBounds);\n\t\t},\n\t\t[getEventPosition, calculateNewBounds, onResize],\n\t);\n\n\tconst handleEnd = useCallback(\n\t\t(e: MouseEvent | TouchEvent) => {\n\t\t\tif (!startRef.current) return;\n\n\t\t\tconst endPos = getEventPosition(e);\n\t\t\tconst finalBounds = calculateNewBounds(endPos);\n\n\t\t\tonResizeEnd?.(finalBounds);\n\n\t\t\tsetResizeState({\n\t\t\t\tisResizing: false,\n\t\t\t\thandle: null,\n\t\t\t\tstartBounds: null,\n\t\t\t\tcurrentBounds: null,\n\t\t\t});\n\n\t\t\tstartRef.current = null;\n\n\t\t\t// Cleanup listeners\n\t\t\tdocument.removeEventListener(\"mousemove\", handleMove);\n\t\t\tdocument.removeEventListener(\"mouseup\", handleEnd);\n\t\t\tdocument.removeEventListener(\"touchmove\", handleMove);\n\t\t\tdocument.removeEventListener(\"touchend\", handleEnd);\n\t\t},\n\t\t[getEventPosition, calculateNewBounds, handleMove, onResizeEnd],\n\t);\n\n\tconst startResize = useCallback(\n\t\t(\n\t\t\thandle: ResizeHandle,\n\t\t\tbounds: { x: number; y: number; width: number; height: number },\n\t\t\te: React.MouseEvent | React.TouchEvent,\n\t\t) => {\n\t\t\tif (disabled) return;\n\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\n\t\t\tconst clientX = \"touches\" in e ? e.touches[0].clientX : e.clientX;\n\t\t\tconst clientY = \"touches\" in e ? e.touches[0].clientY : e.clientY;\n\t\t\tconst startPos = screenToCanvas({ x: clientX, y: clientY });\n\n\t\t\tstartRef.current = {\n\t\t\t\tposition: startPos,\n\t\t\t\tbounds,\n\t\t\t\thandle,\n\t\t\t\taspectRatio: aspectRatio ?? bounds.width / bounds.height,\n\t\t\t};\n\n\t\t\tsetResizeState({\n\t\t\t\tisResizing: true,\n\t\t\t\thandle,\n\t\t\t\tstartBounds: bounds,\n\t\t\t\tcurrentBounds: bounds,\n\t\t\t});\n\n\t\t\tonResizeStart?.(handle);\n\n\t\t\t// Add listeners\n\t\t\tdocument.addEventListener(\"mousemove\", handleMove);\n\t\t\tdocument.addEventListener(\"mouseup\", handleEnd);\n\t\t\tdocument.addEventListener(\"touchmove\", handleMove, { passive: false });\n\t\t\tdocument.addEventListener(\"touchend\", handleEnd);\n\t\t},\n\t\t[\n\t\t\tdisabled,\n\t\t\tscreenToCanvas,\n\t\t\taspectRatio,\n\t\t\tonResizeStart,\n\t\t\thandleMove,\n\t\t\thandleEnd,\n\t\t],\n\t);\n\n\treturn {\n\t\tresizeState,\n\t\tstartResize,\n\t\tisResizing: resizeState.isResizing,\n\t};\n};\n\nexport default useResizable;\n","// useRotatable hook\n// Provides rotation functionality for elements\n\nimport { useCallback, useRef, useState } from \"react\";\nimport type { Point } from \"@/types/elements\";\nimport { useViewport } from \"@/core/context\";\n\nexport interface RotateState {\n\tisRotating: boolean;\n\tstartAngle: number | null;\n\tcurrentAngle: number | null;\n\tdeltaAngle: number;\n}\n\nexport interface UseRotatableOptions {\n\tonRotateStart?: (angle: number) => void;\n\tonRotate?: (angle: number, deltaAngle: number) => void;\n\tonRotateEnd?: (angle: number) => void;\n\tdisabled?: boolean;\n\tsnapAngle?: number; // Snap to multiples of this angle (e.g., 15 for 15 increments)\n\tcenter?: Point; // Center point for rotation\n}\n\nexport interface UseRotatableReturn {\n\trotateState: RotateState;\n\tstartRotate: (\n\t\tcenter: Point,\n\t\tinitialRotation: number,\n\t\te: React.MouseEvent | React.TouchEvent,\n\t) => void;\n\tisRotating: boolean;\n}\n\nexport const useRotatable = (\n\toptions: UseRotatableOptions = {},\n): UseRotatableReturn => {\n\tconst {\n\t\tonRotateStart,\n\t\tonRotate,\n\t\tonRotateEnd,\n\t\tdisabled = false,\n\t\tsnapAngle,\n\t} = options;\n\n\tconst [rotateState, setRotateState] = useState<RotateState>({\n\t\tisRotating: false,\n\t\tstartAngle: null,\n\t\tcurrentAngle: null,\n\t\tdeltaAngle: 0,\n\t});\n\n\tconst startRef = useRef<{\n\t\tcenter: Point;\n\t\tstartMouseAngle: number;\n\t\tinitialRotation: number;\n\t} | null>(null);\n\n\tconst { screenToCanvas } = useViewport();\n\n\tconst getEventPosition = useCallback(\n\t\t(e: MouseEvent | TouchEvent): Point => {\n\t\t\tif (\"touches\" in e) {\n\t\t\t\tconst touch = e.touches[0] || e.changedTouches[0];\n\t\t\t\treturn screenToCanvas({ x: touch.clientX, y: touch.clientY });\n\t\t\t}\n\t\t\treturn screenToCanvas({ x: e.clientX, y: e.clientY });\n\t\t},\n\t\t[screenToCanvas],\n\t);\n\n\t// Calculate angle from center to point\n\tconst getAngle = useCallback((center: Point, point: Point): number => {\n\t\tconst dx = point.x - center.x;\n\t\tconst dy = point.y - center.y;\n\t\treturn Math.atan2(dy, dx) * (180 / Math.PI);\n\t}, []);\n\n\t// Snap angle to nearest multiple\n\tconst snapToAngle = useCallback(\n\t\t(angle: number): number => {\n\t\t\tif (!snapAngle) return angle;\n\t\t\treturn Math.round(angle / snapAngle) * snapAngle;\n\t\t},\n\t\t[snapAngle],\n\t);\n\n\tconst handleMove = useCallback(\n\t\t(e: MouseEvent | TouchEvent) => {\n\t\t\tif (!startRef.current || disabled) return;\n\n\t\t\tconst currentPos = getEventPosition(e);\n\t\t\tconst { center, startMouseAngle, initialRotation } = startRef.current;\n\n\t\t\tconst currentMouseAngle = getAngle(center, currentPos);\n\t\t\tlet deltaAngle = currentMouseAngle - startMouseAngle;\n\t\t\tlet newAngle = initialRotation + deltaAngle;\n\n\t\t\t// Normalize to 0-360\n\t\t\tnewAngle = ((newAngle % 360) + 360) % 360;\n\n\t\t\t// Apply snapping if shift is held\n\t\t\tif ((e as MouseEvent).shiftKey && snapAngle) {\n\t\t\t\tnewAngle = snapToAngle(newAngle);\n\t\t\t}\n\n\t\t\tsetRotateState({\n\t\t\t\tisRotating: true,\n\t\t\t\tstartAngle: initialRotation,\n\t\t\t\tcurrentAngle: newAngle,\n\t\t\t\tdeltaAngle: newAngle - initialRotation,\n\t\t\t});\n\n\t\t\tonRotate?.(newAngle, newAngle - initialRotation);\n\t\t},\n\t\t[disabled, getEventPosition, getAngle, snapAngle, snapToAngle, onRotate],\n\t);\n\n\tconst handleEnd = useCallback(\n\t\t(e: MouseEvent | TouchEvent) => {\n\t\t\tif (!startRef.current) return;\n\n\t\t\tconst currentPos = getEventPosition(e);\n\t\t\tconst { center, startMouseAngle, initialRotation } = startRef.current;\n\n\t\t\tconst currentMouseAngle = getAngle(center, currentPos);\n\t\t\tlet deltaAngle = currentMouseAngle - startMouseAngle;\n\t\t\tlet finalAngle = initialRotation + deltaAngle;\n\n\t\t\t// Normalize to 0-360\n\t\t\tfinalAngle = ((finalAngle % 360) + 360) % 360;\n\n\t\t\t// Apply snapping\n\t\t\tif ((e as MouseEvent).shiftKey && snapAngle) {\n\t\t\t\tfinalAngle = snapToAngle(finalAngle);\n\t\t\t}\n\n\t\t\tonRotateEnd?.(finalAngle);\n\n\t\t\tsetRotateState({\n\t\t\t\tisRotating: false,\n\t\t\t\tstartAngle: null,\n\t\t\t\tcurrentAngle: null,\n\t\t\t\tdeltaAngle: 0,\n\t\t\t});\n\n\t\t\tstartRef.current = null;\n\n\t\t\t// Cleanup listeners\n\t\t\tdocument.removeEventListener(\"mousemove\", handleMove);\n\t\t\tdocument.removeEventListener(\"mouseup\", handleEnd);\n\t\t\tdocument.removeEventListener(\"touchmove\", handleMove);\n\t\t\tdocument.removeEventListener(\"touchend\", handleEnd);\n\t\t},\n\t\t[\n\t\t\tgetEventPosition,\n\t\t\tgetAngle,\n\t\t\tsnapAngle,\n\t\t\tsnapToAngle,\n\t\t\tonRotateEnd,\n\t\t\thandleMove,\n\t\t],\n\t);\n\n\tconst startRotate = useCallback(\n\t\t(\n\t\t\tcenter: Point,\n\t\t\tinitialRotation: number,\n\t\t\te: React.MouseEvent | React.TouchEvent,\n\t\t) => {\n\t\t\tif (disabled) return;\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tconst startPos = getEventPosition(\n\t\t\t\te.nativeEvent as MouseEvent | TouchEvent,\n\t\t\t);\n\t\t\tconst startMouseAngle = getAngle(center, startPos);\n\n\t\t\tstartRef.current = {\n\t\t\t\tcenter,\n\t\t\t\tstartMouseAngle,\n\t\t\t\tinitialRotation,\n\t\t\t};\n\n\t\t\tsetRotateState({\n\t\t\t\tisRotating: true,\n\t\t\t\tstartAngle: initialRotation,\n\t\t\t\tcurrentAngle: initialRotation,\n\t\t\t\tdeltaAngle: 0,\n\t\t\t});\n\n\t\t\tonRotateStart?.(initialRotation);\n\n\t\t\t// Add listeners\n\t\t\tdocument.addEventListener(\"mousemove\", handleMove);\n\t\t\tdocument.addEventListener(\"mouseup\", handleEnd);\n\t\t\tdocument.addEventListener(\"touchmove\", handleMove);\n\t\t\tdocument.addEventListener(\"touchend\", handleEnd);\n\t\t},\n\t\t[\n\t\t\tdisabled,\n\t\t\tgetEventPosition,\n\t\t\tgetAngle,\n\t\t\tonRotateStart,\n\t\t\thandleMove,\n\t\t\thandleEnd,\n\t\t],\n\t);\n\n\treturn {\n\t\trotateState,\n\t\tstartRotate,\n\t\tisRotating: rotateState.isRotating,\n\t};\n};\n\nexport default useRotatable;\n","// useSelectable hook\n// Provides selection functionality for elements\n\nimport { useCallback } from \"react\";\nimport { useSelection } from \"@/core/context\";\n\nexport interface UseSelectableOptions {\n\tid: string;\n\tdisabled?: boolean;\n\tonSelect?: (selected: boolean) => void;\n}\n\nexport interface UseSelectableReturn {\n\tisSelected: boolean;\n\thandlers: {\n\t\tonClick: (e: React.MouseEvent) => void;\n\t};\n\tselect: () => void;\n\tdeselect: () => void;\n\ttoggle: () => void;\n}\n\nexport const useSelectable = (\n\toptions: UseSelectableOptions,\n): UseSelectableReturn => {\n\tconst { id, disabled = false, onSelect } = options;\n\tconst {\n\t\tisSelected: checkSelected,\n\t\tselect: selectElement,\n\t\taddToSelection,\n\t\tremoveFromSelection,\n\t\ttoggleSelection,\n\t\tclearSelection,\n\t} = useSelection();\n\n\tconst isSelected = checkSelected(id);\n\n\tconst select = useCallback(() => {\n\t\tif (disabled) return;\n\t\tselectElement(id);\n\t\tonSelect?.(true);\n\t}, [disabled, id, selectElement, onSelect]);\n\n\tconst deselect = useCallback(() => {\n\t\tif (disabled) return;\n\t\tremoveFromSelection(id);\n\t\tonSelect?.(false);\n\t}, [disabled, id, removeFromSelection, onSelect]);\n\n\tconst toggle = useCallback(() => {\n\t\tif (disabled) return;\n\t\tconst willBeSelected = !isSelected;\n\t\ttoggleSelection(id);\n\t\tonSelect?.(willBeSelected);\n\t}, [disabled, id, isSelected, toggleSelection, onSelect]);\n\n\tconst onClick = useCallback(\n\t\t(e: React.MouseEvent) => {\n\t\t\tif (disabled) return;\n\n\t\t\te.stopPropagation();\n\n\t\t\t// Multi-select with Ctrl/Cmd or Shift\n\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\ttoggleSelection(id);\n\t\t\t\tonSelect?.(!isSelected);\n\t\t\t} else if (e.shiftKey) {\n\t\t\t\t// Add to selection\n\t\t\t\taddToSelection(id);\n\t\t\t\tonSelect?.(true);\n\t\t\t} else {\n\t\t\t\t// Single select - clear others and select this\n\t\t\t\tselectElement(id);\n\t\t\t\tonSelect?.(true);\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tdisabled,\n\t\t\tid,\n\t\t\tisSelected,\n\t\t\ttoggleSelection,\n\t\t\taddToSelection,\n\t\t\tselectElement,\n\t\t\tonSelect,\n\t\t],\n\t);\n\n\treturn {\n\t\tisSelected,\n\t\thandlers: {\n\t\t\tonClick,\n\t\t},\n\t\tselect,\n\t\tdeselect,\n\t\ttoggle,\n\t};\n};\n\nexport default useSelectable;\n","// useKeyboard hook\n// Provides keyboard shortcut handling for canvas\n\nimport { useEffect, useCallback, useRef } from \"react\";\n\nexport type KeyboardShortcut = {\n\tkey: string;\n\tctrl?: boolean;\n\tmeta?: boolean;\n\tshift?: boolean;\n\talt?: boolean;\n\taction: () => void;\n\tpreventDefault?: boolean;\n};\n\nexport interface UseKeyboardOptions {\n\tshortcuts?: KeyboardShortcut[];\n\tenabled?: boolean;\n\ttargetRef?: React.RefObject<HTMLElement>;\n}\n\n/**\n * Matches a keyboard event against a shortcut definition\n */\nconst matchesShortcut = (\n\te: KeyboardEvent,\n\tshortcut: KeyboardShortcut,\n): boolean => {\n\tconst keyMatches = e.key.toLowerCase() === shortcut.key.toLowerCase();\n\tconst ctrlMatches = shortcut.ctrl\n\t\t? e.ctrlKey\n\t\t: !e.ctrlKey || Boolean(shortcut.meta);\n\tconst metaMatches = shortcut.meta\n\t\t? e.metaKey\n\t\t: !e.metaKey || Boolean(shortcut.ctrl);\n\tconst shiftMatches = shortcut.shift ? e.shiftKey : !e.shiftKey;\n\tconst altMatches = shortcut.alt ? e.altKey : !e.altKey;\n\n\t// For Ctrl/Meta, allow either on macOS\n\tconst modifierMatches =\n\t\tshortcut.ctrl || shortcut.meta\n\t\t\t? Boolean(shortcut.ctrl && (e.ctrlKey || e.metaKey)) ||\n\t\t\t\tBoolean(shortcut.meta && e.metaKey)\n\t\t\t: !e.ctrlKey && !e.metaKey;\n\n\treturn keyMatches && modifierMatches && shiftMatches && altMatches;\n};\n\nexport const useKeyboard = (options: UseKeyboardOptions = {}): void => {\n\tconst { shortcuts = [], enabled = true, targetRef } = options;\n\tconst shortcutsRef = useRef(shortcuts);\n\tshortcutsRef.current = shortcuts;\n\n\tconst handleKeyDown = useCallback(\n\t\t(e: KeyboardEvent) => {\n\t\t\tif (!enabled) return;\n\n\t\t\tfor (const shortcut of shortcutsRef.current) {\n\t\t\t\tif (matchesShortcut(e, shortcut)) {\n\t\t\t\t\tif (shortcut.preventDefault !== false) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tshortcut.action();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[enabled],\n\t);\n\n\tuseEffect(() => {\n\t\tconst target = targetRef?.current ?? document;\n\t\ttarget.addEventListener(\"keydown\", handleKeyDown as EventListener);\n\t\treturn () => {\n\t\t\ttarget.removeEventListener(\"keydown\", handleKeyDown as EventListener);\n\t\t};\n\t}, [handleKeyDown, targetRef]);\n};\n\n/**\n * Common canvas shortcuts preset\n */\nexport const useCanvasKeyboardShortcuts = (actions: {\n\tundo?: () => void;\n\tredo?: () => void;\n\tdelete?: () => void;\n\tselectAll?: () => void;\n\tcopy?: () => void;\n\tpaste?: () => void;\n\tcut?: () => void;\n\tescape?: () => void;\n\tzoomIn?: () => void;\n\tzoomOut?: () => void;\n\tresetZoom?: () => void;\n}): void => {\n\tconst shortcuts: KeyboardShortcut[] = [];\n\n\tif (actions.undo) {\n\t\tshortcuts.push({ key: \"z\", ctrl: true, action: actions.undo });\n\t}\n\tif (actions.redo) {\n\t\tshortcuts.push({ key: \"z\", ctrl: true, shift: true, action: actions.redo });\n\t\tshortcuts.push({ key: \"y\", ctrl: true, action: actions.redo });\n\t}\n\tif (actions.delete) {\n\t\tshortcuts.push({ key: \"Delete\", action: actions.delete });\n\t\tshortcuts.push({ key: \"Backspace\", action: actions.delete });\n\t}\n\tif (actions.selectAll) {\n\t\tshortcuts.push({ key: \"a\", ctrl: true, action: actions.selectAll });\n\t}\n\tif (actions.copy) {\n\t\tshortcuts.push({ key: \"c\", ctrl: true, action: actions.copy });\n\t}\n\tif (actions.paste) {\n\t\tshortcuts.push({ key: \"v\", ctrl: true, action: actions.paste });\n\t}\n\tif (actions.cut) {\n\t\tshortcuts.push({ key: \"x\", ctrl: true, action: actions.cut });\n\t}\n\tif (actions.escape) {\n\t\tshortcuts.push({ key: \"Escape\", action: actions.escape });\n\t}\n\tif (actions.zoomIn) {\n\t\tshortcuts.push({ key: \"+\", ctrl: true, action: actions.zoomIn });\n\t\tshortcuts.push({ key: \"=\", ctrl: true, action: actions.zoomIn });\n\t}\n\tif (actions.zoomOut) {\n\t\tshortcuts.push({ key: \"-\", ctrl: true, action: actions.zoomOut });\n\t}\n\tif (actions.resetZoom) {\n\t\tshortcuts.push({ key: \"0\", ctrl: true, action: actions.resetZoom });\n\t}\n\n\tuseKeyboard({ shortcuts });\n};\n\nexport default useKeyboard;\n","// useCanvasActions hook\n// Combines common canvas operations with history support\n\nimport { useCallback, useRef } from \"react\";\nimport { useCanvas, useSelection, useHistory } from \"@/core/context\";\nimport type { CanvasElement, Connection } from \"@/types/elements\";\n\nexport interface UseCanvasActionsReturn {\n\t// Element operations with history\n\taddElement: (element: Omit<CanvasElement, \"id\"> & { id?: string }) => string;\n\tupdateElement: (id: string, updates: Partial<CanvasElement>) => void;\n\tremoveElement: (id: string) => void;\n\tremoveSelected: () => void;\n\tmoveSelected: (deltaX: number, deltaY: number) => void;\n\tduplicateSelected: () => string[];\n\n\t// Connection operations with history\n\taddConnection: (\n\t\tconnection: Omit<Connection, \"id\"> & { id?: string },\n\t) => string;\n\tremoveConnection: (id: string) => void;\n\n\t// Clipboard operations\n\tcopy: () => void;\n\tcut: () => void;\n\tpaste: () => void;\n\thasCopied: boolean;\n\n\t// History operations\n\tundo: () => void;\n\tredo: () => void;\n\tcanUndo: boolean;\n\tcanRedo: boolean;\n}\n\nexport const useCanvasActions = (): UseCanvasActionsReturn => {\n\tconst canvas = useCanvas();\n\tconst selection = useSelection();\n\tconst history = useHistory();\n\n\t// Clipboard storage\n\tconst clipboardRef = useRef<{\n\t\telements: CanvasElement[];\n\t\tconnections: Connection[];\n\t} | null>(null);\n\n\t// Save state to history before making changes\n\tconst saveState = useCallback(() => {\n\t\thistory.pushState(canvas.elements, canvas.connections);\n\t}, [history, canvas.elements, canvas.connections]);\n\n\t// Element operations\n\tconst addElement = useCallback(\n\t\t(element: Omit<CanvasElement, \"id\"> & { id?: string }): string => {\n\t\t\tsaveState();\n\t\t\treturn canvas.addElement(element);\n\t\t},\n\t\t[canvas, saveState],\n\t);\n\n\tconst updateElement = useCallback(\n\t\t(id: string, updates: Partial<CanvasElement>) => {\n\t\t\tsaveState();\n\t\t\tcanvas.updateElement(id, updates);\n\t\t},\n\t\t[canvas, saveState],\n\t);\n\n\tconst removeElement = useCallback(\n\t\t(id: string) => {\n\t\t\tsaveState();\n\t\t\tcanvas.removeElement(id);\n\t\t},\n\t\t[canvas, saveState],\n\t);\n\n\tconst removeSelected = useCallback(() => {\n\t\tif (selection.selectedIds.length === 0) return;\n\t\tsaveState();\n\t\tcanvas.removeElements(selection.selectedIds);\n\t\tselection.clearSelection();\n\t}, [canvas, selection, saveState]);\n\n\tconst moveSelected = useCallback(\n\t\t(deltaX: number, deltaY: number) => {\n\t\t\tif (selection.selectedIds.length === 0) return;\n\t\t\tsaveState();\n\t\t\tcanvas.moveElements(selection.selectedIds, deltaX, deltaY);\n\t\t},\n\t\t[canvas, selection, saveState],\n\t);\n\n\tconst duplicateSelected = useCallback((): string[] => {\n\t\tif (selection.selectedIds.length === 0) return [];\n\n\t\tsaveState();\n\n\t\tconst selectedElements = canvas.elements.filter((el) =>\n\t\t\tselection.selectedIds.includes(el.id),\n\t\t);\n\n\t\t// Create duplicates with offset\n\t\tconst duplicates = selectedElements.map((el) => ({\n\t\t\t...el,\n\t\t\tid: undefined, // Will be auto-generated\n\t\t\tx: el.x + 20,\n\t\t\ty: el.y + 20,\n\t\t}));\n\n\t\tconst newIds = canvas.addElements(duplicates);\n\t\tselection.selectMultiple(newIds);\n\t\treturn newIds;\n\t}, [canvas, selection, saveState]);\n\n\t// Connection operations\n\tconst addConnection = useCallback(\n\t\t(connection: Omit<Connection, \"id\"> & { id?: string }): string => {\n\t\t\tsaveState();\n\t\t\treturn canvas.addConnection(connection);\n\t\t},\n\t\t[canvas, saveState],\n\t);\n\n\tconst removeConnection = useCallback(\n\t\t(id: string) => {\n\t\t\tsaveState();\n\t\t\tcanvas.removeConnection(id);\n\t\t},\n\t\t[canvas, saveState],\n\t);\n\n\t// Clipboard operations\n\tconst copy = useCallback(() => {\n\t\tif (selection.selectedIds.length === 0) return;\n\n\t\tconst selectedElements = canvas.elements.filter((el) =>\n\t\t\tselection.selectedIds.includes(el.id),\n\t\t);\n\t\tconst selectedIds = new Set(selection.selectedIds);\n\t\tconst relevantConnections = canvas.connections.filter(\n\t\t\t(conn) => selectedIds.has(conn.fromId) && selectedIds.has(conn.toId),\n\t\t);\n\n\t\tclipboardRef.current = {\n\t\t\telements: selectedElements,\n\t\t\tconnections: relevantConnections,\n\t\t};\n\t}, [canvas.elements, canvas.connections, selection.selectedIds]);\n\n\tconst cut = useCallback(() => {\n\t\tcopy();\n\t\tremoveSelected();\n\t}, [copy, removeSelected]);\n\n\tconst paste = useCallback(() => {\n\t\tif (!clipboardRef.current) return;\n\n\t\tsaveState();\n\n\t\t// Create ID mapping for connections\n\t\tconst idMap = new Map<string, string>();\n\n\t\t// Paste elements with offset and new IDs\n\t\tconst newElements = clipboardRef.current.elements.map((el) => ({\n\t\t\t...el,\n\t\t\tid: undefined,\n\t\t\tx: el.x + 20,\n\t\t\ty: el.y + 20,\n\t\t}));\n\n\t\tconst newIds = canvas.addElements(newElements);\n\n\t\t// Map old IDs to new IDs\n\t\tclipboardRef.current.elements.forEach((el, i) => {\n\t\t\tidMap.set(el.id, newIds[i]);\n\t\t});\n\n\t\t// Paste connections with updated IDs\n\t\tclipboardRef.current.connections.forEach((conn) => {\n\t\t\tconst newFromId = idMap.get(conn.fromId);\n\t\t\tconst newToId = idMap.get(conn.toId);\n\t\t\tif (newFromId && newToId) {\n\t\t\t\tcanvas.addConnection({\n\t\t\t\t\t...conn,\n\t\t\t\t\tid: undefined,\n\t\t\t\t\tfromId: newFromId,\n\t\t\t\t\ttoId: newToId,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tselection.selectMultiple(newIds);\n\t}, [canvas, selection, saveState]);\n\n\t// History operations\n\tconst undo = useCallback(() => {\n\t\tif (!history.canUndo) return;\n\t\thistory.undo();\n\t\tcanvas.loadState(history.present.elements, history.present.connections);\n\t}, [history, canvas]);\n\n\tconst redo = useCallback(() => {\n\t\tif (!history.canRedo) return;\n\t\thistory.redo();\n\t\tcanvas.loadState(history.present.elements, history.present.connections);\n\t}, [history, canvas]);\n\n\treturn {\n\t\taddElement,\n\t\tupdateElement,\n\t\tremoveElement,\n\t\tremoveSelected,\n\t\tmoveSelected,\n\t\tduplicateSelected,\n\t\taddConnection,\n\t\tremoveConnection,\n\t\tcopy,\n\t\tcut,\n\t\tpaste,\n\t\thasCopied: clipboardRef.current !== null,\n\t\tundo,\n\t\tredo,\n\t\tcanUndo: history.canUndo,\n\t\tcanRedo: history.canRedo,\n\t};\n};\n\nexport default useCanvasActions;\n","// ElementBase component\n// Base wrapper for all canvas elements with common functionality\n\nimport React, { forwardRef, useCallback, useMemo } from 'react';\nimport type { CanvasElement } from '@/types/elements';\nimport { useSelectable, useDraggable, useResizable, useRotatable } from '@/core/hooks';\nimport { useCanvas, useTheme } from '@/core/context';\nimport { cx, getResizeHandles } from '@/core/utils';\nimport type { ResizeHandle } from '@/core/utils/geometry';\n\nexport interface ElementBaseProps {\n  element: CanvasElement;\n  children: React.ReactNode;\n  className?: string;\n  style?: React.CSSProperties;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onResizeStart?: () => void;\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n  onResizeEnd?: (width: number, height: number, x: number, y: number) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n}\n\nconst HANDLE_SIZE = 8;\nconst ROTATION_HANDLE_OFFSET = 25; // Distance above the element\n\nexport const ElementBase = forwardRef<SVGGElement, ElementBaseProps>(\n  (\n    {\n      element,\n      children,\n      className,\n      style,\n      disabled = false,\n      showHandles = true,\n      enableRotation = true,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onResizeStart,\n      onResize,\n      onResizeEnd,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n    },\n    ref\n  ) => {\n    const { updateElement } = useCanvas();\n    const { theme } = useTheme();\n    const isReadonly = element.locked || disabled;\n\n    // Selection\n    const { isSelected, handlers: selectionHandlers } = useSelectable({\n      id: element.id,\n      disabled: isReadonly,\n      onSelect,\n    });\n\n    // Dragging\n    const { isDragging, dragState, handlers: dragHandlers } = useDraggable({\n      disabled: isReadonly || !isSelected,\n      onDragStart: () => {\n        onDragStart?.();\n      },\n      onDrag: (pos, delta) => {\n        const newX = element.x + delta.x;\n        const newY = element.y + delta.y;\n        onDrag?.(newX, newY);\n      },\n      onDragEnd: (pos, delta) => {\n        const newX = element.x + delta.x;\n        const newY = element.y + delta.y;\n        updateElement(element.id, { x: newX, y: newY });\n        onDragEnd?.(newX, newY);\n      },\n    });\n\n    // Resizing\n    const { isResizing, resizeState, startResize } = useResizable({\n      disabled: isReadonly || !isSelected,\n      minWidth: element.minWidth ?? 20,\n      minHeight: element.minHeight ?? 20,\n      maxWidth: element.maxWidth,\n      maxHeight: element.maxHeight,\n      onResizeStart: () => {\n        onResizeStart?.();\n      },\n      onResize: (bounds) => {\n        onResize?.(bounds.width, bounds.height, bounds.x, bounds.y);\n      },\n      onResizeEnd: (bounds) => {\n        updateElement(element.id, {\n          x: bounds.x,\n          y: bounds.y,\n          width: bounds.width,\n          height: bounds.height,\n        });\n        onResizeEnd?.(bounds.width, bounds.height, bounds.x, bounds.y);\n      },\n    });\n\n    // Rotation\n    const { isRotating, rotateState, startRotate } = useRotatable({\n      disabled: isReadonly || !isSelected || !enableRotation,\n      snapAngle: 15,\n      onRotateStart: () => {\n        onRotateStart?.();\n      },\n      onRotate: (angle) => {\n        onRotate?.(angle);\n      },\n      onRotateEnd: (angle) => {\n        updateElement(element.id, { rotation: angle });\n        onRotateEnd?.(angle);\n      },\n    });\n\n    // Current rotation (accounting for live rotation)\n    const displayRotation = useMemo(() => {\n      if (isRotating && rotateState.currentAngle !== null) {\n        return rotateState.currentAngle;\n      }\n      return element.rotation ?? 0;\n    }, [isRotating, rotateState.currentAngle, element.rotation]);\n\n    // Calculate display bounds (accounting for drag and resize)\n    const displayBounds = useMemo(() => {\n      if (isResizing && resizeState.currentBounds) {\n        return resizeState.currentBounds;\n      }\n      if (isDragging) {\n        return {\n          x: element.x + dragState.delta.x,\n          y: element.y + dragState.delta.y,\n          width: element.width,\n          height: element.height,\n        };\n      }\n      return {\n        x: element.x,\n        y: element.y,\n        width: element.width,\n        height: element.height,\n      };\n    }, [isResizing, resizeState.currentBounds, isDragging, dragState.delta, element.x, element.y, element.width, element.height]);\n\n    // Calculate scale for resize preview\n    const resizeScale = useMemo(() => {\n      if (!isResizing || !resizeState.currentBounds) return { x: 1, y: 1 };\n      return {\n        x: resizeState.currentBounds.width / element.width,\n        y: resizeState.currentBounds.height / element.height,\n      };\n    }, [isResizing, resizeState.currentBounds, element.width, element.height]);\n\n    // Resize handles - use display bounds for correct positioning during resize\n    const handles = useMemo(() => {\n      if (!isSelected || !showHandles || isReadonly) return [];\n      return getResizeHandles(\n        { x: 0, y: 0, width: displayBounds.width, height: displayBounds.height },\n        HANDLE_SIZE\n      );\n    }, [isSelected, showHandles, isReadonly, displayBounds.width, displayBounds.height]);\n\n    // Handle resize start\n    const handleResizeStart = useCallback(\n      (handle: ResizeHandle, e: React.MouseEvent) => {\n        startResize(\n          handle,\n          { x: element.x, y: element.y, width: element.width, height: element.height },\n          e\n        );\n      },\n      [startResize, element]\n    );\n\n    // Handle rotation start\n    const handleRotateStart = useCallback(\n      (e: React.MouseEvent) => {\n        // Center point for rotation (in canvas coordinates)\n        const centerX = displayBounds.x + displayBounds.width / 2;\n        const centerY = displayBounds.y + displayBounds.height / 2;\n        startRotate(\n          { x: centerX, y: centerY },\n          element.rotation ?? 0,\n          e\n        );\n      },\n      [startRotate, displayBounds, element.rotation]\n    );\n\n    // Combined mouse handlers\n    const handleMouseDown = useCallback(\n      (e: React.MouseEvent) => {\n        selectionHandlers.onClick(e);\n        if (isSelected) {\n          dragHandlers.onMouseDown(e);\n        }\n      },\n      [selectionHandlers, dragHandlers, isSelected]\n    );\n\n    // Styles\n    const groupStyle: React.CSSProperties = {\n      cursor: isDragging ? 'grabbing' : isSelected ? 'grab' : 'pointer',\n      opacity: element.visible === false ? 0.5 : 1,\n      ...style,\n    };\n\n    return React.createElement(\n      'g',\n      {\n        ref,\n        className: cx('canvas-element', className, {\n          'canvas-element--selected': isSelected,\n          'canvas-element--dragging': isDragging,\n          'canvas-element--resizing': isResizing,\n          'canvas-element--rotating': isRotating,\n          'canvas-element--locked': element.locked,\n        }),\n        transform: `translate(${displayBounds.x}, ${displayBounds.y})${\n          displayRotation ? ` rotate(${displayRotation}, ${displayBounds.width / 2}, ${displayBounds.height / 2})` : ''\n        }`,\n        style: groupStyle,\n        onMouseDown: handleMouseDown,\n        onTouchStart: dragHandlers.onTouchStart,\n        'data-element-id': element.id,\n        'data-element-type': element.type,\n      },\n      // Element content - scale during resize for visual feedback\n      isResizing\n        ? React.createElement(\n            'g',\n            { transform: `scale(${resizeScale.x}, ${resizeScale.y})` },\n            children\n          )\n        : children,\n\n      // Selection outline - use display bounds for accurate sizing\n      isSelected &&\n        React.createElement('rect', {\n          className: 'canvas-element__selection',\n          x: -2,\n          y: -2,\n          width: displayBounds.width + 4,\n          height: displayBounds.height + 4,\n          fill: 'none',\n          stroke: theme.colors.selection.stroke,\n          strokeWidth: 1,\n          strokeDasharray: '4 2',\n          pointerEvents: 'none',\n        }),\n\n      // Resize handles\n      handles.map((handle) =>\n        React.createElement('rect', {\n          key: handle.position,\n          className: `canvas-element__handle canvas-element__handle--${handle.position}`,\n          x: handle.x,\n          y: handle.y,\n          width: HANDLE_SIZE,\n          height: HANDLE_SIZE,\n          fill: theme.colors.handle.fill,\n          stroke: theme.colors.handle.stroke,\n          strokeWidth: 1,\n          cursor: getCursorForHandle(handle.position),\n          onMouseDown: (e: React.MouseEvent) => handleResizeStart(handle.position, e),\n        })\n      ),\n\n      // Rotation handle (circular, above the element)\n      isSelected && showHandles && enableRotation && !isReadonly &&\n        React.createElement('g', {\n          key: 'rotation-handle',\n          className: 'canvas-element__rotation-handle',\n        },\n          // Line connecting to element\n          React.createElement('line', {\n            x1: displayBounds.width / 2,\n            y1: 0,\n            x2: displayBounds.width / 2,\n            y2: -ROTATION_HANDLE_OFFSET,\n            stroke: theme.colors.selection.stroke,\n            strokeWidth: 1,\n            pointerEvents: 'none',\n          }),\n          // Rotation handle circle\n          React.createElement('circle', {\n            cx: displayBounds.width / 2,\n            cy: -ROTATION_HANDLE_OFFSET,\n            r: HANDLE_SIZE / 2 + 2,\n            fill: theme.colors.handle.fill,\n            stroke: theme.colors.handle.stroke,\n            strokeWidth: 1,\n            cursor: 'grab',\n            onMouseDown: handleRotateStart,\n          })\n        )\n    );\n  }\n);\n\nElementBase.displayName = 'ElementBase';\n\n// Helper to get cursor for resize handle\nfunction getCursorForHandle(position: ResizeHandle): string {\n  const cursors: Record<ResizeHandle, string> = {\n    nw: 'nwse-resize',\n    n: 'ns-resize',\n    ne: 'nesw-resize',\n    e: 'ew-resize',\n    se: 'nwse-resize',\n    s: 'ns-resize',\n    sw: 'nesw-resize',\n    w: 'ew-resize',\n  };\n  return cursors[position];\n}\n\nexport default ElementBase;\n","// withElementBehavior HOC\n// Wraps SVG elements with canvas behavior (selection, drag, resize)\n\nimport React, { ComponentType, forwardRef } from 'react';\nimport type { CanvasElement } from '@/types/elements';\nimport { ElementBase } from './ElementBase';\n\n/**\n * Props that the wrapped component receives\n */\nexport interface ElementRenderProps {\n  element: CanvasElement;\n  isSelected: boolean;\n  isDragging: boolean;\n  isResizing: boolean;\n  isRotating: boolean;\n}\n\n/**\n * Props for the wrapped component with element behavior\n */\nexport interface WithElementBehaviorProps {\n  element: CanvasElement;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onResizeStart?: () => void;\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n  onResizeEnd?: (width: number, height: number, x: number, y: number) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\n/**\n * HOC that wraps a render function with element behavior\n * \n * @example\n * const MyElement = withElementBehavior(({ element }) => (\n *   <rect\n *     width={element.width}\n *     height={element.height}\n *     fill={element.style?.fill ?? '#fff'}\n *   />\n * ));\n */\nexport function withElementBehavior<P extends ElementRenderProps>(\n  RenderComponent: ComponentType<P>\n) {\n  type WrapperProps = WithElementBehaviorProps & Omit<P, keyof ElementRenderProps>;\n  \n  const WrappedComponent = forwardRef<SVGGElement, WrapperProps>((allProps, ref) => {\n    // Destructure with explicit casting to avoid TypeScript inference issues\n    const typedProps = allProps as WrapperProps;\n    const element = typedProps.element;\n    const disabled = typedProps.disabled;\n    const showHandles = typedProps.showHandles;\n    const enableRotation = typedProps.enableRotation;\n    const onSelect = typedProps.onSelect;\n    const onDragStart = typedProps.onDragStart;\n    const onDrag = typedProps.onDrag;\n    const onDragEnd = typedProps.onDragEnd;\n    const onResizeStart = typedProps.onResizeStart;\n    const onResize = typedProps.onResize;\n    const onResizeEnd = typedProps.onResizeEnd;\n    const onRotateStart = typedProps.onRotateStart;\n    const onRotate = typedProps.onRotate;\n    const onRotateEnd = typedProps.onRotateEnd;\n    const className = typedProps.className;\n    const style = typedProps.style;\n    \n    // Remove WithElementBehaviorProps keys to get remaining props for RenderComponent\n    const {\n      element: _e, disabled: _d, showHandles: _sh, enableRotation: _er, onSelect: _os,\n      onDragStart: _ods, onDrag: _od, onDragEnd: _ode,\n      onResizeStart: _ors, onResize: _or, onResizeEnd: _ore,\n      onRotateStart: _orts, onRotate: _ort, onRotateEnd: _orte,\n      className: _c, style: _s,\n      ...rest\n    } = typedProps;\n\n    // Track interaction states via ElementBase\n    const [interactionState, setInteractionState] = React.useState({\n      isSelected: false,\n      isDragging: false,\n      isResizing: false,\n      isRotating: false,\n    });\n\n    const handleSelect = React.useCallback((selected: boolean) => {\n      setInteractionState((prev) => ({ ...prev, isSelected: selected }));\n      onSelect?.(selected);\n    }, [onSelect]);\n\n    const handleDragStart = React.useCallback(() => {\n      setInteractionState((prev) => ({ ...prev, isDragging: true }));\n      onDragStart?.();\n    }, [onDragStart]);\n\n    const handleDragEnd = React.useCallback((x: number, y: number) => {\n      setInteractionState((prev) => ({ ...prev, isDragging: false }));\n      onDragEnd?.(x, y);\n    }, [onDragEnd]);\n\n    const handleResizeStart = React.useCallback(() => {\n      setInteractionState((prev) => ({ ...prev, isResizing: true }));\n      onResizeStart?.();\n    }, [onResizeStart]);\n\n    const handleResizeEnd = React.useCallback((w: number, h: number, x: number, y: number) => {\n      setInteractionState((prev) => ({ ...prev, isResizing: false }));\n      onResizeEnd?.(w, h, x, y);\n    }, [onResizeEnd]);\n\n    const handleRotateStart = React.useCallback(() => {\n      setInteractionState((prev) => ({ ...prev, isRotating: true }));\n      onRotateStart?.();\n    }, [onRotateStart]);\n\n    const handleRotateEnd = React.useCallback((rotation: number) => {\n      setInteractionState((prev) => ({ ...prev, isRotating: false }));\n      onRotateEnd?.(rotation);\n    }, [onRotateEnd]);\n\n    const renderProps = {\n      element,\n      ...interactionState,\n    };\n\n    return (\n      <ElementBase\n        ref={ref}\n        element={element}\n        disabled={disabled}\n        showHandles={showHandles}\n        enableRotation={enableRotation}\n        className={className}\n        style={style}\n        onSelect={handleSelect}\n        onDragStart={handleDragStart}\n        onDrag={onDrag}\n        onDragEnd={handleDragEnd}\n        onResizeStart={handleResizeStart}\n        onResize={onResize}\n        onResizeEnd={handleResizeEnd}\n        onRotateStart={handleRotateStart}\n        onRotate={onRotate}\n        onRotateEnd={handleRotateEnd}\n      >\n        <RenderComponent {...renderProps as P} {...rest} />\n      </ElementBase>\n    );\n  });\n\n  WrappedComponent.displayName = `withElementBehavior(${\n    RenderComponent.displayName || RenderComponent.name || 'Component'\n  })`;\n\n  return WrappedComponent;\n}\n\nexport default withElementBehavior;\n","// Rectangle element component\n\nimport React from 'react';\nimport { withElementBehavior, type ElementRenderProps } from '../withElementBehavior';\nimport { useTheme } from '@/core/context';\n\nexport interface RectangleProps extends ElementRenderProps {}\n\nconst RectangleRender: React.FC<RectangleProps> = ({ element }) => {\n  const { theme } = useTheme();\n  const { width, height, style } = element;\n\n  return React.createElement('rect', {\n    width,\n    height,\n    fill: style?.fill ?? theme.colors.element.fill,\n    stroke: style?.stroke ?? theme.colors.element.stroke,\n    strokeWidth: style?.strokeWidth ?? theme.strokeWidth.normal,\n    rx: style?.cornerRadius ?? 0,\n    ry: style?.cornerRadius ?? 0,\n    opacity: style?.opacity ?? 1,\n  });\n};\n\nexport const Rectangle = withElementBehavior(RectangleRender);\n\nRectangle.displayName = 'Rectangle';\n\nexport default Rectangle;\n","// Ellipse element component (also used for Circle and Oval)\n\nimport React from 'react';\nimport { withElementBehavior, type ElementRenderProps } from '../withElementBehavior';\nimport { useTheme } from '@/core/context';\n\nexport interface EllipseProps extends ElementRenderProps {}\n\nconst EllipseRender: React.FC<EllipseProps> = ({ element }) => {\n  const { theme } = useTheme();\n  const { width, height, style } = element;\n\n  const cx = width / 2;\n  const cy = height / 2;\n  const rx = width / 2;\n  const ry = height / 2;\n\n  return React.createElement('ellipse', {\n    cx,\n    cy,\n    rx,\n    ry,\n    fill: style?.fill ?? theme.colors.element.fill,\n    stroke: style?.stroke ?? theme.colors.element.stroke,\n    strokeWidth: style?.strokeWidth ?? theme.strokeWidth.normal,\n    opacity: style?.opacity ?? 1,\n  });\n};\n\nexport const Ellipse = withElementBehavior(EllipseRender);\n\nEllipse.displayName = 'Ellipse';\n\n/**\n * Circle is an Ellipse with equal width and height\n * Use at component level: <Ellipse element={{ ...element, width: size, height: size }} />\n */\nexport const Circle = Ellipse;\nCircle.displayName = 'Circle';\n\n/**\n * Oval is an alias for Ellipse\n */\nexport const Oval = Ellipse;\nOval.displayName = 'Oval';\n\nexport default Ellipse;\n","// Diamond element component\n\nimport React from 'react';\nimport { withElementBehavior, type ElementRenderProps } from '../withElementBehavior';\nimport { useTheme } from '@/core/context';\n\nexport interface DiamondProps extends ElementRenderProps {}\n\nconst DiamondRender: React.FC<DiamondProps> = ({ element }) => {\n  const { theme } = useTheme();\n  const { width, height, style } = element;\n\n  // Diamond points: top, right, bottom, left\n  const points = [\n    `${width / 2},0`,\n    `${width},${height / 2}`,\n    `${width / 2},${height}`,\n    `0,${height / 2}`,\n  ].join(' ');\n\n  return React.createElement('polygon', {\n    points,\n    fill: style?.fill ?? theme.colors.element.fill,\n    stroke: style?.stroke ?? theme.colors.element.stroke,\n    strokeWidth: style?.strokeWidth ?? theme.strokeWidth.normal,\n    opacity: style?.opacity ?? 1,\n  });\n};\n\nexport const Diamond = withElementBehavior(DiamondRender);\n\nDiamond.displayName = 'Diamond';\n\nexport default Diamond;\n","// Text element component with inline editing support\n\nimport React, { forwardRef, useState, useCallback, useRef, useEffect } from 'react';\nimport { ElementBase } from '../ElementBase';\nimport { useTheme, useCanvas } from '@/core/context';\nimport type { TextElement as TextElementType } from '@/types/elements';\n\nexport interface TextProps {\n  element: TextElementType;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onResizeStart?: () => void;\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n  onResizeEnd?: (width: number, height: number, x: number, y: number) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n  onTextChange?: (text: string) => void;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport const TextElement = forwardRef<SVGGElement, TextProps>(\n  (\n    {\n      element,\n      disabled,\n      showHandles,\n      enableRotation,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onResizeStart,\n      onResize,\n      onResizeEnd,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n      onTextChange,\n      className,\n      style,\n    },\n    ref\n  ) => {\n    const { theme } = useTheme();\n    const { updateElement } = useCanvas();\n    const [isEditing, setIsEditing] = useState(false);\n    const [editText, setEditText] = useState(element.text ?? '');\n    const inputRef = useRef<HTMLTextAreaElement>(null);\n\n    const { width, height, style: elementStyle, text = '', fontSize, fontFamily, fontWeight, textAlign } = element;\n\n    // Measure text dimensions using SVG text element\n    const measureText = useCallback((textContent: string): { width: number; height: number } => {\n      // Create temporary SVG to measure text\n      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n      svg.style.position = 'absolute';\n      svg.style.visibility = 'hidden';\n      svg.style.pointerEvents = 'none';\n      document.body.appendChild(svg);\n\n      const textEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n      textEl.setAttribute('font-size', String(fontSize ?? theme.fontSize.md));\n      textEl.setAttribute('font-family', fontFamily ?? 'sans-serif');\n      textEl.setAttribute('font-weight', fontWeight ?? 'normal');\n      \n      // Handle multi-line text\n      const lines = textContent.split('\\n');\n      const lineHeight = (fontSize ?? theme.fontSize.md) * 1.2;\n      \n      let maxWidth = 0;\n      lines.forEach((line, index) => {\n        const tspan = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');\n        tspan.textContent = line || ' '; // Use space for empty lines\n        tspan.setAttribute('x', '0');\n        tspan.setAttribute('dy', index === 0 ? '0' : String(lineHeight));\n        textEl.appendChild(tspan);\n      });\n      \n      svg.appendChild(textEl);\n      \n      const bbox = textEl.getBBox();\n      maxWidth = bbox.width;\n      const totalHeight = lines.length * lineHeight;\n      \n      document.body.removeChild(svg);\n      \n      // Add padding\n      const padding = 16;\n      return {\n        width: Math.max(maxWidth + padding, 40), // Minimum width\n        height: Math.max(totalHeight + padding, 24), // Minimum height\n      };\n    }, [fontSize, fontFamily, fontWeight, theme.fontSize.md]);\n\n    // Calculate text anchor based on alignment\n    const getTextAnchor = useCallback((): 'start' | 'middle' | 'end' => {\n      switch (textAlign) {\n        case 'right':\n          return 'end';\n        case 'center':\n          return 'middle';\n        default:\n          return 'start';\n      }\n    }, [textAlign]);\n\n    // Calculate x position based on alignment\n    const getXPosition = useCallback((): number => {\n      switch (textAlign) {\n        case 'right':\n          return width;\n        case 'center':\n          return width / 2;\n        default:\n          return 0;\n      }\n    }, [textAlign, width]);\n\n    // Handle double click to start editing\n    const handleDoubleClick = useCallback((e: React.MouseEvent) => {\n      if (element.locked || disabled) return;\n      e.stopPropagation();\n      e.preventDefault();\n      setEditText(text);\n      setIsEditing(true);\n    }, [element.locked, disabled, text]);\n\n    // Save text and exit editing mode, auto-resize to fit text\n    const saveAndExit = useCallback(() => {\n      const trimmedText = editText.trim();\n      if (trimmedText !== text || trimmedText !== '') {\n        // Measure the new text dimensions\n        const newSize = measureText(trimmedText);\n        \n        // Update element with new text and dimensions\n        updateElement(element.id, { \n          text: trimmedText,\n          width: newSize.width,\n          height: newSize.height,\n        } as Partial<TextElementType>);\n        \n        onTextChange?.(trimmedText);\n      }\n      setIsEditing(false);\n    }, [editText, text, measureText, updateElement, element.id, onTextChange]);\n\n    // Cancel editing\n    const cancelEdit = useCallback(() => {\n      setEditText(text);\n      setIsEditing(false);\n    }, [text]);\n\n    // Handle key events in textarea\n    const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        cancelEdit();\n      } else if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        saveAndExit();\n      }\n      // Shift+Enter allows multi-line\n      e.stopPropagation();\n    }, [cancelEdit, saveAndExit]);\n\n    // Focus input when entering edit mode\n    useEffect(() => {\n      if (isEditing && inputRef.current) {\n        inputRef.current.focus();\n        inputRef.current.select();\n      }\n    }, [isEditing]);\n\n    // Render text content\n    const renderContent = () => {\n      if (isEditing) {\n        // Use foreignObject to embed HTML input for editing\n        return React.createElement(\n          'foreignObject',\n          {\n            x: 0,\n            y: 0,\n            width: width,\n            height: height,\n          },\n          React.createElement(\n            'div',\n            {\n              xmlns: 'http://www.w3.org/1999/xhtml',\n              style: {\n                width: '100%',\n                height: '100%',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: textAlign === 'center' ? 'center' : textAlign === 'right' ? 'flex-end' : 'flex-start',\n              },\n            },\n            React.createElement('textarea', {\n              ref: inputRef,\n              value: editText,\n              onChange: (e: React.ChangeEvent<HTMLTextAreaElement>) => setEditText(e.target.value),\n              onBlur: saveAndExit,\n              onKeyDown: handleKeyDown,\n              style: {\n                width: '100%',\n                height: '100%',\n                padding: '4px',\n                border: `2px solid ${theme.colors.selection.stroke}`,\n                borderRadius: '2px',\n                outline: 'none',\n                resize: 'none',\n                backgroundColor: theme.colors.background,\n                color: elementStyle?.fill ?? theme.colors.text.primary,\n                fontSize: fontSize ?? theme.fontSize.md,\n                fontFamily: fontFamily ?? 'sans-serif',\n                fontWeight: fontWeight ?? 'normal',\n                textAlign: textAlign ?? 'left',\n                boxSizing: 'border-box',\n              },\n            })\n          )\n        );\n      }\n\n      // Normal text display\n      return React.createElement(\n        'g',\n        { onDoubleClick: handleDoubleClick },\n        // Background (for selection area)\n        React.createElement('rect', {\n          width,\n          height,\n          fill: 'transparent',\n        }),\n        // Text\n        React.createElement(\n          'text',\n          {\n            x: getXPosition(),\n            y: height / 2,\n            dominantBaseline: 'central',\n            textAnchor: getTextAnchor(),\n            fill: elementStyle?.fill ?? theme.colors.text.primary,\n            fontSize: fontSize ?? theme.fontSize.md,\n            fontFamily: fontFamily ?? 'sans-serif',\n            fontWeight: fontWeight ?? 'normal',\n            opacity: elementStyle?.opacity ?? 1,\n            style: { pointerEvents: 'none' },\n          },\n          text\n        )\n      );\n    };\n\n    return React.createElement(\n      ElementBase,\n      {\n        ref,\n        element,\n        children: renderContent(),\n        disabled: disabled || isEditing, // Disable drag/resize while editing\n        showHandles: showHandles && !isEditing,\n        enableRotation,\n        className,\n        style,\n        onSelect,\n        onDragStart,\n        onDrag,\n        onDragEnd,\n        onResizeStart,\n        onResize,\n        onResizeEnd,\n        onRotateStart,\n        onRotate,\n        onRotateEnd,\n      }\n    );\n  }\n);\n\nTextElement.displayName = 'TextElement';\n\nexport default TextElement;\n","// LineBase component\n// Specialized base wrapper for line elements with endpoint handles\n\nimport React, { forwardRef, useCallback, useMemo, useRef, useState } from 'react';\nimport type { LineElement, Point } from '@/types/elements';\nimport { useSelectable, useDraggable, useRotatable } from '@/core/hooks';\nimport { useCanvas, useTheme, useViewport } from '@/core/context';\nimport { cx } from '@/core/utils';\n\nexport interface LineBaseProps {\n  element: LineElement;\n  children?: React.ReactNode;\n  /** Callback to render with current points during endpoint drag */\n  renderLine: (points: Point[], isEndpointDragging: boolean) => React.ReactNode;\n  className?: string;\n  style?: React.CSSProperties;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onPointsChange?: (points: Point[]) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n}\n\nconst HANDLE_SIZE = 8;\nconst ROTATION_HANDLE_OFFSET = 25;\n\ninterface EndpointDragState {\n  isDragging: boolean;\n  endpointIndex: number | null;\n  startPosition: Point | null;\n  currentPoints: Point[] | null;\n}\n\nexport const LineBase = forwardRef<SVGGElement, LineBaseProps>(\n  (\n    {\n      element,\n      children,\n      renderLine,\n      className,\n      style,\n      disabled = false,\n      showHandles = true,\n      enableRotation = true,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onPointsChange,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n    },\n    ref\n  ) => {\n    const { updateElement } = useCanvas();\n    const { theme } = useTheme();\n    const { screenToCanvas } = useViewport();\n    const isReadonly = element.locked || disabled;\n\n    // Endpoint dragging state\n    const [endpointDrag, setEndpointDrag] = useState<EndpointDragState>({\n      isDragging: false,\n      endpointIndex: null,\n      startPosition: null,\n      currentPoints: null,\n    });\n\n    const endpointDragRef = useRef<{\n      endpointIndex: number;\n      startMousePos: Point;\n      originalPoints: Point[];\n    } | null>(null);\n\n    // Get current points\n    const basePoints = useMemo(() => {\n      return element.points ?? [\n        { x: 0, y: element.height / 2 },\n        { x: element.width, y: element.height / 2 },\n      ];\n    }, [element.points, element.width, element.height]);\n\n    // Selection\n    const { isSelected, handlers: selectionHandlers } = useSelectable({\n      id: element.id,\n      disabled: isReadonly,\n      onSelect,\n    });\n\n    // Dragging (whole line)\n    const { isDragging, dragState, handlers: dragHandlers } = useDraggable({\n      disabled: isReadonly || !isSelected || endpointDrag.isDragging,\n      onDragStart: () => {\n        onDragStart?.();\n      },\n      onDrag: (pos, delta) => {\n        const newX = element.x + delta.x;\n        const newY = element.y + delta.y;\n        onDrag?.(newX, newY);\n      },\n      onDragEnd: (pos, delta) => {\n        const newX = element.x + delta.x;\n        const newY = element.y + delta.y;\n        updateElement(element.id, { x: newX, y: newY });\n        onDragEnd?.(newX, newY);\n      },\n    });\n\n    // Rotation\n    const { isRotating, rotateState, startRotate } = useRotatable({\n      disabled: isReadonly || !isSelected || !enableRotation,\n      snapAngle: 15,\n      onRotateStart: () => {\n        onRotateStart?.();\n      },\n      onRotate: (angle) => {\n        onRotate?.(angle);\n      },\n      onRotateEnd: (angle) => {\n        updateElement(element.id, { rotation: angle });\n        onRotateEnd?.(angle);\n      },\n    });\n\n    // Current display values\n    const displayRotation = useMemo(() => {\n      if (isRotating && rotateState.currentAngle !== null) {\n        return rotateState.currentAngle;\n      }\n      return element.rotation ?? 0;\n    }, [isRotating, rotateState.currentAngle, element.rotation]);\n\n    const displayBounds = useMemo(() => {\n      if (isDragging) {\n        return {\n          x: element.x + dragState.delta.x,\n          y: element.y + dragState.delta.y,\n          width: element.width,\n          height: element.height,\n        };\n      }\n      return {\n        x: element.x,\n        y: element.y,\n        width: element.width,\n        height: element.height,\n      };\n    }, [isDragging, dragState.delta, element.x, element.y, element.width, element.height]);\n\n    // Current points to display (accounting for endpoint drag)\n    const displayPoints = useMemo(() => {\n      if (endpointDrag.isDragging && endpointDrag.currentPoints) {\n        return endpointDrag.currentPoints;\n      }\n      return basePoints;\n    }, [endpointDrag.isDragging, endpointDrag.currentPoints, basePoints]);\n\n    // Endpoint drag handlers\n    const handleEndpointMouseDown = useCallback(\n      (endpointIndex: number, e: React.MouseEvent) => {\n        if (isReadonly || !isSelected) return;\n        \n        e.stopPropagation();\n        e.preventDefault();\n\n        const startPos = screenToCanvas({ x: e.clientX, y: e.clientY });\n        \n        endpointDragRef.current = {\n          endpointIndex,\n          startMousePos: startPos,\n          originalPoints: [...basePoints],\n        };\n\n        setEndpointDrag({\n          isDragging: true,\n          endpointIndex,\n          startPosition: startPos,\n          currentPoints: [...basePoints],\n        });\n\n        // Add global listeners\n        const handleMouseMove = (moveEvent: MouseEvent) => {\n          if (!endpointDragRef.current) return;\n\n          const currentPos = screenToCanvas({ x: moveEvent.clientX, y: moveEvent.clientY });\n          const { endpointIndex: idx, startMousePos, originalPoints } = endpointDragRef.current;\n\n          const deltaX = currentPos.x - startMousePos.x;\n          const deltaY = currentPos.y - startMousePos.y;\n\n          // Create new points array with updated endpoint\n          const newPoints = originalPoints.map((p, i) => {\n            if (i === idx) {\n              return { x: p.x + deltaX, y: p.y + deltaY };\n            }\n            return { ...p };\n          });\n\n          setEndpointDrag(prev => ({\n            ...prev,\n            currentPoints: newPoints,\n          }));\n        };\n\n        const handleMouseUp = () => {\n          if (!endpointDragRef.current) return;\n\n          const currentState = endpointDragRef.current;\n          \n          // Get the final points from state\n          setEndpointDrag(prev => {\n            if (prev.currentPoints) {\n              // Calculate new bounding box from points\n              const points = prev.currentPoints;\n              const xs = points.map(p => p.x);\n              const ys = points.map(p => p.y);\n              const minX = Math.min(...xs);\n              const minY = Math.min(...ys);\n              const maxX = Math.max(...xs);\n              const maxY = Math.max(...ys);\n              \n              // Normalize points relative to new bounding box\n              const normalizedPoints = points.map(p => ({\n                x: p.x - minX,\n                y: p.y - minY,\n              }));\n\n              const newWidth = Math.max(maxX - minX, 1);\n              const newHeight = Math.max(maxY - minY, 1);\n\n              // Update element with new position, size, and normalized points\n              // Cast to any because updateElement expects Partial<CanvasElement> \n              // but points is specific to LineElement\n              updateElement(element.id, {\n                x: element.x + minX,\n                y: element.y + minY,\n                width: newWidth,\n                height: newHeight,\n                points: normalizedPoints,\n              } as Partial<LineElement>);\n\n              onPointsChange?.(normalizedPoints);\n            }\n\n            return {\n              isDragging: false,\n              endpointIndex: null,\n              startPosition: null,\n              currentPoints: null,\n            };\n          });\n\n          endpointDragRef.current = null;\n          document.removeEventListener('mousemove', handleMouseMove);\n          document.removeEventListener('mouseup', handleMouseUp);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n      },\n      [isReadonly, isSelected, basePoints, screenToCanvas, updateElement, element.id, element.x, element.y, onPointsChange]\n    );\n\n    // Handle rotation start - use line center (midpoint between endpoints)\n    const handleRotateStart = useCallback(\n      (e: React.MouseEvent) => {\n        // Calculate true center of the line\n        const p1 = displayPoints[0];\n        const p2 = displayPoints[displayPoints.length - 1];\n        const lineCenterX = (p1.x + p2.x) / 2;\n        const lineCenterY = (p1.y + p2.y) / 2;\n        \n        // Convert to canvas coordinates\n        const centerX = displayBounds.x + lineCenterX;\n        const centerY = displayBounds.y + lineCenterY;\n        \n        startRotate(\n          { x: centerX, y: centerY },\n          element.rotation ?? 0,\n          e\n        );\n      },\n      [startRotate, displayBounds, displayPoints, element.rotation]\n    );\n\n    // Combined mouse handlers\n    const handleMouseDown = useCallback(\n      (e: React.MouseEvent) => {\n        selectionHandlers.onClick(e);\n        if (isSelected && !endpointDrag.isDragging) {\n          dragHandlers.onMouseDown(e);\n        }\n      },\n      [selectionHandlers, dragHandlers, isSelected, endpointDrag.isDragging]\n    );\n\n    // Styles\n    const groupStyle: React.CSSProperties = {\n      cursor: isDragging ? 'grabbing' : isSelected ? 'grab' : 'pointer',\n      opacity: element.visible === false ? 0.5 : 1,\n      ...style,\n    };\n\n    // Calculate endpoint handle positions in local coordinates\n    const handlePositions = useMemo(() => {\n      return displayPoints.map(p => ({ x: p.x, y: p.y }));\n    }, [displayPoints]);\n\n    // Calculate rotation handle position (perpendicular to line direction)\n    const rotationHandlePos = useMemo(() => {\n      if (displayPoints.length < 2) return { cx: 0, cy: 0, x1: 0, y1: 0, x2: 0, y2: 0 };\n      \n      const p1 = displayPoints[0];\n      const p2 = displayPoints[displayPoints.length - 1];\n      \n      // Line center\n      const centerX = (p1.x + p2.x) / 2;\n      const centerY = (p1.y + p2.y) / 2;\n      \n      // Line direction vector\n      const dx = p2.x - p1.x;\n      const dy = p2.y - p1.y;\n      const length = Math.sqrt(dx * dx + dy * dy) || 1;\n      \n      // Perpendicular unit vector (rotate 90 degrees counterclockwise)\n      // This points \"above\" the line in standard orientation\n      const perpX = -dy / length;\n      const perpY = dx / length;\n      \n      // Handle position offset from center\n      const handleX = centerX + perpX * ROTATION_HANDLE_OFFSET;\n      const handleY = centerY + perpY * ROTATION_HANDLE_OFFSET;\n      \n      return {\n        cx: handleX,\n        cy: handleY,\n        x1: centerX,\n        y1: centerY,\n        x2: handleX,\n        y2: handleY,\n      };\n    }, [displayPoints]);\n\n    return React.createElement(\n      'g',\n      {\n        ref,\n        className: cx('canvas-element canvas-line', className, {\n          'canvas-element--selected': isSelected,\n          'canvas-element--dragging': isDragging,\n          'canvas-element--endpoint-dragging': endpointDrag.isDragging,\n          'canvas-element--rotating': isRotating,\n          'canvas-element--locked': element.locked,\n        }),\n        transform: `translate(${displayBounds.x}, ${displayBounds.y})${\n          displayRotation ? ` rotate(${displayRotation}, ${displayBounds.width / 2}, ${displayBounds.height / 2})` : ''\n        }`,\n        style: groupStyle,\n        onMouseDown: handleMouseDown,\n        onTouchStart: dragHandlers.onTouchStart,\n        'data-element-id': element.id,\n        'data-element-type': element.type,\n      },\n      // Render line with current points\n      renderLine(displayPoints, endpointDrag.isDragging),\n\n      // Endpoint handles (only when selected)\n      isSelected && showHandles && !isReadonly &&\n        handlePositions.map((pos, index) =>\n          React.createElement('circle', {\n            key: `endpoint-handle-${index}`,\n            className: 'canvas-line__endpoint-handle',\n            cx: pos.x,\n            cy: pos.y,\n            r: HANDLE_SIZE / 2 + 2,\n            fill: theme.colors.handle.fill,\n            stroke: theme.colors.handle.stroke,\n            strokeWidth: 1.5,\n            cursor: 'move',\n            onMouseDown: (e: React.MouseEvent) => handleEndpointMouseDown(index, e),\n          })\n        ),\n\n      // Rotation handle (perpendicular to line direction)\n      isSelected && showHandles && enableRotation && !isReadonly &&\n        React.createElement('g', {\n          key: 'rotation-handle',\n          className: 'canvas-line__rotation-handle',\n        },\n          // Line connecting to element center\n          React.createElement('line', {\n            x1: rotationHandlePos.x1,\n            y1: rotationHandlePos.y1,\n            x2: rotationHandlePos.x2,\n            y2: rotationHandlePos.y2,\n            stroke: theme.colors.selection.stroke,\n            strokeWidth: 1,\n            pointerEvents: 'none',\n          }),\n          // Rotation handle circle\n          React.createElement('circle', {\n            cx: rotationHandlePos.cx,\n            cy: rotationHandlePos.cy,\n            r: HANDLE_SIZE / 2 + 2,\n            fill: theme.colors.handle.fill,\n            stroke: theme.colors.handle.stroke,\n            strokeWidth: 1,\n            cursor: 'grab',\n            onMouseDown: handleRotateStart,\n          })\n        )\n    );\n  }\n);\n\nLineBase.displayName = 'LineBase';\n\nexport default LineBase;\n","// Line element component\n// Uses LineBase for specialized endpoint-based resizing instead of standard 8-handle resize\n\nimport React, { forwardRef, useCallback } from 'react';\nimport { LineBase } from '../LineBase';\nimport { useTheme } from '@/core/context';\nimport type { LineElement as LineElementType, Point } from '@/types/elements';\n\nexport interface LineProps {\n  element: LineElementType;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onPointsChange?: (points: Point[]) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport const Line = forwardRef<SVGGElement, LineProps>(\n  (\n    {\n      element,\n      disabled,\n      showHandles,\n      enableRotation,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onPointsChange,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n      className,\n      style,\n    },\n    ref\n  ) => {\n    const { theme } = useTheme();\n    const { style: elementStyle, lineType = 'solid' } = element;\n\n    // Get stroke dasharray based on line type\n    const getStrokeDasharray = useCallback((): string | undefined => {\n      switch (lineType) {\n        case 'dashed':\n          return '8 4';\n        case 'dotted':\n          return '2 2';\n        default:\n          return undefined;\n      }\n    }, [lineType]);\n\n    const strokeColor = elementStyle?.stroke ?? theme.colors.element.stroke;\n    const strokeWidth = elementStyle?.strokeWidth ?? theme.strokeWidth.normal;\n\n    // Render function for the line itself\n    const renderLine = useCallback((points: Point[], isEndpointDragging: boolean) => {\n      // Build path from points\n      const pathData = points\n        .map((point, index) => (index === 0 ? `M ${point.x} ${point.y}` : `L ${point.x} ${point.y}`))\n        .join(' ');\n\n      return React.createElement(\n        'g',\n        null,\n        // Invisible wider path for easier selection (follows the line shape)\n        React.createElement('path', {\n          d: pathData,\n          fill: 'none',\n          stroke: 'transparent',\n          strokeWidth: 20, // Wide hit area\n          strokeLinecap: 'round',\n        }),\n        // Visible line\n        React.createElement('path', {\n          d: pathData,\n          fill: 'none',\n          stroke: strokeColor,\n          strokeWidth: strokeWidth,\n          strokeDasharray: getStrokeDasharray(),\n          strokeLinecap: 'round',\n          strokeLinejoin: 'round',\n          opacity: elementStyle?.opacity ?? 1,\n        })\n      );\n    }, [strokeColor, strokeWidth, getStrokeDasharray, elementStyle?.opacity]);\n\n    return React.createElement(LineBase, {\n      ref,\n      element,\n      disabled,\n      showHandles,\n      enableRotation,\n      className,\n      style,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onPointsChange,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n      renderLine,\n    });\n  }\n);\n\nLine.displayName = 'Line';\n\nexport default Line;\n","// Actor element component (UML stick figure) with inline label editing\n\nimport React, { forwardRef, useState, useCallback, useRef, useEffect } from 'react';\nimport { ElementBase } from '../ElementBase';\nimport { useTheme, useCanvas } from '@/core/context';\nimport type { ActorElement as ActorElementType } from '@/types/elements';\n\nexport interface ActorProps {\n  element: ActorElementType;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onResizeStart?: () => void;\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n  onResizeEnd?: (width: number, height: number, x: number, y: number) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n  onLabelChange?: (label: string) => void;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport const Actor = forwardRef<SVGGElement, ActorProps>(\n  (\n    {\n      element,\n      disabled,\n      showHandles,\n      enableRotation,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onResizeStart,\n      onResize,\n      onResizeEnd,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n      onLabelChange,\n      className,\n      style: propStyle,\n    },\n    ref\n  ) => {\n    const { theme } = useTheme();\n    const { updateElement } = useCanvas();\n    const [isEditing, setIsEditing] = useState(false);\n    const [editLabel, setEditLabel] = useState(element.label ?? '');\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    const { width, height, style, label } = element;\n\n    // Actor proportions\n    const headRadius = Math.min(width, height) * 0.15;\n    const centerX = width / 2;\n    const bodyTop = headRadius * 2 + 4;\n    const bodyBottom = height * 0.6;\n    const armY = bodyTop + (bodyBottom - bodyTop) * 0.3;\n    const armSpan = width * 0.4;\n    const legSpan = width * 0.35;\n    const labelY = height - 4;\n\n    const strokeColor = style?.stroke ?? theme.colors.element.stroke;\n    const strokeWidth = style?.strokeWidth ?? theme.strokeWidth.normal;\n\n    // Handle double click to start editing\n    const handleDoubleClick = useCallback((e: React.MouseEvent) => {\n      if (element.locked || disabled) return;\n      e.stopPropagation();\n      e.preventDefault();\n      setEditLabel(label ?? '');\n      setIsEditing(true);\n    }, [element.locked, disabled, label]);\n\n    // Save and exit editing\n    const saveAndExit = useCallback(() => {\n      const trimmedLabel = editLabel.trim();\n      if (trimmedLabel !== label) {\n        updateElement(element.id, { label: trimmedLabel } as Partial<ActorElementType>);\n        onLabelChange?.(trimmedLabel);\n      }\n      setIsEditing(false);\n    }, [editLabel, label, updateElement, element.id, onLabelChange]);\n\n    // Cancel editing\n    const cancelEdit = useCallback(() => {\n      setEditLabel(label ?? '');\n      setIsEditing(false);\n    }, [label]);\n\n    // Handle key events\n    const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        cancelEdit();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        saveAndExit();\n      }\n      e.stopPropagation();\n    }, [cancelEdit, saveAndExit]);\n\n    // Focus input when editing\n    useEffect(() => {\n      if (isEditing && inputRef.current) {\n        inputRef.current.focus();\n        inputRef.current.select();\n      }\n    }, [isEditing]);\n\n    const renderContent = () => {\n      return React.createElement(\n        'g',\n        { onDoubleClick: handleDoubleClick },\n        // Invisible background for selection\n        React.createElement('rect', {\n          width,\n          height,\n          fill: 'transparent',\n        }),\n\n        // Head (circle)\n        React.createElement('circle', {\n          cx: centerX,\n          cy: headRadius + 2,\n          r: headRadius,\n          fill: style?.fill ?? 'none',\n          stroke: strokeColor,\n          strokeWidth,\n        }),\n\n        // Body (vertical line)\n        React.createElement('line', {\n          x1: centerX,\n          y1: bodyTop,\n          x2: centerX,\n          y2: bodyBottom,\n          stroke: strokeColor,\n          strokeWidth,\n        }),\n\n        // Arms (horizontal line)\n        React.createElement('line', {\n          x1: centerX - armSpan,\n          y1: armY,\n          x2: centerX + armSpan,\n          y2: armY,\n          stroke: strokeColor,\n          strokeWidth,\n        }),\n\n        // Left leg\n        React.createElement('line', {\n          x1: centerX,\n          y1: bodyBottom,\n          x2: centerX - legSpan,\n          y2: height * 0.85,\n          stroke: strokeColor,\n          strokeWidth,\n        }),\n\n        // Right leg\n        React.createElement('line', {\n          x1: centerX,\n          y1: bodyBottom,\n          x2: centerX + legSpan,\n          y2: height * 0.85,\n          stroke: strokeColor,\n          strokeWidth,\n        }),\n\n        // Label - either input or text\n        isEditing\n          ? React.createElement(\n              'foreignObject',\n              {\n                x: 0,\n                y: labelY - 16,\n                width: width,\n                height: 24,\n              },\n              React.createElement('input', {\n                ref: inputRef,\n                type: 'text',\n                value: editLabel,\n                onChange: (e: React.ChangeEvent<HTMLInputElement>) => setEditLabel(e.target.value),\n                onBlur: saveAndExit,\n                onKeyDown: handleKeyDown,\n                style: {\n                  width: '100%',\n                  height: '100%',\n                  padding: '2px 4px',\n                  border: `2px solid ${theme.colors.selection.stroke}`,\n                  borderRadius: '2px',\n                  outline: 'none',\n                  backgroundColor: theme.colors.background,\n                  color: theme.colors.text.primary,\n                  fontSize: theme.fontSize.sm,\n                  fontFamily: 'sans-serif',\n                  textAlign: 'center',\n                  boxSizing: 'border-box',\n                },\n              })\n            )\n          : label &&\n            React.createElement(\n              'text',\n              {\n                x: centerX,\n                y: labelY,\n                textAnchor: 'middle',\n                dominantBaseline: 'text-bottom',\n                fill: style?.fill ?? theme.colors.text.primary,\n                fontSize: theme.fontSize.sm,\n                fontFamily: 'sans-serif',\n                style: { pointerEvents: 'none' },\n              },\n              label\n            )\n      );\n    };\n\n    return React.createElement(\n      ElementBase,\n      {\n        ref,\n        element,\n        children: renderContent(),\n        disabled: disabled || isEditing,\n        showHandles: showHandles && !isEditing,\n        enableRotation,\n        className,\n        style: propStyle,\n        onSelect,\n        onDragStart,\n        onDrag,\n        onDragEnd,\n        onResizeStart,\n        onResize,\n        onResizeEnd,\n        onRotateStart,\n        onRotate,\n        onRotateEnd,\n      }\n    );\n  }\n);\n\nActor.displayName = 'Actor';\n\nexport default Actor;\n","// Lifeline element component (UML sequence diagram) with inline label editing\n\nimport React, { forwardRef, useState, useCallback, useRef, useEffect } from 'react';\nimport { ElementBase } from '../ElementBase';\nimport { useTheme, useCanvas } from '@/core/context';\nimport type { LifelineElement as LifelineElementType } from '@/types/elements';\n\nexport interface LifelineProps {\n  element: LifelineElementType;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onResizeStart?: () => void;\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n  onResizeEnd?: (width: number, height: number, x: number, y: number) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n  onLabelChange?: (label: string) => void;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport const Lifeline = forwardRef<SVGGElement, LifelineProps>(\n  (\n    {\n      element,\n      disabled,\n      showHandles,\n      enableRotation,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onResizeStart,\n      onResize,\n      onResizeEnd,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n      onLabelChange,\n      className,\n      style: propStyle,\n    },\n    ref\n  ) => {\n    const { theme } = useTheme();\n    const { updateElement } = useCanvas();\n    const [isEditing, setIsEditing] = useState(false);\n    const [editLabel, setEditLabel] = useState(element.label ?? '');\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    const { width, height, style, label } = element;\n\n    const centerX = width / 2;\n    const headerHeight = 40;\n    const strokeColor = style?.stroke ?? theme.colors.element.stroke;\n    const strokeWidth = style?.strokeWidth ?? theme.strokeWidth.normal;\n\n    // Handle double click to start editing\n    const handleDoubleClick = useCallback((e: React.MouseEvent) => {\n      if (element.locked || disabled) return;\n      e.stopPropagation();\n      e.preventDefault();\n      setEditLabel(label ?? '');\n      setIsEditing(true);\n    }, [element.locked, disabled, label]);\n\n    // Save and exit editing\n    const saveAndExit = useCallback(() => {\n      const trimmedLabel = editLabel.trim();\n      if (trimmedLabel !== label) {\n        updateElement(element.id, { label: trimmedLabel } as Partial<LifelineElementType>);\n        onLabelChange?.(trimmedLabel);\n      }\n      setIsEditing(false);\n    }, [editLabel, label, updateElement, element.id, onLabelChange]);\n\n    // Cancel editing\n    const cancelEdit = useCallback(() => {\n      setEditLabel(label ?? '');\n      setIsEditing(false);\n    }, [label]);\n\n    // Handle key events\n    const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        cancelEdit();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        saveAndExit();\n      }\n      e.stopPropagation();\n    }, [cancelEdit, saveAndExit]);\n\n    // Focus input when editing\n    useEffect(() => {\n      if (isEditing && inputRef.current) {\n        inputRef.current.focus();\n        inputRef.current.select();\n      }\n    }, [isEditing]);\n\n    const renderContent = () => {\n      return React.createElement(\n        'g',\n        { onDoubleClick: handleDoubleClick },\n        // Header box\n        React.createElement('rect', {\n          x: 0,\n          y: 0,\n          width,\n          height: headerHeight,\n          fill: style?.fill ?? theme.colors.element.fill,\n          stroke: strokeColor,\n          strokeWidth,\n        }),\n\n        // Label - either input or text\n        isEditing\n          ? React.createElement(\n              'foreignObject',\n              {\n                x: 4,\n                y: (headerHeight - 24) / 2,\n                width: width - 8,\n                height: 24,\n              },\n              React.createElement('input', {\n                ref: inputRef,\n                type: 'text',\n                value: editLabel,\n                onChange: (e: React.ChangeEvent<HTMLInputElement>) => setEditLabel(e.target.value),\n                onBlur: saveAndExit,\n                onKeyDown: handleKeyDown,\n                style: {\n                  width: '100%',\n                  height: '100%',\n                  padding: '2px 4px',\n                  border: `2px solid ${theme.colors.selection.stroke}`,\n                  borderRadius: '2px',\n                  outline: 'none',\n                  backgroundColor: theme.colors.background,\n                  color: theme.colors.text.primary,\n                  fontSize: theme.fontSize.sm,\n                  fontFamily: 'sans-serif',\n                  textAlign: 'center',\n                  boxSizing: 'border-box',\n                },\n              })\n            )\n          : label &&\n            React.createElement(\n              'text',\n              {\n                x: centerX,\n                y: headerHeight / 2,\n                textAnchor: 'middle',\n                dominantBaseline: 'central',\n                fill: theme.colors.text.primary,\n                fontSize: theme.fontSize.sm,\n                fontFamily: 'sans-serif',\n                style: { pointerEvents: 'none' },\n              },\n              label\n            ),\n\n        // Dashed lifeline\n        React.createElement('line', {\n          x1: centerX,\n          y1: headerHeight,\n          x2: centerX,\n          y2: height,\n          stroke: strokeColor,\n          strokeWidth,\n          strokeDasharray: '8 4',\n        })\n      );\n    };\n\n    return React.createElement(\n      ElementBase,\n      {\n        ref,\n        element,\n        children: renderContent(),\n        disabled: disabled || isEditing,\n        showHandles: showHandles && !isEditing,\n        enableRotation,\n        className,\n        style: propStyle,\n        onSelect,\n        onDragStart,\n        onDrag,\n        onDragEnd,\n        onResizeStart,\n        onResize,\n        onResizeEnd,\n        onRotateStart,\n        onRotate,\n        onRotateEnd,\n      }\n    );\n  }\n);\n\nLifeline.displayName = 'Lifeline';\n\nexport default Lifeline;\n","// Message element component (UML sequence diagram arrow) with inline label editing\n\nimport React, { forwardRef, useState, useCallback, useRef, useEffect } from 'react';\nimport { ElementBase } from '../ElementBase';\nimport { useTheme, useCanvas } from '@/core/context';\nimport type { MessageElement as MessageElementType } from '@/types/elements';\n\nexport interface MessageProps {\n  element: MessageElementType;\n  disabled?: boolean;\n  showHandles?: boolean;\n  enableRotation?: boolean;\n  onSelect?: (selected: boolean) => void;\n  onDragStart?: () => void;\n  onDrag?: (x: number, y: number) => void;\n  onDragEnd?: (x: number, y: number) => void;\n  onResizeStart?: () => void;\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n  onResizeEnd?: (width: number, height: number, x: number, y: number) => void;\n  onRotateStart?: () => void;\n  onRotate?: (rotation: number) => void;\n  onRotateEnd?: (rotation: number) => void;\n  onLabelChange?: (label: string) => void;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport const Message = forwardRef<SVGGElement, MessageProps>(\n  (\n    {\n      element,\n      disabled,\n      showHandles,\n      enableRotation,\n      onSelect,\n      onDragStart,\n      onDrag,\n      onDragEnd,\n      onResizeStart,\n      onResize,\n      onResizeEnd,\n      onRotateStart,\n      onRotate,\n      onRotateEnd,\n      onLabelChange,\n      className,\n      style: propStyle,\n    },\n    ref\n  ) => {\n    const { theme } = useTheme();\n    const { updateElement } = useCanvas();\n    const [isEditing, setIsEditing] = useState(false);\n    const [editLabel, setEditLabel] = useState(element.label ?? '');\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    const { width, height, style, label, messageType = 'sync' } = element;\n\n    const strokeColor = style?.stroke ?? theme.colors.connection.line;\n    const strokeWidth = style?.strokeWidth ?? theme.strokeWidth.normal;\n    const arrowSize = 10;\n\n    // Line from left to right\n    const y = height / 2;\n\n    // Handle double click to start editing\n    const handleDoubleClick = useCallback((e: React.MouseEvent) => {\n      if (element.locked || disabled) return;\n      e.stopPropagation();\n      e.preventDefault();\n      setEditLabel(label ?? '');\n      setIsEditing(true);\n    }, [element.locked, disabled, label]);\n\n    // Save and exit editing\n    const saveAndExit = useCallback(() => {\n      const trimmedLabel = editLabel.trim();\n      if (trimmedLabel !== label) {\n        updateElement(element.id, { label: trimmedLabel } as Partial<MessageElementType>);\n        onLabelChange?.(trimmedLabel);\n      }\n      setIsEditing(false);\n    }, [editLabel, label, updateElement, element.id, onLabelChange]);\n\n    // Cancel editing\n    const cancelEdit = useCallback(() => {\n      setEditLabel(label ?? '');\n      setIsEditing(false);\n    }, [label]);\n\n    // Handle key events\n    const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        cancelEdit();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        saveAndExit();\n      }\n      e.stopPropagation();\n    }, [cancelEdit, saveAndExit]);\n\n    // Focus input when editing\n    useEffect(() => {\n      if (isEditing && inputRef.current) {\n        inputRef.current.focus();\n        inputRef.current.select();\n      }\n    }, [isEditing]);\n\n    // Get stroke style based on message type\n    const getStrokeDasharray = (): string | undefined => {\n      switch (messageType) {\n        case 'return':\n          return '8 4';\n        case 'create':\n          return '4 2';\n        default:\n          return undefined;\n      }\n    };\n\n    // Get arrow marker\n    const renderArrow = () => {\n      if (messageType === 'async') {\n        // Open arrow\n        return React.createElement('polyline', {\n          points: `${width - arrowSize},${y - arrowSize / 2} ${width},${y} ${width - arrowSize},${y + arrowSize / 2}`,\n          fill: 'none',\n          stroke: strokeColor,\n          strokeWidth,\n        });\n      }\n\n      // Filled arrow for sync and others\n      return React.createElement('polygon', {\n        points: `${width},${y} ${width - arrowSize},${y - arrowSize / 2} ${width - arrowSize},${y + arrowSize / 2}`,\n        fill: strokeColor,\n        stroke: strokeColor,\n        strokeWidth: 1,\n      });\n    };\n\n    const renderContent = () => {\n      return React.createElement(\n        'g',\n        { onDoubleClick: handleDoubleClick },\n        // Invisible background for selection\n        React.createElement('rect', {\n          width,\n          height,\n          fill: 'transparent',\n        }),\n\n        // Main line\n        React.createElement('line', {\n          x1: 0,\n          y1: y,\n          x2: width - (messageType === 'async' ? 0 : arrowSize / 2),\n          y2: y,\n          stroke: strokeColor,\n          strokeWidth,\n          strokeDasharray: getStrokeDasharray(),\n        }),\n\n        // Arrow head\n        renderArrow(),\n\n        // Label - either input or text\n        isEditing\n          ? React.createElement(\n              'foreignObject',\n              {\n                x: width / 4,\n                y: y - 24,\n                width: width / 2,\n                height: 20,\n              },\n              React.createElement('input', {\n                ref: inputRef,\n                type: 'text',\n                value: editLabel,\n                onChange: (e: React.ChangeEvent<HTMLInputElement>) => setEditLabel(e.target.value),\n                onBlur: saveAndExit,\n                onKeyDown: handleKeyDown,\n                style: {\n                  width: '100%',\n                  height: '100%',\n                  padding: '2px 4px',\n                  border: `2px solid ${theme.colors.selection.stroke}`,\n                  borderRadius: '2px',\n                  outline: 'none',\n                  backgroundColor: theme.colors.background,\n                  color: theme.colors.text.primary,\n                  fontSize: theme.fontSize.sm,\n                  fontFamily: 'sans-serif',\n                  textAlign: 'center',\n                  boxSizing: 'border-box',\n                },\n              })\n            )\n          : label &&\n            React.createElement(\n              'text',\n              {\n                x: width / 2,\n                y: y - 8,\n                textAnchor: 'middle',\n                dominantBaseline: 'text-bottom',\n                fill: theme.colors.text.primary,\n                fontSize: theme.fontSize.sm,\n                fontFamily: 'sans-serif',\n                style: { pointerEvents: 'none' },\n              },\n              label\n            )\n      );\n    };\n\n    return React.createElement(\n      ElementBase,\n      {\n        ref,\n        element,\n        children: renderContent(),\n        disabled: disabled || isEditing,\n        showHandles: showHandles && !isEditing,\n        enableRotation,\n        className,\n        style: propStyle,\n        onSelect,\n        onDragStart,\n        onDrag,\n        onDragEnd,\n        onResizeStart,\n        onResize,\n        onResizeEnd,\n        onRotateStart,\n        onRotate,\n        onRotateEnd,\n      }\n    );\n  }\n);\n\nMessage.displayName = 'Message';\n\nexport default Message;\n","// ActivationBar element component (UML sequence diagram activation)\n\nimport React from 'react';\nimport { withElementBehavior, type ElementRenderProps } from '../withElementBehavior';\nimport { useTheme } from '@/core/context';\n\nexport interface ActivationBarProps extends ElementRenderProps {}\n\nconst ActivationBarRender: React.FC<ActivationBarProps> = ({ element }) => {\n  const { theme } = useTheme();\n  const { width, height, style } = element;\n\n  return React.createElement('rect', {\n    width: width || 12, // Default narrow width\n    height,\n    fill: style?.fill ?? theme.colors.element.fill,\n    stroke: style?.stroke ?? theme.colors.element.stroke,\n    strokeWidth: style?.strokeWidth ?? theme.strokeWidth.normal,\n  });\n};\n\nexport const ActivationBar = withElementBehavior(ActivationBarRender);\n\nActivationBar.displayName = 'ActivationBar';\n\nexport default ActivationBar;\n","// DrawingCanvas component\n// SVG container that renders all canvas elements\n\nimport React, { forwardRef, useCallback, useMemo } from 'react';\nimport type { CanvasElement, ElementType } from '@/types/elements';\nimport { useCanvas, useSelection, useViewport, useTheme } from '@/core/context';\nimport { cx, sortByZIndex } from '@/core/utils';\n\n// Element components map\nimport { Rectangle, Ellipse, Diamond, TextElement, Line } from '@/elements/shapes';\nimport { Actor, Lifeline, Message, ActivationBar } from '@/elements/uml';\n\nexport interface DrawingCanvasProps {\n  width?: number;\n  height?: number;\n  className?: string;\n  style?: React.CSSProperties;\n  showGrid?: boolean;\n  gridSize?: number;\n  onCanvasClick?: (e: React.MouseEvent) => void;\n  onCanvasDoubleClick?: (e: React.MouseEvent) => void;\n  children?: React.ReactNode;\n}\n\n// Map element types to components\nconst elementComponents: Record<ElementType, React.ComponentType<any>> = {\n  rectangle: Rectangle,\n  ellipse: Ellipse,\n  circle: Ellipse,\n  diamond: Diamond,\n  text: TextElement,\n  line: Line,\n  actor: Actor,\n  lifeline: Lifeline,\n  message: Message,\n  activationBar: ActivationBar,\n  // Default fallback for custom types\n  custom: Rectangle,\n};\n\nexport const DrawingCanvas = forwardRef<SVGSVGElement, DrawingCanvasProps>(\n  (\n    {\n      width: propWidth,\n      height: propHeight,\n      className,\n      style,\n      showGrid: propShowGrid,\n      gridSize: propGridSize,\n      onCanvasClick,\n      onCanvasDoubleClick,\n      children,\n    },\n    ref\n  ) => {\n    const { elements, config } = useCanvas();\n    const { clearSelection } = useSelection();\n    const { viewport } = useViewport();\n    const { theme } = useTheme();\n\n    const width = propWidth ?? config.width;\n    const height = propHeight ?? config.height;\n    const showGrid = propShowGrid ?? config.grid?.visible;\n    const gridSize = propGridSize ?? config.grid?.size ?? 20;\n\n    // Sort elements by z-index\n    const sortedElements = useMemo(() => sortByZIndex(elements), [elements]);\n\n    // Handle mousedown on canvas background (deselect)\n    const handleBackgroundMouseDown = useCallback(\n      (e: React.MouseEvent) => {\n        // Only deselect on direct click, not during drag operations\n        // stopPropagation from elements prevents this from firing on element clicks\n        clearSelection();\n        onCanvasClick?.(e);\n      },\n      [clearSelection, onCanvasClick]\n    );\n\n    // Render grid pattern\n    const renderGrid = () => {\n      if (!showGrid) return null;\n\n      const patternId = 'canvas-grid-pattern';\n\n      return React.createElement(\n        React.Fragment,\n        null,\n        React.createElement(\n          'defs',\n          null,\n          React.createElement(\n            'pattern',\n            {\n              id: patternId,\n              width: gridSize,\n              height: gridSize,\n              patternUnits: 'userSpaceOnUse',\n            },\n            React.createElement('path', {\n              d: `M ${gridSize} 0 L 0 0 0 ${gridSize}`,\n              fill: 'none',\n              stroke: theme.colors.grid.line,\n              strokeWidth: 0.5,\n            })\n          )\n        ),\n        React.createElement('rect', {\n          width: '100%',\n          height: '100%',\n          fill: `url(#${patternId})`,\n          pointerEvents: 'none', // Let clicks pass through to background\n        })\n      );\n    };\n\n    // Render background rect for capturing clicks on empty areas\n    const renderBackground = () => {\n      return React.createElement('rect', {\n        className: 'canvas-background',\n        width: '100%',\n        height: '100%',\n        fill: 'transparent',\n        onMouseDown: handleBackgroundMouseDown,\n      });\n    };\n\n    // Render a single element\n    const renderElement = (element: CanvasElement) => {\n      const Component = elementComponents[element.type] ?? elementComponents.custom;\n\n      return React.createElement(Component, {\n        key: element.id,\n        element,\n      });\n    };\n\n    return React.createElement(\n      'svg',\n      {\n        ref,\n        className: cx('canvas-drawing', className),\n        width,\n        height,\n        viewBox: `0 0 ${width} ${height}`,\n        style: {\n          backgroundColor: theme.colors.background,\n          cursor: 'default',\n          userSelect: 'none',\n          ...style,\n        },\n        onDoubleClick: onCanvasDoubleClick,\n      },\n      // Transform group for zoom and pan\n      React.createElement(\n        'g',\n        {\n          transform: `translate(${viewport.pan.x}, ${viewport.pan.y}) scale(${viewport.zoom})`,\n        },\n        // Background rect for capturing clicks on empty areas\n        renderBackground(),\n\n        // Grid (pointer-events: none, so clicks pass through)\n        renderGrid(),\n\n        // Elements\n        sortedElements.map(renderElement),\n\n        // Additional children (e.g., selection boxes, connection handles)\n        children\n      )\n    );\n  }\n);\n\nDrawingCanvas.displayName = 'DrawingCanvas';\n\nexport default DrawingCanvas;\n","// Canvas component\n// Main component that combines providers and drawing canvas\n\nimport React, { forwardRef, useImperativeHandle, useRef, useCallback } from 'react';\nimport type { CanvasElement, Connection, ElementType } from '@/types/elements';\nimport type { CanvasConfig, ViewportState } from '@/types/canvas';\nimport type { Theme } from '@/types/theme';\nimport { CombinedCanvasProvider, useCanvas, useSelection, useViewport } from '@/core/context';\nimport { useCanvasActions, useCanvasKeyboardShortcuts } from '@/core/hooks';\nimport { DrawingCanvas } from './DrawingCanvas';\nimport { cx, deserializeFromJSON, exportToImage } from '@/core/utils';\nimport type { ExportImageOptions, CanvasData } from '@/core/utils';\n\nexport interface CanvasProps {\n  // Data (controlled mode)\n  elements?: CanvasElement[];\n  connections?: Connection[];\n  selectedIds?: string[];\n\n  // Data (uncontrolled mode)\n  defaultElements?: CanvasElement[];\n  defaultConnections?: Connection[];\n\n  // Configuration\n  width?: number;\n  height?: number;\n  config?: Partial<CanvasConfig>;\n  theme?: 'light' | 'dark' | Theme;\n  readonly?: boolean;\n\n  // Viewport settings\n  initialViewport?: Partial<ViewportState>;\n\n  // History settings\n  maxHistorySize?: number;\n\n  // Features\n  showGrid?: boolean;\n  gridSize?: number;\n  enableKeyboardShortcuts?: boolean;\n\n  // Callbacks\n  onChange?: (elements: CanvasElement[], connections: Connection[]) => void;\n  onSelectionChange?: (selectedIds: string[]) => void;\n  onElementAdd?: (element: CanvasElement) => void;\n  onElementUpdate?: (id: string, updates: Partial<CanvasElement>) => void;\n  onElementRemove?: (id: string) => void;\n\n  // Styling\n  className?: string;\n  style?: React.CSSProperties;\n\n  // Children (for custom overlays)\n  children?: React.ReactNode;\n}\n\nexport interface CanvasRef {\n  // Element operations\n  addElement: (element: Omit<CanvasElement, 'id'> & { id?: string }) => string;\n  updateElement: (id: string, updates: Partial<CanvasElement>) => void;\n  removeElement: (id: string) => void;\n  getElement: (id: string) => CanvasElement | undefined;\n  getElementsByType: (type: ElementType) => CanvasElement[];\n\n  // Selection\n  select: (id: string) => void;\n  selectMultiple: (ids: string[]) => void;\n  clearSelection: () => void;\n  getSelectedIds: () => string[];\n\n  // Viewport\n  zoomIn: () => void;\n  zoomOut: () => void;\n  setZoom: (zoom: number) => void;\n  resetViewport: () => void;\n\n  // History\n  undo: () => void;\n  redo: () => void;\n  canUndo: boolean;\n  canRedo: boolean;\n\n  // Export\n  toJSON: () => { elements: CanvasElement[]; connections: Connection[] };\n  toSVG: () => string;\n  toImage: (options?: ExportImageOptions) => Promise<Blob>;\n\n  // Import\n  fromJSON: (json: string) => CanvasData;\n}\n\n// Inner component that uses the contexts\nconst CanvasInner = forwardRef<CanvasRef, CanvasProps>(\n  (\n    {\n      width,\n      height,\n      readonly = false,\n      showGrid,\n      gridSize,\n      enableKeyboardShortcuts = true,\n      className,\n      style,\n      children,\n    },\n    ref\n  ) => {\n    const svgRef = useRef<SVGSVGElement>(null);\n    const canvas = useCanvas();\n    const selection = useSelection();\n    const viewport = useViewport();\n    const actions = useCanvasActions();\n\n    // Keyboard shortcuts\n    useCanvasKeyboardShortcuts(\n      enableKeyboardShortcuts\n        ? {\n            undo: actions.undo,\n            redo: actions.redo,\n            delete: actions.removeSelected,\n            selectAll: () => selection.selectAll(canvas.elements.map((el) => el.id)),\n            copy: actions.copy,\n            paste: actions.paste,\n            cut: actions.cut,\n            escape: selection.clearSelection,\n            zoomIn: viewport.zoomIn,\n            zoomOut: viewport.zoomOut,\n            resetZoom: viewport.resetViewport,\n          }\n        : {}\n    );\n\n    // Expose ref API\n    useImperativeHandle(\n      ref,\n      () => ({\n        addElement: actions.addElement,\n        updateElement: actions.updateElement,\n        removeElement: actions.removeElement,\n        getElement: canvas.getElementById,\n        getElementsByType: canvas.getElementsByType,\n        select: selection.select,\n        selectMultiple: selection.selectMultiple,\n        clearSelection: selection.clearSelection,\n        getSelectedIds: () => selection.selectedIds,\n        zoomIn: viewport.zoomIn,\n        zoomOut: viewport.zoomOut,\n        setZoom: viewport.setZoom,\n        resetViewport: viewport.resetViewport,\n        undo: actions.undo,\n        redo: actions.redo,\n        canUndo: actions.canUndo,\n        canRedo: actions.canRedo,\n        toJSON: () => ({\n          elements: canvas.elements,\n          connections: canvas.connections,\n        }),\n        toSVG: () => svgRef.current?.outerHTML ?? '',\n        toImage: async (options?: ExportImageOptions) => {\n          if (!svgRef.current) {\n            throw new Error('SVG element not available');\n          }\n          return exportToImage(svgRef.current, options);\n        },\n        fromJSON: (json: string) => {\n          const data = deserializeFromJSON(json);\n          canvas.setElements(data.elements);\n          canvas.setConnections(data.connections);\n          selection.clearSelection();\n          return data;\n        },\n      }),\n      [canvas, selection, viewport, actions]\n    );\n\n    return (\n      <div\n        className={cx('canvas-container', className, {\n          'canvas-container--readonly': readonly,\n        })}\n        style={{\n          position: 'relative',\n          overflow: 'hidden',\n          ...style,\n        }}\n        tabIndex={0}\n      >\n        <DrawingCanvas\n          ref={svgRef}\n          width={width}\n          height={height}\n          showGrid={showGrid}\n          gridSize={gridSize}\n        />\n        {children}\n      </div>\n    );\n  }\n);\n\nCanvasInner.displayName = 'CanvasInner';\n\n// Main Canvas component with providers\nexport const Canvas = forwardRef<CanvasRef, CanvasProps>(\n  (\n    {\n      elements,\n      connections,\n      selectedIds,\n      defaultElements = [],\n      defaultConnections = [],\n      config,\n      theme = 'light',\n      initialViewport,\n      maxHistorySize,\n      onChange,\n      onSelectionChange,\n      ...innerProps\n    },\n    ref\n  ) => {\n    return (\n      <CombinedCanvasProvider\n        initialElements={defaultElements}\n        initialConnections={defaultConnections}\n        elements={elements}\n        connections={connections}\n        selectedIds={selectedIds}\n        config={config}\n        theme={theme}\n        initialViewport={initialViewport}\n        maxHistorySize={maxHistorySize}\n        onElementsChange={onChange}\n        onSelectionChange={onSelectionChange}\n      >\n        <CanvasInner {...innerProps} ref={ref} />\n      </CombinedCanvasProvider>\n    );\n  }\n);\n\nCanvas.displayName = 'Canvas';\n\nexport default Canvas;\n","// ElementFactory\n// Pure factory function for creating canvas elements\n\nimport type {\n\tCanvasElement,\n\tElementType,\n\tElementStyle,\n\tPoint,\n\tTextElement,\n\tLineElement,\n\tActorElement,\n\tLifelineElement,\n\tMessageElement,\n} from \"@/types/elements\";\nimport { generateId } from \"@/core/utils\";\n\nexport interface CreateElementOptions {\n\tid?: string;\n\tx?: number;\n\ty?: number;\n\twidth?: number;\n\theight?: number;\n\tstyle?: ElementStyle;\n\tzIndex?: number;\n\tlocked?: boolean;\n\tvisible?: boolean;\n\tdata?: Record<string, unknown>;\n}\n\nexport interface CreateTextElementOptions extends CreateElementOptions {\n\ttext?: string;\n\tfontSize?: number;\n\tfontFamily?: string;\n\tfontWeight?: \"normal\" | \"bold\";\n\ttextAlign?: \"left\" | \"center\" | \"right\";\n}\n\nexport interface CreateLineElementOptions extends CreateElementOptions {\n\tpoints?: Point[];\n\tlineType?: \"solid\" | \"dashed\" | \"dotted\";\n}\n\nexport interface CreateActorElementOptions extends CreateElementOptions {\n\tlabel?: string;\n}\n\nexport interface CreateLifelineElementOptions extends CreateElementOptions {\n\tlabel?: string;\n}\n\nexport interface CreateMessageElementOptions extends CreateElementOptions {\n\tlabel?: string;\n\tmessageType?: \"sync\" | \"async\" | \"return\" | \"create\";\n\tfromId?: string;\n\ttoId?: string;\n}\n\n// Default dimensions by element type\nconst defaultDimensions: Record<\n\tElementType,\n\t{ width: number; height: number }\n> = {\n\trectangle: { width: 120, height: 80 },\n\tellipse: { width: 120, height: 80 },\n\tcircle: { width: 80, height: 80 },\n\tdiamond: { width: 100, height: 100 },\n\ttext: { width: 100, height: 30 },\n\tline: { width: 100, height: 2 },\n\tactor: { width: 60, height: 100 },\n\tlifeline: { width: 100, height: 300 },\n\tmessage: { width: 150, height: 30 },\n\tactivationBar: { width: 12, height: 60 },\n\tcustom: { width: 100, height: 100 },\n};\n\n/**\n * Create a base element with common properties\n */\nconst createBaseElement = (\n\ttype: ElementType,\n\toptions: CreateElementOptions = {},\n): CanvasElement => {\n\tconst defaults = defaultDimensions[type] ?? defaultDimensions.custom;\n\n\treturn {\n\t\tid: options.id ?? generateId(),\n\t\ttype,\n\t\tx: options.x ?? 0,\n\t\ty: options.y ?? 0,\n\t\twidth: options.width ?? defaults.width,\n\t\theight: options.height ?? defaults.height,\n\t\tzIndex: options.zIndex ?? 0,\n\t\tstyle: options.style,\n\t\tlocked: options.locked ?? false,\n\t\tvisible: options.visible ?? true,\n\t\tdata: options.data,\n\t};\n};\n\n/**\n * Create a rectangle element\n */\nexport const createRectangle = (\n\toptions: CreateElementOptions = {},\n): CanvasElement => {\n\treturn createBaseElement(\"rectangle\", options);\n};\n\n/**\n * Create an ellipse element\n */\nexport const createEllipse = (\n\toptions: CreateElementOptions = {},\n): CanvasElement => {\n\treturn createBaseElement(\"ellipse\", options);\n};\n\n/**\n * Create a circle element (ellipse with equal dimensions)\n */\nexport const createCircle = (\n\toptions: CreateElementOptions = {},\n): CanvasElement => {\n\tconst size = options.width ?? options.height ?? 80;\n\treturn createBaseElement(\"circle\", { ...options, width: size, height: size });\n};\n\n/**\n * Create a diamond element\n */\nexport const createDiamond = (\n\toptions: CreateElementOptions = {},\n): CanvasElement => {\n\treturn createBaseElement(\"diamond\", options);\n};\n\n/**\n * Create a text element\n */\nexport const createText = (\n\toptions: CreateTextElementOptions = {},\n): TextElement => {\n\tconst { text, fontSize, fontFamily, fontWeight, textAlign, ...baseOptions } =\n\t\toptions;\n\n\treturn {\n\t\t...createBaseElement(\"text\", baseOptions),\n\t\ttype: \"text\",\n\t\ttext: text ?? \"\",\n\t\tfontSize,\n\t\tfontFamily,\n\t\tfontWeight,\n\t\ttextAlign,\n\t};\n};\n\n/**\n * Create a line element\n * Points are automatically normalized to be relative to (0,0)\n * and element x,y is set to the bounding box origin\n */\nexport const createLine = (\n\toptions: CreateLineElementOptions = {},\n): LineElement => {\n\tconst { points: inputPoints, lineType, x, y, ...baseOptions } = options;\n\n\t// Default HORIZONTAL line if no points specified\n\tconst defaultWidth = baseOptions.width ?? 100;\n\tlet points = inputPoints ?? [\n\t\t{ x: x ?? 0, y: y ?? 0 },\n\t\t{ x: (x ?? 0) + defaultWidth, y: y ?? 0 },\n\t];\n\n\t// Calculate bounding box from points\n\tconst xs = points.map((p) => p.x);\n\tconst ys = points.map((p) => p.y);\n\tconst minX = Math.min(...xs);\n\tconst minY = Math.min(...ys);\n\tconst maxX = Math.max(...xs);\n\tconst maxY = Math.max(...ys);\n\n\t// Normalize points to be relative to (0,0)\n\tconst normalizedPoints = points.map((p) => ({\n\t\tx: p.x - minX,\n\t\ty: p.y - minY,\n\t}));\n\n\t// Calculate dimensions\n\t// For horizontal/vertical lines, ensure minimum size for selection\n\tconst rawWidth = maxX - minX;\n\tconst rawHeight = maxY - minY;\n\tconst width = Math.max(rawWidth, 10);\n\tconst height = Math.max(rawHeight, 10);\n\n\t// Adjust normalized points if we expanded the bounding box\n\tconst adjustedPoints = normalizedPoints.map((p) => ({\n\t\tx: rawWidth < 10 ? p.x + (10 - rawWidth) / 2 : p.x,\n\t\ty: rawHeight < 10 ? p.y + (10 - rawHeight) / 2 : p.y,\n\t}));\n\n\treturn {\n\t\t...createBaseElement(\"line\", {\n\t\t\t...baseOptions,\n\t\t\tx: rawWidth < 10 ? minX - (10 - rawWidth) / 2 : minX,\n\t\t\ty: rawHeight < 10 ? minY - (10 - rawHeight) / 2 : minY,\n\t\t\twidth,\n\t\t\theight,\n\t\t}),\n\t\ttype: \"line\",\n\t\tpoints: adjustedPoints,\n\t\tlineType: lineType ?? \"solid\",\n\t};\n};\n\n/**\n * Create an actor element (UML)\n */\nexport const createActor = (\n\toptions: CreateActorElementOptions = {},\n): ActorElement => {\n\tconst { label, ...baseOptions } = options;\n\n\treturn {\n\t\t...createBaseElement(\"actor\", baseOptions),\n\t\ttype: \"actor\",\n\t\tlabel,\n\t};\n};\n\n/**\n * Create a lifeline element (UML)\n */\nexport const createLifeline = (\n\toptions: CreateLifelineElementOptions = {},\n): LifelineElement => {\n\tconst { label, ...baseOptions } = options;\n\n\treturn {\n\t\t...createBaseElement(\"lifeline\", baseOptions),\n\t\ttype: \"lifeline\",\n\t\tlabel,\n\t};\n};\n\n/**\n * Create a message element (UML)\n */\nexport const createMessage = (\n\toptions: CreateMessageElementOptions = {},\n): MessageElement => {\n\tconst { label, messageType, fromId, toId, ...baseOptions } = options;\n\n\treturn {\n\t\t...createBaseElement(\"message\", baseOptions),\n\t\ttype: \"message\",\n\t\tlabel,\n\t\tmessageType: messageType ?? \"sync\",\n\t\tfromId,\n\t\ttoId,\n\t};\n};\n\n/**\n * Create an activation bar element (UML)\n */\nexport const createActivationBar = (\n\toptions: CreateElementOptions = {},\n): CanvasElement => {\n\treturn createBaseElement(\"activationBar\", options);\n};\n\n/**\n * Factory function to create any element by type\n */\nexport const createElement = (\n\ttype: ElementType,\n\toptions: CreateElementOptions & Record<string, unknown> = {},\n): CanvasElement => {\n\tswitch (type) {\n\t\tcase \"rectangle\":\n\t\t\treturn createRectangle(options);\n\t\tcase \"ellipse\":\n\t\t\treturn createEllipse(options);\n\t\tcase \"circle\":\n\t\t\treturn createCircle(options);\n\t\tcase \"diamond\":\n\t\t\treturn createDiamond(options);\n\t\tcase \"text\":\n\t\t\treturn createText(options as CreateTextElementOptions);\n\t\tcase \"line\":\n\t\t\treturn createLine(options as CreateLineElementOptions);\n\t\tcase \"actor\":\n\t\t\treturn createActor(options as CreateActorElementOptions);\n\t\tcase \"lifeline\":\n\t\t\treturn createLifeline(options as CreateLifelineElementOptions);\n\t\tcase \"message\":\n\t\t\treturn createMessage(options as CreateMessageElementOptions);\n\t\tcase \"activationBar\":\n\t\t\treturn createActivationBar(options);\n\t\tdefault:\n\t\t\treturn createBaseElement(type, options);\n\t}\n};\n\n// Export factory as default\nexport const ElementFactory = {\n\tcreate: createElement,\n\trectangle: createRectangle,\n\tellipse: createEllipse,\n\tcircle: createCircle,\n\tdiamond: createDiamond,\n\ttext: createText,\n\tline: createLine,\n\tactor: createActor,\n\tlifeline: createLifeline,\n\tmessage: createMessage,\n\tactivationBar: createActivationBar,\n};\n\nexport default ElementFactory;\n"],"names":["generateId","cx","args","classes","arg","inner","key","value","deepMerge","target","source","output","sourceVal","targetVal","distance","p1","p2","dx","dy","isPointInBounds","point","bounds","boundsIntersect","a","b","snapToGrid","gridSize","getResizeHandles","handleSize","x","y","width","height","halfHandle","sortByZIndex","elements","getMaxZIndex","el","getMinZIndex","bringToFront","elementId","maxZ","sendToBack","minZ","bringForward","sorted","index","current","above","sendBackward","below","validateCanvasData","data","errors","obj","element","elementErrors","validateElement","connection","connectionErrors","validateConnection","prefix","conn","CURRENT_VERSION","serializeToJSON","connections","metadata","deserializeFromJSON","json","validation","exportToSVG","svgElement","options","clone","styles","getComputedStyles","svg","tags","downloadAsFile","content","filename","mimeType","blob","url","link","exportToImage","format","quality","backgroundColor","scale","svgRect","styleEl","svgString","svgBlob","svgUrl","resolve","reject","img","canvas","ctx","bgColor","downloadAsImage","lightTheme","darkTheme","ThemeContext","createContext","useTheme","context","useContext","ThemeProvider","children","theme","useMemo","React","getThemeCSSVariables","defaultViewport","viewportReducer","state","action","zoom","padding","pan","ViewportContext","useViewport","ViewportProvider","initialViewport","viewport","dispatch","useReducer","setZoom","useCallback","zoomIn","zoomOut","zoomToFit","setPan","panBy","delta","resetViewport","setConstraints","constraints","screenToCanvas","canvasToScreen","defaultSelection","selectionReducer","newSet","SelectionContext","useSelection","SelectionProvider","initialSelection","onSelectionChange","selectedIdsArray","isSelected","id","select","selectMultiple","ids","addToSelection","removeFromSelection","toggleSelection","clearSelection","selectAll","historyReducer","newPast","previous","next","newFuture","HistoryContext","useHistory","HistoryProvider","initialElements","initialConnections","maxHistorySize","onStateChange","pushState","undo","redo","clearHistory","setPresent","setMaxHistorySize","size","defaultConfig","canvasReducer","idsToRemove","CanvasContext","useCanvas","CanvasProvider","initialConfig","onChange","getElementById","getElementsByType","type","addElement","maxZIndex","addElements","newElements","i","updateElement","updates","updateElements","removeElement","removeElements","moveElement","moveElements","deltaX","deltaY","resizeElement","bringToFrontAction","sendToBackAction","moveUpAction","moveDownAction","setElements","getConnectionById","getConnectionsForElement","addConnection","updateConnection","removeConnection","setConnections","updateConfig","config","clearCanvas","loadState","CombinedCanvasProvider","onElementsChange","selectedIds","effectiveElements","effectiveConnections","jsx","CanvasStateProvider","useDraggable","onDragStart","onDrag","onDragEnd","disabled","threshold","dragState","setDragState","useState","startRef","useRef","hasPassedThreshold","getEventPosition","e","touch","handleMove","currentPos","handleEnd","endPos","handleStart","clientX","clientY","startPos","onMouseDown","onTouchStart","useResizable","onResizeStart","onResize","onResizeEnd","minWidth","minHeight","maxWidth","maxHeight","maintainAspectRatio","aspectRatio","resizeState","setResizeState","calculateNewBounds","handle","newX","newY","newWidth","newHeight","targetRatio","newBounds","prev","finalBounds","startResize","useRotatable","onRotateStart","onRotate","onRotateEnd","snapAngle","rotateState","setRotateState","getAngle","center","snapToAngle","angle","startMouseAngle","initialRotation","deltaAngle","newAngle","finalAngle","startRotate","useSelectable","onSelect","checkSelected","selectElement","deselect","toggle","willBeSelected","onClick","matchesShortcut","shortcut","keyMatches","shiftMatches","altMatches","modifierMatches","useKeyboard","shortcuts","enabled","targetRef","shortcutsRef","handleKeyDown","useEffect","useCanvasKeyboardShortcuts","actions","useCanvasActions","selection","history","clipboardRef","saveState","removeSelected","moveSelected","duplicateSelected","duplicates","newIds","copy","selectedElements","relevantConnections","cut","paste","idMap","newFromId","newToId","HANDLE_SIZE","ElementBase","forwardRef","className","style","showHandles","enableRotation","ref","isReadonly","selectionHandlers","isDragging","dragHandlers","pos","isResizing","isRotating","displayRotation","displayBounds","resizeScale","handles","handleResizeStart","handleRotateStart","centerX","centerY","handleMouseDown","groupStyle","getCursorForHandle","position","withElementBehavior","RenderComponent","WrappedComponent","allProps","typedProps","_e","_d","_sh","_er","_os","_ods","_od","_ode","_ors","_or","_ore","_orts","_ort","_orte","_c","_s","rest","interactionState","setInteractionState","handleSelect","selected","handleDragStart","handleDragEnd","handleResizeEnd","w","h","handleRotateEnd","rotation","renderProps","RectangleRender","Rectangle","EllipseRender","cy","rx","ry","Ellipse","Circle","Oval","DiamondRender","points","Diamond","TextElement","onTextChange","isEditing","setIsEditing","editText","setEditText","inputRef","elementStyle","text","fontSize","fontFamily","fontWeight","textAlign","measureText","textContent","textEl","lines","lineHeight","line","tspan","totalHeight","getTextAnchor","getXPosition","handleDoubleClick","saveAndExit","trimmedText","newSize","cancelEdit","renderContent","ROTATION_HANDLE_OFFSET","LineBase","renderLine","onPointsChange","endpointDrag","setEndpointDrag","endpointDragRef","basePoints","displayPoints","handleEndpointMouseDown","endpointIndex","handleMouseMove","moveEvent","idx","startMousePos","originalPoints","newPoints","p","handleMouseUp","xs","ys","minX","minY","maxX","maxY","normalizedPoints","lineCenterX","lineCenterY","handlePositions","rotationHandlePos","length","perpX","perpY","handleX","handleY","Line","lineType","getStrokeDasharray","strokeColor","strokeWidth","isEndpointDragging","pathData","Actor","onLabelChange","propStyle","editLabel","setEditLabel","label","headRadius","bodyTop","bodyBottom","armY","armSpan","legSpan","labelY","trimmedLabel","Lifeline","headerHeight","Message","messageType","arrowSize","renderArrow","ActivationBarRender","ActivationBar","elementComponents","DrawingCanvas","propWidth","propHeight","propShowGrid","propGridSize","onCanvasClick","onCanvasDoubleClick","showGrid","sortedElements","handleBackgroundMouseDown","renderGrid","patternId","renderBackground","renderElement","Component","CanvasInner","readonly","enableKeyboardShortcuts","svgRef","useImperativeHandle","jsxs","Canvas","defaultElements","defaultConnections","innerProps","defaultDimensions","createBaseElement","defaults","createRectangle","createEllipse","createCircle","createDiamond","createText","baseOptions","createLine","inputPoints","defaultWidth","rawWidth","rawHeight","adjustedPoints","createActor","createLifeline","createMessage","fromId","toId","createActivationBar","createElement","ElementFactory"],"mappings":"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"}