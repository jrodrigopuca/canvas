"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("react"),te=require("react/jsx-runtime"),ue=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,11)}`,de=(...e)=>{const t=[];for(const o of e)if(o){if(typeof o=="string"||typeof o=="number")t.push(String(o));else if(Array.isArray(o)){const r=de(...o);r&&t.push(r)}else if(typeof o=="object")for(const[r,s]of Object.entries(o))s&&t.push(r)}return t.join(" ")};function ve(e,t){const o={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r],a=e[r];s!==null&&typeof s=="object"&&!Array.isArray(s)&&a!==null&&typeof a=="object"&&!Array.isArray(a)?o[r]=ve(a,s):s!==void 0&&(o[r]=s)}return o}const Ct=(e,t)=>{const o=t.x-e.x,r=t.y-e.y;return Math.sqrt(o*o+r*r)},St=(e,t)=>e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height,Rt=(e,t)=>!(e.x+e.width<t.x||t.x+t.width<e.x||e.y+e.height<t.y||t.y+t.height<e.y),It=(e,t)=>Math.round(e/t)*t,Xe=(e,t)=>{const{x:o,y:r,width:s,height:a}=e,c=t/2;return[{position:"nw",x:o-c,y:r-c},{position:"n",x:o+s/2-c,y:r-c},{position:"ne",x:o+s-c,y:r-c},{position:"e",x:o+s-c,y:r+a/2-c},{position:"se",x:o+s-c,y:r+a-c},{position:"s",x:o+s/2-c,y:r+a-c},{position:"sw",x:o-c,y:r+a-c},{position:"w",x:o-c,y:r+a/2-c}]},ge=e=>[...e].sort((t,o)=>t.zIndex-o.zIndex),Tt=e=>e.length===0?0:Math.max(...e.map(t=>t.zIndex)),Mt=e=>e.length===0?0:Math.min(...e.map(t=>t.zIndex)),Ye=(e,t)=>{const o=Tt(e);return e.map(r=>r.id===t?{...r,zIndex:o+1}:r)},Ke=(e,t)=>{const o=Mt(e);return e.map(r=>r.id===t?{...r,zIndex:o-1}:r)},zt=(e,t)=>{const o=ge(e),r=o.findIndex(c=>c.id===t);if(r===-1||r===o.length-1)return e;const s=o[r],a=o[r+1];return e.map(c=>c.id===s.id?{...c,zIndex:a.zIndex+1}:c)},Dt=(e,t)=>{const o=ge(e),r=o.findIndex(c=>c.id===t);if(r<=0)return e;const s=o[r],a=o[r-1];return e.map(c=>c.id===s.id?{...c,zIndex:a.zIndex-1}:c)},Ge=e=>{const t=[];if(!e||typeof e!="object")return{valid:!1,errors:["Data must be an object"]};const o=e;return typeof o.version!="string"&&t.push("Missing or invalid version field"),Array.isArray(o.elements)?o.elements.forEach((r,s)=>{const a=At(r,s);t.push(...a)}):t.push("Elements must be an array"),Array.isArray(o.connections)?o.connections.forEach((r,s)=>{const a=Nt(r,s);t.push(...a)}):t.push("Connections must be an array"),{valid:t.length===0,errors:t}},At=(e,t)=>{const o=[],r=`Element[${t}]`;if(!e||typeof e!="object")return[`${r}: Must be an object`];const s=e;return(typeof s.id!="string"||s.id.length===0)&&o.push(`${r}: Missing or invalid id`),(typeof s.type!="string"||s.type.length===0)&&o.push(`${r}: Missing or invalid type`),(typeof s.x!="number"||isNaN(s.x))&&o.push(`${r}: Missing or invalid x coordinate`),(typeof s.y!="number"||isNaN(s.y))&&o.push(`${r}: Missing or invalid y coordinate`),(typeof s.width!="number"||isNaN(s.width)||s.width<0)&&o.push(`${r}: Missing or invalid width`),(typeof s.height!="number"||isNaN(s.height)||s.height<0)&&o.push(`${r}: Missing or invalid height`),(typeof s.zIndex!="number"||isNaN(s.zIndex))&&o.push(`${r}: Missing or invalid zIndex`),o},Nt=(e,t)=>{const o=[],r=`Connection[${t}]`;if(!e||typeof e!="object")return[`${r}: Must be an object`];const s=e;return(typeof s.id!="string"||s.id.length===0)&&o.push(`${r}: Missing or invalid id`),(typeof s.fromId!="string"||s.fromId.length===0)&&o.push(`${r}: Missing or invalid fromId`),(typeof s.toId!="string"||s.toId.length===0)&&o.push(`${r}: Missing or invalid toId`),o},Lt="1.0.0",Ot=(e,t,o)=>JSON.stringify({version:Lt,elements:e,connections:t,metadata:o},null,2),Je=e=>{const t=JSON.parse(e),o=Ge(t);if(!o.valid)throw new Error(`Invalid canvas data: ${o.errors.join(", ")}`);return t},_t=(e,t)=>{const o=e.cloneNode(!0);if(o.getAttribute("xmlns")||o.setAttribute("xmlns","http://www.w3.org/2000/svg"),t?.includeStyles){const s=document.createElement("style");s.textContent=qe(e),o.insertBefore(s,o.firstChild)}return new XMLSerializer().serializeToString(o)},qe=e=>{const t=new Set;return e.querySelectorAll("*").forEach(o=>t.add(o.tagName.toLowerCase())),`
    svg { font-family: system-ui, sans-serif; }
    text { user-select: none; }
  `},Pt=(e,t,o)=>{const r=new Blob([e],{type:o}),s=URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)},ke=async(e,t={})=>{const{format:o="png",quality:r=.92,backgroundColor:s,scale:a=1}=t,c=e.getBoundingClientRect(),w=c.width*a,f=c.height*a,S=e.cloneNode(!0);S.setAttribute("xmlns","http://www.w3.org/2000/svg"),S.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const x=document.createElementNS("http://www.w3.org/2000/svg","style");x.textContent=qe(e),S.insertBefore(x,S.firstChild);const b=new XMLSerializer().serializeToString(S),g=new Blob([b],{type:"image/svg+xml;charset=utf-8"}),m=URL.createObjectURL(g);return new Promise((u,v)=>{const y=new Image;y.onload=()=>{const l=document.createElement("canvas");l.width=w,l.height=f;const E=l.getContext("2d");if(!E){URL.revokeObjectURL(m),v(new Error("Failed to get canvas context"));return}const i=s??(o==="jpeg"?"#ffffff":"transparent");i!=="transparent"&&(E.fillStyle=i,E.fillRect(0,0,w,f)),E.scale(a,a),E.drawImage(y,0,0),l.toBlob(h=>{URL.revokeObjectURL(m),h?u(h):v(new Error("Failed to create image blob"))},o==="jpeg"?"image/jpeg":"image/png",o==="jpeg"?r:void 0)},y.onerror=()=>{URL.revokeObjectURL(m),v(new Error("Failed to load SVG as image"))},y.src=m})},Bt=async(e,t,o={})=>{const{format:r="png"}=o,s=await ke(e,o),a=URL.createObjectURL(s),c=document.createElement("a");c.href=a,c.download=`${t}.${r}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(a)},re={name:"light",colors:{background:"#ffffff",surface:"#f8f9fa",border:"#dee2e6",text:{primary:"#212529",secondary:"#6c757d",disabled:"#adb5bd"},selection:{fill:"rgba(59, 130, 246, 0.1)",stroke:"#3b82f6"},element:{fill:"#ffffff",stroke:"#212529",hover:"#f1f5f9",active:"#e2e8f0"},handle:{fill:"#ffffff",stroke:"#3b82f6"},grid:{line:"#e5e7eb",dot:"#d1d5db"},connection:{line:"#64748b",arrow:"#64748b"}},spacing:{xs:4,sm:8,md:16,lg:24,xl:32},borderRadius:{sm:2,md:4,lg:8},fontSize:{xs:10,sm:12,md:14,lg:16,xl:20},strokeWidth:{thin:1,normal:2,thick:3},shadows:{sm:"0 1px 2px rgba(0,0,0,0.05)",md:"0 4px 6px rgba(0,0,0,0.1)",lg:"0 10px 15px rgba(0,0,0,0.1)",element:"0 2px 4px rgba(0,0,0,0.1)",handle:"0 1px 2px rgba(0,0,0,0.1)"}},Qe={name:"dark",colors:{background:"#1e1e1e",surface:"#252526",border:"#3c3c3c",text:{primary:"#ffffff",secondary:"#a0a0a0",disabled:"#5a5a5a"},selection:{fill:"rgba(59, 130, 246, 0.2)",stroke:"#60a5fa"},element:{fill:"#2d2d2d",stroke:"#ffffff",hover:"#383838",active:"#454545"},handle:{fill:"#2d2d2d",stroke:"#60a5fa"},grid:{line:"#333333",dot:"#444444"},connection:{line:"#94a3b8",arrow:"#94a3b8"}},spacing:re.spacing,borderRadius:re.borderRadius,fontSize:re.fontSize,strokeWidth:re.strokeWidth,shadows:{sm:"0 1px 2px rgba(0,0,0,0.3)",md:"0 4px 6px rgba(0,0,0,0.4)",lg:"0 10px 15px rgba(0,0,0,0.5)",element:"0 2px 4px rgba(0,0,0,0.3)",handle:"0 1px 2px rgba(0,0,0,0.3)"}},et=n.createContext({theme:re,themeName:"light"}),Q=()=>{const e=n.useContext(et);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e},tt=({children:e,theme:t="light"})=>{const o=n.useMemo(()=>t==="light"?{theme:re,themeName:"light"}:t==="dark"?{theme:Qe,themeName:"dark"}:{theme:ve(re,t),themeName:"custom"},[t]);return n.createElement(et.Provider,{value:o},e)},$t=e=>({"--canvas-bg":e.colors.background,"--canvas-surface":e.colors.surface,"--canvas-border":e.colors.border,"--canvas-text-primary":e.colors.text.primary,"--canvas-text-secondary":e.colors.text.secondary,"--canvas-text-disabled":e.colors.text.disabled,"--canvas-selection-fill":e.colors.selection.fill,"--canvas-selection-stroke":e.colors.selection.stroke,"--canvas-element-fill":e.colors.element.fill,"--canvas-element-stroke":e.colors.element.stroke,"--canvas-element-hover":e.colors.element.hover,"--canvas-element-active":e.colors.element.active,"--canvas-handle-fill":e.colors.handle.fill,"--canvas-handle-stroke":e.colors.handle.stroke,"--canvas-grid-line":e.colors.grid.line,"--canvas-grid-dot":e.colors.grid.dot,"--canvas-connection-line":e.colors.connection.line,"--canvas-connection-arrow":e.colors.connection.arrow,"--canvas-spacing-xs":`${e.spacing.xs}px`,"--canvas-spacing-sm":`${e.spacing.sm}px`,"--canvas-spacing-md":`${e.spacing.md}px`,"--canvas-spacing-lg":`${e.spacing.lg}px`,"--canvas-spacing-xl":`${e.spacing.xl}px`,"--canvas-radius-sm":`${e.borderRadius.sm}px`,"--canvas-radius-md":`${e.borderRadius.md}px`,"--canvas-radius-lg":`${e.borderRadius.lg}px`,"--canvas-font-xs":`${e.fontSize.xs}px`,"--canvas-font-sm":`${e.fontSize.sm}px`,"--canvas-font-md":`${e.fontSize.md}px`,"--canvas-font-lg":`${e.fontSize.lg}px`,"--canvas-font-xl":`${e.fontSize.xl}px`,"--canvas-stroke-thin":`${e.strokeWidth.thin}px`,"--canvas-stroke-normal":`${e.strokeWidth.normal}px`,"--canvas-stroke-thick":`${e.strokeWidth.thick}px`,"--canvas-shadow-sm":e.shadows.sm,"--canvas-shadow-md":e.shadows.md,"--canvas-shadow-lg":e.shadows.lg,"--canvas-shadow-element":e.shadows.element,"--canvas-shadow-handle":e.shadows.handle}),nt={zoom:1,pan:{x:0,y:0},minZoom:.1,maxZoom:5},Wt=(e,t)=>{switch(t.type){case"SET_ZOOM":{const o=Math.max(e.minZoom,Math.min(e.maxZoom,t.payload));return{...e,zoom:o}}case"ZOOM_IN":{const o=Math.min(e.maxZoom,e.zoom*1.2);return{...e,zoom:o}}case"ZOOM_OUT":{const o=Math.max(e.minZoom,e.zoom/1.2);return{...e,zoom:o}}case"ZOOM_TO_FIT":{const{bounds:o,padding:r=50}=t.payload,s=Math.max(e.minZoom,Math.min(e.maxZoom,1)),a={x:-(o.x-r),y:-(o.y-r)};return{...e,zoom:s,pan:a}}case"SET_PAN":return{...e,pan:t.payload};case"PAN_BY":return{...e,pan:{x:e.pan.x+t.payload.x,y:e.pan.y+t.payload.y}};case"RESET":return{...nt,minZoom:e.minZoom,maxZoom:e.maxZoom};case"SET_CONSTRAINTS":return{...e,minZoom:t.payload.minZoom??e.minZoom,maxZoom:t.payload.maxZoom??e.maxZoom};default:return e}},ot=n.createContext(null),ae=()=>{const e=n.useContext(ot);if(!e)throw new Error("useViewport must be used within a ViewportProvider");return e},st=({children:e,initialViewport:t})=>{const[o,r]=n.useReducer(Wt,{...nt,...t}),s=n.useCallback(u=>{r({type:"SET_ZOOM",payload:u})},[]),a=n.useCallback(()=>{r({type:"ZOOM_IN"})},[]),c=n.useCallback(()=>{r({type:"ZOOM_OUT"})},[]),w=n.useCallback((u,v)=>{r({type:"ZOOM_TO_FIT",payload:{bounds:u,padding:v}})},[]),f=n.useCallback(u=>{r({type:"SET_PAN",payload:u})},[]),S=n.useCallback(u=>{r({type:"PAN_BY",payload:u})},[]),x=n.useCallback(()=>{r({type:"RESET"})},[]),k=n.useCallback(u=>{r({type:"SET_CONSTRAINTS",payload:u})},[]),b=n.useCallback(u=>({x:(u.x-o.pan.x)/o.zoom,y:(u.y-o.pan.y)/o.zoom}),[o.zoom,o.pan]),g=n.useCallback(u=>({x:u.x*o.zoom+o.pan.x,y:u.y*o.zoom+o.pan.y}),[o.zoom,o.pan]),m=n.useMemo(()=>({viewport:o,setZoom:s,zoomIn:a,zoomOut:c,zoomToFit:w,setPan:f,panBy:S,resetViewport:x,setConstraints:k,screenToCanvas:b,canvasToScreen:g}),[o,s,a,c,w,f,S,x,k,b,g]);return n.createElement(ot.Provider,{value:m},e)},Ut={selectedIds:new Set,lastSelectedId:null},jt=(e,t)=>{switch(t.type){case"SELECT":return{selectedIds:new Set([t.payload]),lastSelectedId:t.payload};case"SELECT_MULTIPLE":return{selectedIds:new Set(t.payload),lastSelectedId:t.payload.length>0?t.payload[t.payload.length-1]:null};case"ADD_TO_SELECTION":{const o=new Set(e.selectedIds);return o.add(t.payload),{selectedIds:o,lastSelectedId:t.payload}}case"REMOVE_FROM_SELECTION":{const o=new Set(e.selectedIds);return o.delete(t.payload),{selectedIds:o,lastSelectedId:o.size>0?Array.from(o).pop():null}}case"TOGGLE_SELECTION":{const o=new Set(e.selectedIds);return o.has(t.payload)?(o.delete(t.payload),{selectedIds:o,lastSelectedId:o.size>0?Array.from(o).pop():null}):(o.add(t.payload),{selectedIds:o,lastSelectedId:t.payload})}case"CLEAR_SELECTION":return Ut;case"SELECT_ALL":return{selectedIds:new Set(t.payload),lastSelectedId:t.payload.length>0?t.payload[t.payload.length-1]:null};default:return e}},rt=n.createContext(null),he=()=>{const e=n.useContext(rt);if(!e)throw new Error("useSelection must be used within a SelectionProvider");return e},at=({children:e,initialSelection:t,onSelectionChange:o})=>{const[r,s]=n.useReducer(jt,{selectedIds:new Set(t??[]),lastSelectedId:t?.[t.length-1]??null}),a=n.useMemo(()=>Array.from(r.selectedIds),[r.selectedIds]);n.useEffect(()=>{o?.(a)},[a,o]);const c=n.useCallback(u=>r.selectedIds.has(u),[r.selectedIds]),w=n.useCallback(u=>{s({type:"SELECT",payload:u})},[]),f=n.useCallback(u=>{s({type:"SELECT_MULTIPLE",payload:u})},[]),S=n.useCallback(u=>{s({type:"ADD_TO_SELECTION",payload:u})},[]),x=n.useCallback(u=>{s({type:"REMOVE_FROM_SELECTION",payload:u})},[]),k=n.useCallback(u=>{s({type:"TOGGLE_SELECTION",payload:u})},[]),b=n.useCallback(()=>{s({type:"CLEAR_SELECTION"})},[]),g=n.useCallback(u=>{s({type:"SELECT_ALL",payload:u})},[]),m=n.useMemo(()=>({selectedIds:a,lastSelectedId:r.lastSelectedId,selectionCount:r.selectedIds.size,hasSelection:r.selectedIds.size>0,isSelected:c,select:w,selectMultiple:f,addToSelection:S,removeFromSelection:x,toggleSelection:k,clearSelection:b,selectAll:g}),[a,r.lastSelectedId,r.selectedIds.size,c,w,f,S,x,k,b,g]);return n.createElement(rt.Provider,{value:m},e)},Zt=(e,t)=>{switch(t.type){case"PUSH":{const o=[...e.past,e.present];return o.length>e.maxHistorySize&&o.shift(),{...e,past:o,present:t.payload,future:[]}}case"UNDO":{if(e.past.length===0)return e;const o=e.past[e.past.length-1],r=e.past.slice(0,-1);return{...e,past:r,present:o,future:[e.present,...e.future]}}case"REDO":{if(e.future.length===0)return e;const o=e.future[0],r=e.future.slice(1);return{...e,past:[...e.past,e.present],present:o,future:r}}case"CLEAR":return{...e,past:[],present:e.present,future:[]};case"SET_PRESENT":return{...e,present:t.payload};case"SET_MAX_SIZE":return{...e,maxHistorySize:t.payload};default:return e}},ct=n.createContext(null),lt=()=>{const e=n.useContext(ct);if(!e)throw new Error("useHistory must be used within a HistoryProvider");return e},it=({children:e,initialElements:t=[],initialConnections:o=[],maxHistorySize:r=50,onStateChange:s})=>{const[a,c]=n.useReducer(Zt,{past:[],present:{elements:t,connections:o,timestamp:Date.now()},future:[],maxHistorySize:r});n.useEffect(()=>{s?.(a.present.elements,a.present.connections)},[a.present,s]);const w=n.useCallback((m,u)=>{c({type:"PUSH",payload:{elements:m,connections:u,timestamp:Date.now()}})},[]),f=n.useCallback(()=>{c({type:"UNDO"})},[]),S=n.useCallback(()=>{c({type:"REDO"})},[]),x=n.useCallback(()=>{c({type:"CLEAR"})},[]),k=n.useCallback((m,u)=>{c({type:"SET_PRESENT",payload:{elements:m,connections:u,timestamp:Date.now()}})},[]),b=n.useCallback(m=>{c({type:"SET_MAX_SIZE",payload:m})},[]),g=n.useMemo(()=>({canUndo:a.past.length>0,canRedo:a.future.length>0,historySize:a.past.length,futureSize:a.future.length,present:a.present,pushState:w,undo:f,redo:S,clearHistory:x,setPresent:k,setMaxHistorySize:b}),[a.past.length,a.future.length,a.present,w,f,S,x,k,b]);return n.createElement(ct.Provider,{value:g},e)},Ht={width:800,height:600,grid:{enabled:!1,size:20,snap:!1,visible:!1},readonly:!1},Ft=(e,t)=>{switch(t.type){case"ADD_ELEMENT":return{...e,elements:[...e.elements,t.payload]};case"ADD_ELEMENTS":return{...e,elements:[...e.elements,...t.payload]};case"UPDATE_ELEMENT":return{...e,elements:e.elements.map(o=>o.id===t.payload.id?{...o,...t.payload.updates}:o)};case"UPDATE_ELEMENTS":return{...e,elements:e.elements.map(o=>t.payload.ids.includes(o.id)?{...o,...t.payload.updates}:o)};case"REMOVE_ELEMENT":{const o=t.payload;return{...e,elements:e.elements.filter(r=>r.id!==o),connections:e.connections.filter(r=>r.fromId!==o&&r.toId!==o)}}case"REMOVE_ELEMENTS":{const o=new Set(t.payload);return{...e,elements:e.elements.filter(r=>!o.has(r.id)),connections:e.connections.filter(r=>!o.has(r.fromId)&&!o.has(r.toId))}}case"MOVE_ELEMENT":return{...e,elements:e.elements.map(o=>o.id===t.payload.id?{...o,x:t.payload.x,y:t.payload.y}:o)};case"MOVE_ELEMENTS":return{...e,elements:e.elements.map(o=>t.payload.ids.includes(o.id)?{...o,x:o.x+t.payload.deltaX,y:o.y+t.payload.deltaY}:o)};case"RESIZE_ELEMENT":return{...e,elements:e.elements.map(o=>o.id===t.payload.id?{...o,width:t.payload.width,height:t.payload.height,...t.payload.x!==void 0&&{x:t.payload.x},...t.payload.y!==void 0&&{y:t.payload.y}}:o)};case"BRING_TO_FRONT":return{...e,elements:Ye(e.elements,t.payload)};case"SEND_TO_BACK":return{...e,elements:Ke(e.elements,t.payload)};case"MOVE_UP":return{...e,elements:zt(e.elements,t.payload)};case"MOVE_DOWN":return{...e,elements:Dt(e.elements,t.payload)};case"SET_ELEMENTS":return{...e,elements:t.payload};case"ADD_CONNECTION":return{...e,connections:[...e.connections,t.payload]};case"UPDATE_CONNECTION":return{...e,connections:e.connections.map(o=>o.id===t.payload.id?{...o,...t.payload.updates}:o)};case"REMOVE_CONNECTION":return{...e,connections:e.connections.filter(o=>o.id!==t.payload)};case"SET_CONNECTIONS":return{...e,connections:t.payload};case"UPDATE_CONFIG":return{...e,config:{...e.config,...t.payload}};case"CLEAR_CANVAS":return{...e,elements:[],connections:[]};case"LOAD_STATE":return{...e,elements:t.payload.elements,connections:t.payload.connections};default:return e}},dt=n.createContext(null),oe=()=>{const e=n.useContext(dt);if(!e)throw new Error("useCanvas must be used within a CanvasProvider");return e},ut=({children:e,initialElements:t=[],initialConnections:o=[],config:r,onChange:s})=>{const[a,c]=n.useReducer(Ft,{elements:t,connections:o,config:{...Ht,...r}});n.useEffect(()=>{s?.(a.elements,a.connections)},[a.elements,a.connections,s]);const w=n.useCallback(d=>a.elements.find(z=>z.id===d),[a.elements]),f=n.useCallback(d=>a.elements.filter(z=>z.type===d),[a.elements]),S=n.useCallback(d=>{const z=d.id??ue(),_=a.elements.length>0?Math.max(...a.elements.map(H=>H.zIndex)):0;return c({type:"ADD_ELEMENT",payload:{...d,id:z,zIndex:d.zIndex??_+1}}),z},[a.elements]),x=n.useCallback(d=>{const z=a.elements.length>0?Math.max(...a.elements.map(H=>H.zIndex)):0,_=d.map((H,F)=>({...H,id:H.id??ue(),zIndex:H.zIndex??z+1+F}));return c({type:"ADD_ELEMENTS",payload:_}),_.map(H=>H.id)},[a.elements]),k=n.useCallback((d,z)=>{c({type:"UPDATE_ELEMENT",payload:{id:d,updates:z}})},[]),b=n.useCallback((d,z)=>{c({type:"UPDATE_ELEMENTS",payload:{ids:d,updates:z}})},[]),g=n.useCallback(d=>{c({type:"REMOVE_ELEMENT",payload:d})},[]),m=n.useCallback(d=>{c({type:"REMOVE_ELEMENTS",payload:d})},[]),u=n.useCallback((d,z,_)=>{c({type:"MOVE_ELEMENT",payload:{id:d,x:z,y:_}})},[]),v=n.useCallback((d,z,_)=>{c({type:"MOVE_ELEMENTS",payload:{ids:d,deltaX:z,deltaY:_}})},[]),y=n.useCallback((d,z,_,H,F)=>{c({type:"RESIZE_ELEMENT",payload:{id:d,width:z,height:_,x:H,y:F}})},[]),l=n.useCallback(d=>{c({type:"BRING_TO_FRONT",payload:d})},[]),E=n.useCallback(d=>{c({type:"SEND_TO_BACK",payload:d})},[]),i=n.useCallback(d=>{c({type:"MOVE_UP",payload:d})},[]),h=n.useCallback(d=>{c({type:"MOVE_DOWN",payload:d})},[]),p=n.useCallback(d=>{c({type:"SET_ELEMENTS",payload:d})},[]),R=n.useCallback(d=>a.connections.find(z=>z.id===d),[a.connections]),M=n.useCallback(d=>a.connections.filter(z=>z.fromId===d||z.toId===d),[a.connections]),C=n.useCallback(d=>{const z=d.id??ue();return c({type:"ADD_CONNECTION",payload:{...d,id:z}}),z},[]),P=n.useCallback((d,z)=>{c({type:"UPDATE_CONNECTION",payload:{id:d,updates:z}})},[]),O=n.useCallback(d=>{c({type:"REMOVE_CONNECTION",payload:d})},[]),I=n.useCallback(d=>{c({type:"SET_CONNECTIONS",payload:d})},[]),N=n.useCallback(d=>{c({type:"UPDATE_CONFIG",payload:d})},[]),L=n.useCallback(()=>{c({type:"CLEAR_CANVAS"})},[]),Z=n.useCallback((d,z)=>{c({type:"LOAD_STATE",payload:{elements:d,connections:z}})},[]),W=n.useMemo(()=>({elements:a.elements,connections:a.connections,config:a.config,getElementById:w,getElementsByType:f,addElement:S,addElements:x,updateElement:k,updateElements:b,removeElement:g,removeElements:m,moveElement:u,moveElements:v,resizeElement:y,bringToFront:l,sendToBack:E,moveUp:i,moveDown:h,setElements:p,getConnectionById:R,getConnectionsForElement:M,addConnection:C,updateConnection:P,removeConnection:O,setConnections:I,updateConfig:N,clearCanvas:L,loadState:Z}),[a.elements,a.connections,a.config,w,f,S,x,k,b,g,m,u,v,y,l,E,i,h,p,R,M,C,P,O,I,N,L,Z]);return n.createElement(dt.Provider,{value:W},e)},ht=({children:e,initialElements:t=[],initialConnections:o=[],config:r,theme:s="light",initialViewport:a,maxHistorySize:c=50,onElementsChange:w,onSelectionChange:f,elements:S,connections:x,selectedIds:k})=>{const b=S??t,g=x??o;return te.jsx(tt,{theme:s,children:te.jsx(st,{initialViewport:a,children:te.jsx(at,{initialSelection:k,onSelectionChange:f,children:te.jsx(it,{initialElements:b,initialConnections:g,maxHistorySize:c,children:te.jsx(ut,{initialElements:b,initialConnections:g,config:r,onChange:w,children:e})})})})})},be=(e={})=>{const{onDragStart:t,onDrag:o,onDragEnd:r,disabled:s=!1,threshold:a=3}=e,[c,w]=n.useState({isDragging:!1,startPosition:null,currentPosition:null,delta:{x:0,y:0}}),f=n.useRef(null),S=n.useRef(!1),{screenToCanvas:x}=ae(),k=n.useCallback(y=>{if("touches"in y){const l=y.touches[0]||y.changedTouches[0];return x({x:l.clientX,y:l.clientY})}return x({x:y.clientX,y:y.clientY})},[x]),b=n.useCallback(y=>{if(!f.current)return;const l=k(y),E={x:l.x-f.current.x,y:l.y-f.current.y};if(!S.current){if(Math.sqrt(E.x**2+E.y**2)<a)return;S.current=!0,t?.(f.current)}w({isDragging:!0,startPosition:f.current,currentPosition:l,delta:E}),o?.(l,E)},[k,a,t,o]),g=n.useCallback(y=>{if(!f.current)return;const l=k(y),E={x:l.x-f.current.x,y:l.y-f.current.y};S.current&&r?.(l,E),w({isDragging:!1,startPosition:null,currentPosition:null,delta:{x:0,y:0}}),f.current=null,S.current=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",g),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",g)},[k,b,r]),m=n.useCallback((y,l)=>{if(s)return;const E=x({x:y,y:l});f.current=E,S.current=!1,w({isDragging:!1,startPosition:E,currentPosition:E,delta:{x:0,y:0}}),document.addEventListener("mousemove",b),document.addEventListener("mouseup",g),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("touchend",g)},[s,x,b,g]),u=n.useCallback(y=>{y.button===0&&(y.preventDefault(),y.stopPropagation(),m(y.clientX,y.clientY))},[m]),v=n.useCallback(y=>{if(y.touches.length!==1)return;const l=y.touches[0];m(l.clientX,l.clientY)},[m]);return{dragState:c,handlers:{onMouseDown:u,onTouchStart:v},isDragging:c.isDragging}},pt=(e={})=>{const{onResizeStart:t,onResize:o,onResizeEnd:r,disabled:s=!1,minWidth:a=20,minHeight:c=20,maxWidth:w=1/0,maxHeight:f=1/0,maintainAspectRatio:S=!1,aspectRatio:x}=e,[k,b]=n.useState({isResizing:!1,handle:null,startBounds:null,currentBounds:null}),g=n.useRef(null),{screenToCanvas:m}=ae(),u=n.useCallback(i=>{if("touches"in i){const h=i.touches[0]||i.changedTouches[0];return m({x:h.clientX,y:h.clientY})}return m({x:i.clientX,y:i.clientY})},[m]),v=n.useCallback(i=>{if(!g.current)return{x:0,y:0,width:0,height:0};const{position:h,bounds:p,handle:R}=g.current,M=i.x-h.x,C=i.y-h.y;let P=p.x,O=p.y,I=p.width,N=p.height;switch(R){case"nw":P=p.x+M,O=p.y+C,I=p.width-M,N=p.height-C;break;case"n":O=p.y+C,N=p.height-C;break;case"ne":O=p.y+C,I=p.width+M,N=p.height-C;break;case"e":I=p.width+M;break;case"se":I=p.width+M,N=p.height+C;break;case"s":N=p.height+C;break;case"sw":P=p.x+M,I=p.width-M,N=p.height+C;break;case"w":P=p.x+M,I=p.width-M;break}if(I<a&&(R.includes("w")&&(P=p.x+p.width-a),I=a),N<c&&(R.includes("n")&&(O=p.y+p.height-c),N=c),I>w&&(I=w),N>f&&(N=f),S&&g.current.aspectRatio){const L=g.current.aspectRatio;I/N>L?I=N*L:N=I/L}return{x:P,y:O,width:I,height:N}},[a,c,w,f,S]),y=n.useCallback(i=>{if(!g.current)return;const h=u(i),p=v(h);b(R=>({...R,currentBounds:p})),o?.(p)},[u,v,o]),l=n.useCallback(i=>{if(!g.current)return;const h=u(i),p=v(h);r?.(p),b({isResizing:!1,handle:null,startBounds:null,currentBounds:null}),g.current=null,document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",l),document.removeEventListener("touchmove",y),document.removeEventListener("touchend",l)},[u,v,y,r]),E=n.useCallback((i,h,p)=>{if(s)return;p.preventDefault(),p.stopPropagation();const R="touches"in p?p.touches[0].clientX:p.clientX,M="touches"in p?p.touches[0].clientY:p.clientY,C=m({x:R,y:M});g.current={position:C,bounds:h,handle:i,aspectRatio:x??h.width/h.height},b({isResizing:!0,handle:i,startBounds:h,currentBounds:h}),t?.(i),document.addEventListener("mousemove",y),document.addEventListener("mouseup",l),document.addEventListener("touchmove",y,{passive:!1}),document.addEventListener("touchend",l)},[s,m,x,t,y,l]);return{resizeState:k,startResize:E,isResizing:k.isResizing}},we=(e={})=>{const{onRotateStart:t,onRotate:o,onRotateEnd:r,disabled:s=!1,snapAngle:a}=e,[c,w]=n.useState({isRotating:!1,startAngle:null,currentAngle:null,deltaAngle:0}),f=n.useRef(null),{screenToCanvas:S}=ae(),x=n.useCallback(v=>{if("touches"in v){const y=v.touches[0]||v.changedTouches[0];return S({x:y.clientX,y:y.clientY})}return S({x:v.clientX,y:v.clientY})},[S]),k=n.useCallback((v,y)=>{const l=y.x-v.x,E=y.y-v.y;return Math.atan2(E,l)*(180/Math.PI)},[]),b=n.useCallback(v=>a?Math.round(v/a)*a:v,[a]),g=n.useCallback(v=>{if(!f.current||s)return;const y=x(v),{center:l,startMouseAngle:E,initialRotation:i}=f.current;let p=k(l,y)-E,R=i+p;R=(R%360+360)%360,v.shiftKey&&a&&(R=b(R)),w({isRotating:!0,startAngle:i,currentAngle:R,deltaAngle:R-i}),o?.(R,R-i)},[s,x,k,a,b,o]),m=n.useCallback(v=>{if(!f.current)return;const y=x(v),{center:l,startMouseAngle:E,initialRotation:i}=f.current;let p=k(l,y)-E,R=i+p;R=(R%360+360)%360,v.shiftKey&&a&&(R=b(R)),r?.(R),w({isRotating:!1,startAngle:null,currentAngle:null,deltaAngle:0}),f.current=null,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",m),document.removeEventListener("touchmove",g),document.removeEventListener("touchend",m)},[x,k,a,b,r,g]),u=n.useCallback((v,y,l)=>{if(s)return;l.stopPropagation(),l.preventDefault();const E=x(l.nativeEvent),i=k(v,E);f.current={center:v,startMouseAngle:i,initialRotation:y},w({isRotating:!0,startAngle:y,currentAngle:y,deltaAngle:0}),t?.(y),document.addEventListener("mousemove",g),document.addEventListener("mouseup",m),document.addEventListener("touchmove",g),document.addEventListener("touchend",m)},[s,x,k,t,g,m]);return{rotateState:c,startRotate:u,isRotating:c.isRotating}},Ce=e=>{const{id:t,disabled:o=!1,onSelect:r}=e,{isSelected:s,select:a,addToSelection:c,removeFromSelection:w,toggleSelection:f,clearSelection:S}=he(),x=s(t),k=n.useCallback(()=>{o||(a(t),r?.(!0))},[o,t,a,r]),b=n.useCallback(()=>{o||(w(t),r?.(!1))},[o,t,w,r]),g=n.useCallback(()=>{if(o)return;const u=!x;f(t),r?.(u)},[o,t,x,f,r]),m=n.useCallback(u=>{o||(u.stopPropagation(),u.ctrlKey||u.metaKey?(f(t),r?.(!x)):u.shiftKey?(c(t),r?.(!0)):(a(t),r?.(!0)))},[o,t,x,f,c,a,r]);return{isSelected:x,handlers:{onClick:m},select:k,deselect:b,toggle:g}},Vt=(e,t)=>{const o=e.key.toLowerCase()===t.key.toLowerCase();t.ctrl?e.ctrlKey:!e.ctrlKey||t.meta,t.meta?e.metaKey:!e.metaKey||t.ctrl;const r=t.shift?e.shiftKey:!e.shiftKey,s=t.alt?e.altKey:!e.altKey,a=t.ctrl||t.meta?!!(t.ctrl&&(e.ctrlKey||e.metaKey))||!!(t.meta&&e.metaKey):!e.ctrlKey&&!e.metaKey;return o&&a&&r&&s},mt=(e={})=>{const{shortcuts:t=[],enabled:o=!0,targetRef:r}=e,s=n.useRef(t);s.current=t;const a=n.useCallback(c=>{if(o){for(const w of s.current)if(Vt(c,w)){w.preventDefault!==!1&&c.preventDefault(),w.action();return}}},[o]);n.useEffect(()=>{const c=r?.current??document;return c.addEventListener("keydown",a),()=>{c.removeEventListener("keydown",a)}},[a,r])},yt=e=>{const t=[];e.undo&&t.push({key:"z",ctrl:!0,action:e.undo}),e.redo&&(t.push({key:"z",ctrl:!0,shift:!0,action:e.redo}),t.push({key:"y",ctrl:!0,action:e.redo})),e.delete&&(t.push({key:"Delete",action:e.delete}),t.push({key:"Backspace",action:e.delete})),e.selectAll&&t.push({key:"a",ctrl:!0,action:e.selectAll}),e.copy&&t.push({key:"c",ctrl:!0,action:e.copy}),e.paste&&t.push({key:"v",ctrl:!0,action:e.paste}),e.cut&&t.push({key:"x",ctrl:!0,action:e.cut}),e.escape&&t.push({key:"Escape",action:e.escape}),e.zoomIn&&(t.push({key:"+",ctrl:!0,action:e.zoomIn}),t.push({key:"=",ctrl:!0,action:e.zoomIn})),e.zoomOut&&t.push({key:"-",ctrl:!0,action:e.zoomOut}),e.resetZoom&&t.push({key:"0",ctrl:!0,action:e.resetZoom}),mt({shortcuts:t})},gt=()=>{const e=oe(),t=he(),o=lt(),r=n.useRef(null),s=n.useCallback(()=>{o.pushState(e.elements,e.connections)},[o,e.elements,e.connections]),a=n.useCallback(l=>(s(),e.addElement(l)),[e,s]),c=n.useCallback((l,E)=>{s(),e.updateElement(l,E)},[e,s]),w=n.useCallback(l=>{s(),e.removeElement(l)},[e,s]),f=n.useCallback(()=>{t.selectedIds.length!==0&&(s(),e.removeElements(t.selectedIds),t.clearSelection())},[e,t,s]),S=n.useCallback((l,E)=>{t.selectedIds.length!==0&&(s(),e.moveElements(t.selectedIds,l,E))},[e,t,s]),x=n.useCallback(()=>{if(t.selectedIds.length===0)return[];s();const E=e.elements.filter(h=>t.selectedIds.includes(h.id)).map(h=>({...h,id:void 0,x:h.x+20,y:h.y+20})),i=e.addElements(E);return t.selectMultiple(i),i},[e,t,s]),k=n.useCallback(l=>(s(),e.addConnection(l)),[e,s]),b=n.useCallback(l=>{s(),e.removeConnection(l)},[e,s]),g=n.useCallback(()=>{if(t.selectedIds.length===0)return;const l=e.elements.filter(h=>t.selectedIds.includes(h.id)),E=new Set(t.selectedIds),i=e.connections.filter(h=>E.has(h.fromId)&&E.has(h.toId));r.current={elements:l,connections:i}},[e.elements,e.connections,t.selectedIds]),m=n.useCallback(()=>{g(),f()},[g,f]),u=n.useCallback(()=>{if(!r.current)return;s();const l=new Map,E=r.current.elements.map(h=>({...h,id:void 0,x:h.x+20,y:h.y+20})),i=e.addElements(E);r.current.elements.forEach((h,p)=>{l.set(h.id,i[p])}),r.current.connections.forEach(h=>{const p=l.get(h.fromId),R=l.get(h.toId);p&&R&&e.addConnection({...h,id:void 0,fromId:p,toId:R})}),t.selectMultiple(i)},[e,t,s]),v=n.useCallback(()=>{o.canUndo&&(o.undo(),e.loadState(o.present.elements,o.present.connections))},[o,e]),y=n.useCallback(()=>{o.canRedo&&(o.redo(),e.loadState(o.present.elements,o.present.connections))},[o,e]);return{addElement:a,updateElement:c,removeElement:w,removeSelected:f,moveSelected:S,duplicateSelected:x,addConnection:k,removeConnection:b,copy:g,cut:m,paste:u,hasCopied:r.current!==null,undo:v,redo:y,canUndo:o.canUndo,canRedo:o.canRedo}},me=8,ce=n.forwardRef(({element:e,children:t,className:o,style:r,disabled:s=!1,showHandles:a=!0,enableRotation:c=!0,onSelect:w,onDragStart:f,onDrag:S,onDragEnd:x,onResizeStart:k,onResize:b,onResizeEnd:g,onRotateStart:m,onRotate:u,onRotateEnd:v},y)=>{const{updateElement:l}=oe(),{theme:E}=Q(),i=e.locked||s,{isSelected:h,handlers:p}=Ce({id:e.id,disabled:i,onSelect:w}),{isDragging:R,dragState:M,handlers:C}=be({disabled:i||!h,onDragStart:()=>{f?.()},onDrag:(D,T)=>{const A=e.x+T.x,B=e.y+T.y;S?.(A,B)},onDragEnd:(D,T)=>{const A=e.x+T.x,B=e.y+T.y;l(e.id,{x:A,y:B}),x?.(A,B)}}),{isResizing:P,resizeState:O,startResize:I}=pt({disabled:i||!h,minWidth:e.minWidth??20,minHeight:e.minHeight??20,maxWidth:e.maxWidth,maxHeight:e.maxHeight,onResizeStart:()=>{k?.()},onResize:D=>{b?.(D.width,D.height,D.x,D.y)},onResizeEnd:D=>{l(e.id,{x:D.x,y:D.y,width:D.width,height:D.height}),g?.(D.width,D.height,D.x,D.y)}}),{isRotating:N,rotateState:L,startRotate:Z}=we({disabled:i||!h||!c,snapAngle:15,onRotateStart:()=>{m?.()},onRotate:D=>{u?.(D)},onRotateEnd:D=>{l(e.id,{rotation:D}),v?.(D)}}),W=n.useMemo(()=>N&&L.currentAngle!==null?L.currentAngle:e.rotation??0,[N,L.currentAngle,e.rotation]),d=n.useMemo(()=>P&&O.currentBounds?O.currentBounds:R?{x:e.x+M.delta.x,y:e.y+M.delta.y,width:e.width,height:e.height}:{x:e.x,y:e.y,width:e.width,height:e.height},[P,O.currentBounds,R,M.delta,e.x,e.y,e.width,e.height]),z=n.useMemo(()=>!P||!O.currentBounds?{x:1,y:1}:{x:O.currentBounds.width/e.width,y:O.currentBounds.height/e.height},[P,O.currentBounds,e.width,e.height]),_=n.useMemo(()=>!h||!a||i?[]:Xe({x:0,y:0,width:d.width,height:d.height},me),[h,a,i,d.width,d.height]),H=n.useCallback((D,T)=>{I(D,{x:e.x,y:e.y,width:e.width,height:e.height},T)},[I,e]),F=n.useCallback(D=>{const T=d.x+d.width/2,A=d.y+d.height/2;Z({x:T,y:A},e.rotation??0,D)},[Z,d,e.rotation]),U=n.useCallback(D=>{p.onClick(D),h&&C.onMouseDown(D)},[p,C,h]),V={cursor:R?"grabbing":h?"grab":"pointer",opacity:e.visible===!1?.5:1,...r};return n.createElement("g",{ref:y,className:de("canvas-element",o,{"canvas-element--selected":h,"canvas-element--dragging":R,"canvas-element--resizing":P,"canvas-element--rotating":N,"canvas-element--locked":e.locked}),transform:`translate(${d.x}, ${d.y})${W?` rotate(${W}, ${d.width/2}, ${d.height/2})`:""}`,style:V,onMouseDown:U,onTouchStart:C.onTouchStart,"data-element-id":e.id,"data-element-type":e.type},P?n.createElement("g",{transform:`scale(${z.x}, ${z.y})`},t):t,h&&n.createElement("rect",{className:"canvas-element__selection",x:-2,y:-2,width:d.width+4,height:d.height+4,fill:"none",stroke:E.colors.selection.stroke,strokeWidth:1,strokeDasharray:"4 2",pointerEvents:"none"}),_.map(D=>n.createElement("rect",{key:D.position,className:`canvas-element__handle canvas-element__handle--${D.position}`,x:D.x,y:D.y,width:me,height:me,fill:E.colors.handle.fill,stroke:E.colors.handle.stroke,strokeWidth:1,cursor:Xt(D.position),onMouseDown:T=>H(D.position,T)})),h&&a&&c&&!i&&n.createElement("g",{key:"rotation-handle",className:"canvas-element__rotation-handle"},n.createElement("line",{x1:d.width/2,y1:0,x2:d.width/2,y2:-25,stroke:E.colors.selection.stroke,strokeWidth:1,pointerEvents:"none"}),n.createElement("circle",{cx:d.width/2,cy:-25,r:me/2+2,fill:E.colors.handle.fill,stroke:E.colors.handle.stroke,strokeWidth:1,cursor:"grab",onMouseDown:F})))});ce.displayName="ElementBase";function Xt(e){return{nw:"nwse-resize",n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize"}[e]}function pe(e){const t=n.forwardRef((o,r)=>{const s=o,a=s.element,c=s.disabled,w=s.showHandles,f=s.enableRotation,S=s.onSelect,x=s.onDragStart,k=s.onDrag,b=s.onDragEnd,g=s.onResizeStart,m=s.onResize,u=s.onResizeEnd,v=s.onRotateStart,y=s.onRotate,l=s.onRotateEnd,E=s.className,i=s.style,{element:h,disabled:p,showHandles:R,enableRotation:M,onSelect:C,onDragStart:P,onDrag:O,onDragEnd:I,onResizeStart:N,onResize:L,onResizeEnd:Z,onRotateStart:W,onRotate:d,onRotateEnd:z,className:_,style:H,...F}=s,[U,V]=n.useState({isSelected:!1,isDragging:!1,isResizing:!1,isRotating:!1}),D=n.useCallback(j=>{V(Y=>({...Y,isSelected:j})),S?.(j)},[S]),T=n.useCallback(()=>{V(j=>({...j,isDragging:!0})),x?.()},[x]),A=n.useCallback((j,Y)=>{V(q=>({...q,isDragging:!1})),b?.(j,Y)},[b]),B=n.useCallback(()=>{V(j=>({...j,isResizing:!0})),g?.()},[g]),$=n.useCallback((j,Y,q,ee)=>{V(K=>({...K,isResizing:!1})),u?.(j,Y,q,ee)},[u]),X=n.useCallback(()=>{V(j=>({...j,isRotating:!0})),v?.()},[v]),J=n.useCallback(j=>{V(Y=>({...Y,isRotating:!1})),l?.(j)},[l]),G={element:a,...U};return te.jsx(ce,{ref:r,element:a,disabled:c,showHandles:w,enableRotation:f,className:E,style:i,onSelect:D,onDragStart:T,onDrag:k,onDragEnd:A,onResizeStart:B,onResize:m,onResizeEnd:$,onRotateStart:X,onRotate:y,onRotateEnd:J,children:te.jsx(e,{...G,...F})})});return t.displayName=`withElementBehavior(${e.displayName||e.name||"Component"})`,t}const Yt=({element:e})=>{const{theme:t}=Q(),{width:o,height:r,style:s}=e;return n.createElement("rect",{width:o,height:r,fill:s?.fill??t.colors.element.fill,stroke:s?.stroke??t.colors.element.stroke,strokeWidth:s?.strokeWidth??t.strokeWidth.normal,rx:s?.cornerRadius??0,ry:s?.cornerRadius??0,opacity:s?.opacity??1})},ye=pe(Yt);ye.displayName="Rectangle";const Kt=({element:e})=>{const{theme:t}=Q(),{width:o,height:r,style:s}=e,a=o/2,c=r/2,w=o/2,f=r/2;return n.createElement("ellipse",{cx:a,cy:c,rx:w,ry:f,fill:s?.fill??t.colors.element.fill,stroke:s?.stroke??t.colors.element.stroke,strokeWidth:s?.strokeWidth??t.strokeWidth.normal,opacity:s?.opacity??1})},ie=pe(Kt);ie.displayName="Ellipse";const ft=ie;ft.displayName="Circle";const xt=ie;xt.displayName="Oval";const Gt=({element:e})=>{const{theme:t}=Q(),{width:o,height:r,style:s}=e,a=[`${o/2},0`,`${o},${r/2}`,`${o/2},${r}`,`0,${r/2}`].join(" ");return n.createElement("polygon",{points:a,fill:s?.fill??t.colors.element.fill,stroke:s?.stroke??t.colors.element.stroke,strokeWidth:s?.strokeWidth??t.strokeWidth.normal,opacity:s?.opacity??1})},Se=pe(Gt);Se.displayName="Diamond";const Re=n.forwardRef(({element:e,disabled:t,showHandles:o,enableRotation:r,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g,onTextChange:m,className:u,style:v},y)=>{const{theme:l}=Q(),{updateElement:E}=oe(),[i,h]=n.useState(!1),[p,R]=n.useState(e.text??""),M=n.useRef(null),{width:C,height:P,style:O,text:I="",fontSize:N,fontFamily:L,fontWeight:Z,textAlign:W}=e,d=n.useCallback(T=>{const A=document.createElementNS("http://www.w3.org/2000/svg","svg");A.style.position="absolute",A.style.visibility="hidden",A.style.pointerEvents="none",document.body.appendChild(A);const B=document.createElementNS("http://www.w3.org/2000/svg","text");B.setAttribute("font-size",String(N??l.fontSize.md)),B.setAttribute("font-family",L??"sans-serif"),B.setAttribute("font-weight",Z??"normal");const $=T.split(`
`),X=(N??l.fontSize.md)*1.2;let J=0;$.forEach((q,ee)=>{const K=document.createElementNS("http://www.w3.org/2000/svg","tspan");K.textContent=q||" ",K.setAttribute("x","0"),K.setAttribute("dy",ee===0?"0":String(X)),B.appendChild(K)}),A.appendChild(B),J=B.getBBox().width;const j=$.length*X;document.body.removeChild(A);const Y=16;return{width:Math.max(J+Y,40),height:Math.max(j+Y,24)}},[N,L,Z,l.fontSize.md]),z=n.useCallback(()=>{switch(W){case"right":return"end";case"center":return"middle";default:return"start"}},[W]),_=n.useCallback(()=>{switch(W){case"right":return C;case"center":return C/2;default:return 0}},[W,C]),H=n.useCallback(T=>{e.locked||t||(T.stopPropagation(),T.preventDefault(),R(I),h(!0))},[e.locked,t,I]),F=n.useCallback(()=>{const T=p.trim();if(T!==I||T!==""){const A=d(T);E(e.id,{text:T,width:A.width,height:A.height}),m?.(T)}h(!1)},[p,I,d,E,e.id,m]),U=n.useCallback(()=>{R(I),h(!1)},[I]),V=n.useCallback(T=>{T.key==="Escape"?(T.preventDefault(),U()):T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),F()),T.stopPropagation()},[U,F]);n.useEffect(()=>{i&&M.current&&(M.current.focus(),M.current.select())},[i]);const D=()=>i?n.createElement("foreignObject",{x:0,y:0,width:C,height:P},n.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:W==="center"?"center":W==="right"?"flex-end":"flex-start"}},n.createElement("textarea",{ref:M,value:p,onChange:T=>R(T.target.value),onBlur:F,onKeyDown:V,style:{width:"100%",height:"100%",padding:"4px",border:`2px solid ${l.colors.selection.stroke}`,borderRadius:"2px",outline:"none",resize:"none",backgroundColor:l.colors.background,color:O?.fill??l.colors.text.primary,fontSize:N??l.fontSize.md,fontFamily:L??"sans-serif",fontWeight:Z??"normal",textAlign:W??"left",boxSizing:"border-box"}}))):n.createElement("g",{onDoubleClick:H},n.createElement("rect",{width:C,height:P,fill:"transparent"}),n.createElement("text",{x:_(),y:P/2,dominantBaseline:"central",textAnchor:z(),fill:O?.fill??l.colors.text.primary,fontSize:N??l.fontSize.md,fontFamily:L??"sans-serif",fontWeight:Z??"normal",opacity:O?.opacity??1,style:{pointerEvents:"none"}},I));return n.createElement(ce,{ref:y,element:e,children:D(),disabled:t||i,showHandles:o&&!i,enableRotation:r,className:u,style:v,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g})});Re.displayName="TextElement";const Ze=8,He=25,Et=n.forwardRef(({element:e,children:t,renderLine:o,className:r,style:s,disabled:a=!1,showHandles:c=!0,enableRotation:w=!0,onSelect:f,onDragStart:S,onDrag:x,onDragEnd:k,onPointsChange:b,onRotateStart:g,onRotate:m,onRotateEnd:u},v)=>{const{updateElement:y}=oe(),{theme:l}=Q(),{screenToCanvas:E}=ae(),i=e.locked||a,[h,p]=n.useState({isDragging:!1,endpointIndex:null,startPosition:null,currentPoints:null}),R=n.useRef(null),M=n.useMemo(()=>e.points??[{x:0,y:e.height/2},{x:e.width,y:e.height/2}],[e.points,e.width,e.height]),{isSelected:C,handlers:P}=Ce({id:e.id,disabled:i,onSelect:f}),{isDragging:O,dragState:I,handlers:N}=be({disabled:i||!C||h.isDragging,onDragStart:()=>{S?.()},onDrag:(A,B)=>{const $=e.x+B.x,X=e.y+B.y;x?.($,X)},onDragEnd:(A,B)=>{const $=e.x+B.x,X=e.y+B.y;y(e.id,{x:$,y:X}),k?.($,X)}}),{isRotating:L,rotateState:Z,startRotate:W}=we({disabled:i||!C||!w,snapAngle:15,onRotateStart:()=>{g?.()},onRotate:A=>{m?.(A)},onRotateEnd:A=>{y(e.id,{rotation:A}),u?.(A)}}),d=n.useMemo(()=>L&&Z.currentAngle!==null?Z.currentAngle:e.rotation??0,[L,Z.currentAngle,e.rotation]),z=n.useMemo(()=>O?{x:e.x+I.delta.x,y:e.y+I.delta.y,width:e.width,height:e.height}:{x:e.x,y:e.y,width:e.width,height:e.height},[O,I.delta,e.x,e.y,e.width,e.height]),_=n.useMemo(()=>h.isDragging&&h.currentPoints?h.currentPoints:M,[h.isDragging,h.currentPoints,M]),H=n.useCallback((A,B)=>{if(i||!C)return;B.stopPropagation(),B.preventDefault();const $=E({x:B.clientX,y:B.clientY});R.current={endpointIndex:A,startMousePos:$,originalPoints:[...M]},p({isDragging:!0,endpointIndex:A,startPosition:$,currentPoints:[...M]});const X=G=>{if(!R.current)return;const j=E({x:G.clientX,y:G.clientY}),{endpointIndex:Y,startMousePos:q,originalPoints:ee}=R.current,K=j.x-q.x,fe=j.y-q.y,xe=ee.map((se,Ee)=>Ee===Y?{x:se.x+K,y:se.y+fe}:{...se});p(se=>({...se,currentPoints:xe}))},J=()=>{R.current&&(R.current,p(G=>{if(G.currentPoints){const j=G.currentPoints,Y=j.map(le=>le.x),q=j.map(le=>le.y),ee=Math.min(...Y),K=Math.min(...q),fe=Math.max(...Y),xe=Math.max(...q),se=j.map(le=>({x:le.x-ee,y:le.y-K})),Ee=Math.max(fe-ee,1),wt=Math.max(xe-K,1);y(e.id,{x:e.x+ee,y:e.y+K,width:Ee,height:wt,points:se}),b?.(se)}return{isDragging:!1,endpointIndex:null,startPosition:null,currentPoints:null}}),R.current=null,document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",J))};document.addEventListener("mousemove",X),document.addEventListener("mouseup",J)},[i,C,M,E,y,e.id,e.x,e.y,b]),F=n.useCallback(A=>{const B=_[0],$=_[_.length-1],X=(B.x+$.x)/2,J=(B.y+$.y)/2,G=z.x+X,j=z.y+J;W({x:G,y:j},e.rotation??0,A)},[W,z,_,e.rotation]),U=n.useCallback(A=>{P.onClick(A),C&&!h.isDragging&&N.onMouseDown(A)},[P,N,C,h.isDragging]),V={cursor:O?"grabbing":C?"grab":"pointer",opacity:e.visible===!1?.5:1,...s},D=n.useMemo(()=>_.map(A=>({x:A.x,y:A.y})),[_]),T=n.useMemo(()=>{if(_.length<2)return{cx:0,cy:0,x1:0,y1:0,x2:0,y2:0};const A=_[0],B=_[_.length-1],$=(A.x+B.x)/2,X=(A.y+B.y)/2,J=B.x-A.x,G=B.y-A.y,j=Math.sqrt(J*J+G*G)||1,Y=-G/j,q=J/j,ee=$+Y*He,K=X+q*He;return{cx:ee,cy:K,x1:$,y1:X,x2:ee,y2:K}},[_]);return n.createElement("g",{ref:v,className:de("canvas-element canvas-line",r,{"canvas-element--selected":C,"canvas-element--dragging":O,"canvas-element--endpoint-dragging":h.isDragging,"canvas-element--rotating":L,"canvas-element--locked":e.locked}),transform:`translate(${z.x}, ${z.y})${d?` rotate(${d}, ${z.width/2}, ${z.height/2})`:""}`,style:V,onMouseDown:U,onTouchStart:N.onTouchStart,"data-element-id":e.id,"data-element-type":e.type},o(_,h.isDragging),C&&c&&!i&&D.map((A,B)=>n.createElement("circle",{key:`endpoint-handle-${B}`,className:"canvas-line__endpoint-handle",cx:A.x,cy:A.y,r:Ze/2+2,fill:l.colors.handle.fill,stroke:l.colors.handle.stroke,strokeWidth:1.5,cursor:"move",onMouseDown:$=>H(B,$)})),C&&c&&w&&!i&&n.createElement("g",{key:"rotation-handle",className:"canvas-line__rotation-handle"},n.createElement("line",{x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,stroke:l.colors.selection.stroke,strokeWidth:1,pointerEvents:"none"}),n.createElement("circle",{cx:T.cx,cy:T.cy,r:Ze/2+2,fill:l.colors.handle.fill,stroke:l.colors.handle.stroke,strokeWidth:1,cursor:"grab",onMouseDown:F})))});Et.displayName="LineBase";const Ie=n.forwardRef(({element:e,disabled:t,showHandles:o,enableRotation:r,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onPointsChange:f,onRotateStart:S,onRotate:x,onRotateEnd:k,className:b,style:g},m)=>{const{theme:u}=Q(),{style:v,lineType:y="solid"}=e,l=n.useCallback(()=>{switch(y){case"dashed":return"8 4";case"dotted":return"2 2";default:return}},[y]),E=v?.stroke??u.colors.element.stroke,i=v?.strokeWidth??u.strokeWidth.normal,h=n.useCallback((p,R)=>{const M=p.map((C,P)=>P===0?`M ${C.x} ${C.y}`:`L ${C.x} ${C.y}`).join(" ");return n.createElement("g",null,n.createElement("path",{d:M,fill:"none",stroke:"transparent",strokeWidth:20,strokeLinecap:"round"}),n.createElement("path",{d:M,fill:"none",stroke:E,strokeWidth:i,strokeDasharray:l(),strokeLinecap:"round",strokeLinejoin:"round",opacity:v?.opacity??1}))},[E,i,l,v?.opacity]);return n.createElement(Et,{ref:m,element:e,disabled:t,showHandles:o,enableRotation:r,className:b,style:g,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onPointsChange:f,onRotateStart:S,onRotate:x,onRotateEnd:k,renderLine:h})});Ie.displayName="Line";const Te=n.forwardRef(({element:e,disabled:t,showHandles:o,enableRotation:r,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g,onLabelChange:m,className:u,style:v},y)=>{const{theme:l}=Q(),{updateElement:E}=oe(),[i,h]=n.useState(!1),[p,R]=n.useState(e.label??""),M=n.useRef(null),{width:C,height:P,style:O,label:I}=e,N=Math.min(C,P)*.15,L=C/2,Z=N*2+4,W=P*.6,d=Z+(W-Z)*.3,z=C*.4,_=C*.35,H=P-4,F=O?.stroke??l.colors.element.stroke,U=O?.strokeWidth??l.strokeWidth.normal,V=n.useCallback($=>{e.locked||t||($.stopPropagation(),$.preventDefault(),R(I??""),h(!0))},[e.locked,t,I]),D=n.useCallback(()=>{const $=p.trim();$!==I&&(E(e.id,{label:$}),m?.($)),h(!1)},[p,I,E,e.id,m]),T=n.useCallback(()=>{R(I??""),h(!1)},[I]),A=n.useCallback($=>{$.key==="Escape"?($.preventDefault(),T()):$.key==="Enter"&&($.preventDefault(),D()),$.stopPropagation()},[T,D]);n.useEffect(()=>{i&&M.current&&(M.current.focus(),M.current.select())},[i]);const B=()=>n.createElement("g",{onDoubleClick:V},n.createElement("rect",{width:C,height:P,fill:"transparent"}),n.createElement("circle",{cx:L,cy:N+2,r:N,fill:O?.fill??"none",stroke:F,strokeWidth:U}),n.createElement("line",{x1:L,y1:Z,x2:L,y2:W,stroke:F,strokeWidth:U}),n.createElement("line",{x1:L-z,y1:d,x2:L+z,y2:d,stroke:F,strokeWidth:U}),n.createElement("line",{x1:L,y1:W,x2:L-_,y2:P*.85,stroke:F,strokeWidth:U}),n.createElement("line",{x1:L,y1:W,x2:L+_,y2:P*.85,stroke:F,strokeWidth:U}),i?n.createElement("foreignObject",{x:0,y:H-16,width:C,height:24},n.createElement("input",{ref:M,type:"text",value:p,onChange:$=>R($.target.value),onBlur:D,onKeyDown:A,style:{width:"100%",height:"100%",padding:"2px 4px",border:`2px solid ${l.colors.selection.stroke}`,borderRadius:"2px",outline:"none",backgroundColor:l.colors.background,color:l.colors.text.primary,fontSize:l.fontSize.sm,fontFamily:"sans-serif",textAlign:"center",boxSizing:"border-box"}})):I&&n.createElement("text",{x:L,y:H,textAnchor:"middle",dominantBaseline:"text-bottom",fill:O?.fill??l.colors.text.primary,fontSize:l.fontSize.sm,fontFamily:"sans-serif",style:{pointerEvents:"none"}},I));return n.createElement(ce,{ref:y,element:e,children:B(),disabled:t||i,showHandles:o&&!i,enableRotation:r,className:u,style:v,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g})});Te.displayName="Actor";const Me=n.forwardRef(({element:e,disabled:t,showHandles:o,enableRotation:r,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g,onLabelChange:m,className:u,style:v},y)=>{const{theme:l}=Q(),{updateElement:E}=oe(),[i,h]=n.useState(!1),[p,R]=n.useState(e.label??""),M=n.useRef(null),{width:C,height:P,style:O,label:I}=e,N=C/2,L=40,Z=O?.stroke??l.colors.element.stroke,W=O?.strokeWidth??l.strokeWidth.normal,d=n.useCallback(U=>{e.locked||t||(U.stopPropagation(),U.preventDefault(),R(I??""),h(!0))},[e.locked,t,I]),z=n.useCallback(()=>{const U=p.trim();U!==I&&(E(e.id,{label:U}),m?.(U)),h(!1)},[p,I,E,e.id,m]),_=n.useCallback(()=>{R(I??""),h(!1)},[I]),H=n.useCallback(U=>{U.key==="Escape"?(U.preventDefault(),_()):U.key==="Enter"&&(U.preventDefault(),z()),U.stopPropagation()},[_,z]);n.useEffect(()=>{i&&M.current&&(M.current.focus(),M.current.select())},[i]);const F=()=>n.createElement("g",{onDoubleClick:d},n.createElement("rect",{x:0,y:0,width:C,height:L,fill:O?.fill??l.colors.element.fill,stroke:Z,strokeWidth:W}),i?n.createElement("foreignObject",{x:4,y:(L-24)/2,width:C-8,height:24},n.createElement("input",{ref:M,type:"text",value:p,onChange:U=>R(U.target.value),onBlur:z,onKeyDown:H,style:{width:"100%",height:"100%",padding:"2px 4px",border:`2px solid ${l.colors.selection.stroke}`,borderRadius:"2px",outline:"none",backgroundColor:l.colors.background,color:l.colors.text.primary,fontSize:l.fontSize.sm,fontFamily:"sans-serif",textAlign:"center",boxSizing:"border-box"}})):I&&n.createElement("text",{x:N,y:L/2,textAnchor:"middle",dominantBaseline:"central",fill:l.colors.text.primary,fontSize:l.fontSize.sm,fontFamily:"sans-serif",style:{pointerEvents:"none"}},I),n.createElement("line",{x1:N,y1:L,x2:N,y2:P,stroke:Z,strokeWidth:W,strokeDasharray:"8 4"}));return n.createElement(ce,{ref:y,element:e,children:F(),disabled:t||i,showHandles:o&&!i,enableRotation:r,className:u,style:v,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g})});Me.displayName="Lifeline";const ze=n.forwardRef(({element:e,disabled:t,showHandles:o,enableRotation:r,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g,onLabelChange:m,className:u,style:v},y)=>{const{theme:l}=Q(),{updateElement:E}=oe(),[i,h]=n.useState(!1),[p,R]=n.useState(e.label??""),M=n.useRef(null),{width:C,height:P,style:O,label:I,messageType:N="sync"}=e,L=O?.stroke??l.colors.connection.line,Z=O?.strokeWidth??l.strokeWidth.normal,W=10,d=P/2,z=n.useCallback(T=>{e.locked||t||(T.stopPropagation(),T.preventDefault(),R(I??""),h(!0))},[e.locked,t,I]),_=n.useCallback(()=>{const T=p.trim();T!==I&&(E(e.id,{label:T}),m?.(T)),h(!1)},[p,I,E,e.id,m]),H=n.useCallback(()=>{R(I??""),h(!1)},[I]),F=n.useCallback(T=>{T.key==="Escape"?(T.preventDefault(),H()):T.key==="Enter"&&(T.preventDefault(),_()),T.stopPropagation()},[H,_]);n.useEffect(()=>{i&&M.current&&(M.current.focus(),M.current.select())},[i]);const U=()=>{switch(N){case"return":return"8 4";case"create":return"4 2";default:return}},V=()=>N==="async"?n.createElement("polyline",{points:`${C-W},${d-W/2} ${C},${d} ${C-W},${d+W/2}`,fill:"none",stroke:L,strokeWidth:Z}):n.createElement("polygon",{points:`${C},${d} ${C-W},${d-W/2} ${C-W},${d+W/2}`,fill:L,stroke:L,strokeWidth:1}),D=()=>n.createElement("g",{onDoubleClick:z},n.createElement("rect",{width:C,height:P,fill:"transparent"}),n.createElement("line",{x1:0,y1:d,x2:C-(N==="async"?0:W/2),y2:d,stroke:L,strokeWidth:Z,strokeDasharray:U()}),V(),i?n.createElement("foreignObject",{x:C/4,y:d-24,width:C/2,height:20},n.createElement("input",{ref:M,type:"text",value:p,onChange:T=>R(T.target.value),onBlur:_,onKeyDown:F,style:{width:"100%",height:"100%",padding:"2px 4px",border:`2px solid ${l.colors.selection.stroke}`,borderRadius:"2px",outline:"none",backgroundColor:l.colors.background,color:l.colors.text.primary,fontSize:l.fontSize.sm,fontFamily:"sans-serif",textAlign:"center",boxSizing:"border-box"}})):I&&n.createElement("text",{x:C/2,y:d-8,textAnchor:"middle",dominantBaseline:"text-bottom",fill:l.colors.text.primary,fontSize:l.fontSize.sm,fontFamily:"sans-serif",style:{pointerEvents:"none"}},I));return n.createElement(ce,{ref:y,element:e,children:D(),disabled:t||i,showHandles:o&&!i,enableRotation:r,className:u,style:v,onSelect:s,onDragStart:a,onDrag:c,onDragEnd:w,onResizeStart:f,onResize:S,onResizeEnd:x,onRotateStart:k,onRotate:b,onRotateEnd:g})});ze.displayName="Message";const Jt=({element:e})=>{const{theme:t}=Q(),{width:o,height:r,style:s}=e;return n.createElement("rect",{width:o||12,height:r,fill:s?.fill??t.colors.element.fill,stroke:s?.stroke??t.colors.element.stroke,strokeWidth:s?.strokeWidth??t.strokeWidth.normal})},De=pe(Jt);De.displayName="ActivationBar";const Fe={rectangle:ye,ellipse:ie,circle:ie,diamond:Se,text:Re,line:Ie,actor:Te,lifeline:Me,message:ze,activationBar:De,custom:ye},Ae=n.forwardRef(({width:e,height:t,className:o,style:r,showGrid:s,gridSize:a,onCanvasClick:c,onCanvasDoubleClick:w,children:f},S)=>{const{elements:x,config:k}=oe(),{clearSelection:b}=he(),{viewport:g}=ae(),{theme:m}=Q(),u=e??k.width,v=t??k.height,y=s??k.grid?.visible,l=a??k.grid?.size??20,E=n.useMemo(()=>ge(x),[x]),i=n.useCallback(M=>{b(),c?.(M)},[b,c]),h=()=>{if(!y)return null;const M="canvas-grid-pattern";return n.createElement(n.Fragment,null,n.createElement("defs",null,n.createElement("pattern",{id:M,width:l,height:l,patternUnits:"userSpaceOnUse"},n.createElement("path",{d:`M ${l} 0 L 0 0 0 ${l}`,fill:"none",stroke:m.colors.grid.line,strokeWidth:.5}))),n.createElement("rect",{width:"100%",height:"100%",fill:`url(#${M})`,pointerEvents:"none"}))},p=()=>n.createElement("rect",{className:"canvas-background",width:"100%",height:"100%",fill:"transparent",onMouseDown:i}),R=M=>{const C=Fe[M.type]??Fe.custom;return n.createElement(C,{key:M.id,element:M})};return n.createElement("svg",{ref:S,className:de("canvas-drawing",o),width:u,height:v,viewBox:`0 0 ${u} ${v}`,style:{backgroundColor:m.colors.background,cursor:"default",userSelect:"none",...r},onDoubleClick:w},n.createElement("g",{transform:`translate(${g.pan.x}, ${g.pan.y}) scale(${g.zoom})`},p(),h(),E.map(R),f))});Ae.displayName="DrawingCanvas";const vt=n.forwardRef(({width:e,height:t,readonly:o=!1,showGrid:r,gridSize:s,enableKeyboardShortcuts:a=!0,className:c,style:w,children:f},S)=>{const x=n.useRef(null),k=oe(),b=he(),g=ae(),m=gt();return yt(a?{undo:m.undo,redo:m.redo,delete:m.removeSelected,selectAll:()=>b.selectAll(k.elements.map(u=>u.id)),copy:m.copy,paste:m.paste,cut:m.cut,escape:b.clearSelection,zoomIn:g.zoomIn,zoomOut:g.zoomOut,resetZoom:g.resetViewport}:{}),n.useImperativeHandle(S,()=>({addElement:m.addElement,updateElement:m.updateElement,removeElement:m.removeElement,getElement:k.getElementById,getElementsByType:k.getElementsByType,select:b.select,selectMultiple:b.selectMultiple,clearSelection:b.clearSelection,getSelectedIds:()=>b.selectedIds,zoomIn:g.zoomIn,zoomOut:g.zoomOut,setZoom:g.setZoom,resetViewport:g.resetViewport,undo:m.undo,redo:m.redo,canUndo:m.canUndo,canRedo:m.canRedo,toJSON:()=>({elements:k.elements,connections:k.connections}),toSVG:()=>x.current?.outerHTML??"",toImage:async u=>{if(!x.current)throw new Error("SVG element not available");return ke(x.current,u)},fromJSON:u=>{const v=Je(u);return k.setElements(v.elements),k.setConnections(v.connections),b.clearSelection(),v}}),[k,b,g,m]),te.jsxs("div",{className:de("canvas-container",c,{"canvas-container--readonly":o}),style:{position:"relative",overflow:"hidden",...w},tabIndex:0,children:[te.jsx(Ae,{ref:x,width:e,height:t,showGrid:r,gridSize:s}),f]})});vt.displayName="CanvasInner";const kt=n.forwardRef(({elements:e,connections:t,selectedIds:o,defaultElements:r=[],defaultConnections:s=[],config:a,theme:c="light",initialViewport:w,maxHistorySize:f,onChange:S,onSelectionChange:x,...k},b)=>te.jsx(ht,{initialElements:r,initialConnections:s,elements:e,connections:t,selectedIds:o,config:a,theme:c,initialViewport:w,maxHistorySize:f,onElementsChange:S,onSelectionChange:x,children:te.jsx(vt,{...k,ref:b})}));kt.displayName="Canvas";const Ve={rectangle:{width:120,height:80},ellipse:{width:120,height:80},circle:{width:80,height:80},diamond:{width:100,height:100},text:{width:100,height:30},line:{width:100,height:2},actor:{width:60,height:100},lifeline:{width:100,height:300},message:{width:150,height:30},activationBar:{width:12,height:60},custom:{width:100,height:100}},ne=(e,t={})=>{const o=Ve[e]??Ve.custom;return{id:t.id??ue(),type:e,x:t.x??0,y:t.y??0,width:t.width??o.width,height:t.height??o.height,zIndex:t.zIndex??0,style:t.style,locked:t.locked??!1,visible:t.visible??!0,data:t.data}},Ne=(e={})=>ne("rectangle",e),Le=(e={})=>ne("ellipse",e),Oe=(e={})=>{const t=e.width??e.height??80;return ne("circle",{...e,width:t,height:t})},_e=(e={})=>ne("diamond",e),Pe=(e={})=>{const{text:t,fontSize:o,fontFamily:r,fontWeight:s,textAlign:a,...c}=e;return{...ne("text",c),type:"text",text:t??"",fontSize:o,fontFamily:r,fontWeight:s,textAlign:a}},Be=(e={})=>{const{points:t,lineType:o,x:r,y:s,...a}=e,c=a.width??100;let w=t??[{x:r??0,y:s??0},{x:(r??0)+c,y:s??0}];const f=w.map(i=>i.x),S=w.map(i=>i.y),x=Math.min(...f),k=Math.min(...S),b=Math.max(...f),g=Math.max(...S),m=w.map(i=>({x:i.x-x,y:i.y-k})),u=b-x,v=g-k,y=Math.max(u,10),l=Math.max(v,10),E=m.map(i=>({x:u<10?i.x+(10-u)/2:i.x,y:v<10?i.y+(10-v)/2:i.y}));return{...ne("line",{...a,x:u<10?x-(10-u)/2:x,y:v<10?k-(10-v)/2:k,width:y,height:l}),type:"line",points:E,lineType:o??"solid"}},$e=(e={})=>{const{label:t,...o}=e;return{...ne("actor",o),type:"actor",label:t}},We=(e={})=>{const{label:t,...o}=e;return{...ne("lifeline",o),type:"lifeline",label:t}},Ue=(e={})=>{const{label:t,messageType:o,fromId:r,toId:s,...a}=e;return{...ne("message",a),type:"message",label:t,messageType:o??"sync",fromId:r,toId:s}},je=(e={})=>ne("activationBar",e),bt=(e,t={})=>{switch(e){case"rectangle":return Ne(t);case"ellipse":return Le(t);case"circle":return Oe(t);case"diamond":return _e(t);case"text":return Pe(t);case"line":return Be(t);case"actor":return $e(t);case"lifeline":return We(t);case"message":return Ue(t);case"activationBar":return je(t);default:return ne(e,t)}},qt={create:bt,rectangle:Ne,ellipse:Le,circle:Oe,diamond:_e,text:Pe,line:Be,actor:$e,lifeline:We,message:Ue,activationBar:je};exports.ActivationBar=De;exports.Actor=Te;exports.Canvas=kt;exports.CanvasProvider=ut;exports.Circle=ft;exports.CombinedCanvasProvider=ht;exports.Diamond=Se;exports.DrawingCanvas=Ae;exports.ElementBase=ce;exports.ElementFactory=qt;exports.Ellipse=ie;exports.HistoryProvider=it;exports.Lifeline=Me;exports.Line=Ie;exports.Message=ze;exports.Oval=xt;exports.Rectangle=ye;exports.SelectionProvider=at;exports.TextElement=Re;exports.ThemeProvider=tt;exports.ViewportProvider=st;exports.boundsIntersect=Rt;exports.bringToFront=Ye;exports.createActivationBar=je;exports.createActor=$e;exports.createCircle=Oe;exports.createDiamond=_e;exports.createElement=bt;exports.createEllipse=Le;exports.createLifeline=We;exports.createLine=Be;exports.createMessage=Ue;exports.createRectangle=Ne;exports.createText=Pe;exports.cx=de;exports.darkTheme=Qe;exports.deepMerge=ve;exports.deserializeFromJSON=Je;exports.distance=Ct;exports.downloadAsFile=Pt;exports.downloadAsImage=Bt;exports.exportToImage=ke;exports.exportToSVG=_t;exports.generateId=ue;exports.getResizeHandles=Xe;exports.getThemeCSSVariables=$t;exports.isPointInBounds=St;exports.lightTheme=re;exports.sendToBack=Ke;exports.serializeToJSON=Ot;exports.snapToGrid=It;exports.sortByZIndex=ge;exports.useCanvas=oe;exports.useCanvasActions=gt;exports.useCanvasKeyboardShortcuts=yt;exports.useDraggable=be;exports.useHistory=lt;exports.useKeyboard=mt;exports.useResizable=pt;exports.useRotatable=we;exports.useSelectable=Ce;exports.useSelection=he;exports.useTheme=Q;exports.useViewport=ae;exports.validateCanvasData=Ge;exports.withElementBehavior=pe;
//# sourceMappingURL=index.cjs.map
