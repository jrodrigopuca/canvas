"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("react"),P=require("react/jsx-runtime"),H=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,11)}`,K=(...e)=>{const t=[];for(const n of e)if(n){if(typeof n=="string"||typeof n=="number")t.push(String(n));else if(Array.isArray(n)){const s=K(...n);s&&t.push(s)}else if(typeof n=="object")for(const[s,r]of Object.entries(n))r&&t.push(s)}return t.join(" ")};function ne(e,t){const n={...e};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const r=t[s],a=e[s];r!==null&&typeof r=="object"&&!Array.isArray(r)&&a!==null&&typeof a=="object"&&!Array.isArray(a)?n[s]=ne(a,r):r!==void 0&&(n[s]=r)}return n}const tt=(e,t)=>{const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)},nt=(e,t)=>e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height,st=(e,t)=>!(e.x+e.width<t.x||t.x+t.width<e.x||e.y+e.height<t.y||t.y+t.height<e.y),ot=(e,t)=>Math.round(e/t)*t,Se=(e,t)=>{const{x:n,y:s,width:r,height:a}=e,c=t/2;return[{position:"nw",x:n-c,y:s-c},{position:"n",x:n+r/2-c,y:s-c},{position:"ne",x:n+r-c,y:s-c},{position:"e",x:n+r-c,y:s+a/2-c},{position:"se",x:n+r-c,y:s+a-c},{position:"s",x:n+r/2-c,y:s+a-c},{position:"sw",x:n-c,y:s+a-c},{position:"w",x:n-c,y:s+a/2-c}]},q=e=>[...e].sort((t,n)=>t.zIndex-n.zIndex),rt=e=>e.length===0?0:Math.max(...e.map(t=>t.zIndex)),at=e=>e.length===0?0:Math.min(...e.map(t=>t.zIndex)),be=(e,t)=>{const n=rt(e);return e.map(s=>s.id===t?{...s,zIndex:n+1}:s)},Ie=(e,t)=>{const n=at(e);return e.map(s=>s.id===t?{...s,zIndex:n-1}:s)},ct=(e,t)=>{const n=q(e),s=n.findIndex(c=>c.id===t);if(s===-1||s===n.length-1)return e;const r=n[s],a=n[s+1];return e.map(c=>c.id===r.id?{...c,zIndex:a.zIndex+1}:c)},lt=(e,t)=>{const n=q(e),s=n.findIndex(c=>c.id===t);if(s<=0)return e;const r=n[s],a=n[s-1];return e.map(c=>c.id===r.id?{...c,zIndex:a.zIndex-1}:c)},Te=e=>{const t=[];if(!e||typeof e!="object")return{valid:!1,errors:["Data must be an object"]};const n=e;return typeof n.version!="string"&&t.push("Missing or invalid version field"),Array.isArray(n.elements)?n.elements.forEach((s,r)=>{const a=it(s,r);t.push(...a)}):t.push("Elements must be an array"),Array.isArray(n.connections)?n.connections.forEach((s,r)=>{const a=dt(s,r);t.push(...a)}):t.push("Connections must be an array"),{valid:t.length===0,errors:t}},it=(e,t)=>{const n=[],s=`Element[${t}]`;if(!e||typeof e!="object")return[`${s}: Must be an object`];const r=e;return(typeof r.id!="string"||r.id.length===0)&&n.push(`${s}: Missing or invalid id`),(typeof r.type!="string"||r.type.length===0)&&n.push(`${s}: Missing or invalid type`),(typeof r.x!="number"||isNaN(r.x))&&n.push(`${s}: Missing or invalid x coordinate`),(typeof r.y!="number"||isNaN(r.y))&&n.push(`${s}: Missing or invalid y coordinate`),(typeof r.width!="number"||isNaN(r.width)||r.width<0)&&n.push(`${s}: Missing or invalid width`),(typeof r.height!="number"||isNaN(r.height)||r.height<0)&&n.push(`${s}: Missing or invalid height`),(typeof r.zIndex!="number"||isNaN(r.zIndex))&&n.push(`${s}: Missing or invalid zIndex`),n},dt=(e,t)=>{const n=[],s=`Connection[${t}]`;if(!e||typeof e!="object")return[`${s}: Must be an object`];const r=e;return(typeof r.id!="string"||r.id.length===0)&&n.push(`${s}: Missing or invalid id`),(typeof r.fromId!="string"||r.fromId.length===0)&&n.push(`${s}: Missing or invalid fromId`),(typeof r.toId!="string"||r.toId.length===0)&&n.push(`${s}: Missing or invalid toId`),n},ut="1.0.0",mt=(e,t,n)=>JSON.stringify({version:ut,elements:e,connections:t,metadata:n},null,2),pt=e=>{const t=JSON.parse(e),n=Te(t);if(!n.valid)throw new Error(`Invalid canvas data: ${n.errors.join(", ")}`);return t},ht=(e,t)=>{const n=e.cloneNode(!0);if(n.getAttribute("xmlns")||n.setAttribute("xmlns","http://www.w3.org/2000/svg"),t?.includeStyles){const r=document.createElement("style");r.textContent=yt(e),n.insertBefore(r,n.firstChild)}return new XMLSerializer().serializeToString(n)},yt=e=>{const t=new Set;return e.querySelectorAll("*").forEach(n=>t.add(n.tagName.toLowerCase())),`
    svg { font-family: system-ui, sans-serif; }
    text { user-select: none; }
  `},ft=(e,t,n)=>{const s=new Blob([e],{type:n}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},V={name:"light",colors:{background:"#ffffff",surface:"#f8f9fa",border:"#dee2e6",text:{primary:"#212529",secondary:"#6c757d",disabled:"#adb5bd"},selection:{fill:"rgba(59, 130, 246, 0.1)",stroke:"#3b82f6"},element:{fill:"#ffffff",stroke:"#212529",hover:"#f1f5f9",active:"#e2e8f0"},handle:{fill:"#ffffff",stroke:"#3b82f6"},grid:{line:"#e5e7eb",dot:"#d1d5db"},connection:{line:"#64748b",arrow:"#64748b"}},spacing:{xs:4,sm:8,md:16,lg:24,xl:32},borderRadius:{sm:2,md:4,lg:8},fontSize:{xs:10,sm:12,md:14,lg:16,xl:20},strokeWidth:{thin:1,normal:2,thick:3},shadows:{sm:"0 1px 2px rgba(0,0,0,0.05)",md:"0 4px 6px rgba(0,0,0,0.1)",lg:"0 10px 15px rgba(0,0,0,0.1)",element:"0 2px 4px rgba(0,0,0,0.1)",handle:"0 1px 2px rgba(0,0,0,0.1)"}},ze={name:"dark",colors:{background:"#1e1e1e",surface:"#252526",border:"#3c3c3c",text:{primary:"#ffffff",secondary:"#a0a0a0",disabled:"#5a5a5a"},selection:{fill:"rgba(59, 130, 246, 0.2)",stroke:"#60a5fa"},element:{fill:"#2d2d2d",stroke:"#ffffff",hover:"#383838",active:"#454545"},handle:{fill:"#2d2d2d",stroke:"#60a5fa"},grid:{line:"#333333",dot:"#444444"},connection:{line:"#94a3b8",arrow:"#94a3b8"}},spacing:V.spacing,borderRadius:V.borderRadius,fontSize:V.fontSize,strokeWidth:V.strokeWidth,shadows:{sm:"0 1px 2px rgba(0,0,0,0.3)",md:"0 4px 6px rgba(0,0,0,0.4)",lg:"0 10px 15px rgba(0,0,0,0.5)",element:"0 2px 4px rgba(0,0,0,0.3)",handle:"0 1px 2px rgba(0,0,0,0.3)"}},Re=o.createContext({theme:V,themeName:"light"}),L=()=>{const e=o.useContext(Re);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e},Ne=({children:e,theme:t="light"})=>{const n=o.useMemo(()=>t==="light"?{theme:V,themeName:"light"}:t==="dark"?{theme:ze,themeName:"dark"}:{theme:ne(V,t),themeName:"custom"},[t]);return o.createElement(Re.Provider,{value:n},e)},gt=e=>({"--canvas-bg":e.colors.background,"--canvas-surface":e.colors.surface,"--canvas-border":e.colors.border,"--canvas-text-primary":e.colors.text.primary,"--canvas-text-secondary":e.colors.text.secondary,"--canvas-text-disabled":e.colors.text.disabled,"--canvas-selection-fill":e.colors.selection.fill,"--canvas-selection-stroke":e.colors.selection.stroke,"--canvas-element-fill":e.colors.element.fill,"--canvas-element-stroke":e.colors.element.stroke,"--canvas-element-hover":e.colors.element.hover,"--canvas-element-active":e.colors.element.active,"--canvas-handle-fill":e.colors.handle.fill,"--canvas-handle-stroke":e.colors.handle.stroke,"--canvas-grid-line":e.colors.grid.line,"--canvas-grid-dot":e.colors.grid.dot,"--canvas-connection-line":e.colors.connection.line,"--canvas-connection-arrow":e.colors.connection.arrow,"--canvas-spacing-xs":`${e.spacing.xs}px`,"--canvas-spacing-sm":`${e.spacing.sm}px`,"--canvas-spacing-md":`${e.spacing.md}px`,"--canvas-spacing-lg":`${e.spacing.lg}px`,"--canvas-spacing-xl":`${e.spacing.xl}px`,"--canvas-radius-sm":`${e.borderRadius.sm}px`,"--canvas-radius-md":`${e.borderRadius.md}px`,"--canvas-radius-lg":`${e.borderRadius.lg}px`,"--canvas-font-xs":`${e.fontSize.xs}px`,"--canvas-font-sm":`${e.fontSize.sm}px`,"--canvas-font-md":`${e.fontSize.md}px`,"--canvas-font-lg":`${e.fontSize.lg}px`,"--canvas-font-xl":`${e.fontSize.xl}px`,"--canvas-stroke-thin":`${e.strokeWidth.thin}px`,"--canvas-stroke-normal":`${e.strokeWidth.normal}px`,"--canvas-stroke-thick":`${e.strokeWidth.thick}px`,"--canvas-shadow-sm":e.shadows.sm,"--canvas-shadow-md":e.shadows.md,"--canvas-shadow-lg":e.shadows.lg,"--canvas-shadow-element":e.shadows.element,"--canvas-shadow-handle":e.shadows.handle}),Me={zoom:1,pan:{x:0,y:0},minZoom:.1,maxZoom:5},Et=(e,t)=>{switch(t.type){case"SET_ZOOM":{const n=Math.max(e.minZoom,Math.min(e.maxZoom,t.payload));return{...e,zoom:n}}case"ZOOM_IN":{const n=Math.min(e.maxZoom,e.zoom*1.2);return{...e,zoom:n}}case"ZOOM_OUT":{const n=Math.max(e.minZoom,e.zoom/1.2);return{...e,zoom:n}}case"ZOOM_TO_FIT":{const{bounds:n,padding:s=50}=t.payload,r=Math.max(e.minZoom,Math.min(e.maxZoom,1)),a={x:-(n.x-s),y:-(n.y-s)};return{...e,zoom:r,pan:a}}case"SET_PAN":return{...e,pan:t.payload};case"PAN_BY":return{...e,pan:{x:e.pan.x+t.payload.x,y:e.pan.y+t.payload.y}};case"RESET":return{...Me,minZoom:e.minZoom,maxZoom:e.maxZoom};case"SET_CONSTRAINTS":return{...e,minZoom:t.payload.minZoom??e.minZoom,maxZoom:t.payload.maxZoom??e.maxZoom};default:return e}},Oe=o.createContext(null),X=()=>{const e=o.useContext(Oe);if(!e)throw new Error("useViewport must be used within a ViewportProvider");return e},De=({children:e,initialViewport:t})=>{const[n,s]=o.useReducer(Et,{...Me,...t}),r=o.useCallback(l=>{s({type:"SET_ZOOM",payload:l})},[]),a=o.useCallback(()=>{s({type:"ZOOM_IN"})},[]),c=o.useCallback(()=>{s({type:"ZOOM_OUT"})},[]),i=o.useCallback((l,z)=>{s({type:"ZOOM_TO_FIT",payload:{bounds:l,padding:z}})},[]),d=o.useCallback(l=>{s({type:"SET_PAN",payload:l})},[]),m=o.useCallback(l=>{s({type:"PAN_BY",payload:l})},[]),u=o.useCallback(()=>{s({type:"RESET"})},[]),y=o.useCallback(l=>{s({type:"SET_CONSTRAINTS",payload:l})},[]),x=o.useCallback(l=>({x:(l.x-n.pan.x)/n.zoom,y:(l.y-n.pan.y)/n.zoom}),[n.zoom,n.pan]),f=o.useCallback(l=>({x:l.x*n.zoom+n.pan.x,y:l.y*n.zoom+n.pan.y}),[n.zoom,n.pan]),p=o.useMemo(()=>({viewport:n,setZoom:r,zoomIn:a,zoomOut:c,zoomToFit:i,setPan:d,panBy:m,resetViewport:u,setConstraints:y,screenToCanvas:x,canvasToScreen:f}),[n,r,a,c,i,d,m,u,y,x,f]);return o.createElement(Oe.Provider,{value:p},e)},xt={selectedIds:new Set,lastSelectedId:null},vt=(e,t)=>{switch(t.type){case"SELECT":return{selectedIds:new Set([t.payload]),lastSelectedId:t.payload};case"SELECT_MULTIPLE":return{selectedIds:new Set(t.payload),lastSelectedId:t.payload.length>0?t.payload[t.payload.length-1]:null};case"ADD_TO_SELECTION":{const n=new Set(e.selectedIds);return n.add(t.payload),{selectedIds:n,lastSelectedId:t.payload}}case"REMOVE_FROM_SELECTION":{const n=new Set(e.selectedIds);return n.delete(t.payload),{selectedIds:n,lastSelectedId:n.size>0?Array.from(n).pop():null}}case"TOGGLE_SELECTION":{const n=new Set(e.selectedIds);return n.has(t.payload)?(n.delete(t.payload),{selectedIds:n,lastSelectedId:n.size>0?Array.from(n).pop():null}):(n.add(t.payload),{selectedIds:n,lastSelectedId:t.payload})}case"CLEAR_SELECTION":return xt;case"SELECT_ALL":return{selectedIds:new Set(t.payload),lastSelectedId:t.payload.length>0?t.payload[t.payload.length-1]:null};default:return e}},_e=o.createContext(null),Y=()=>{const e=o.useContext(_e);if(!e)throw new Error("useSelection must be used within a SelectionProvider");return e},Le=({children:e,initialSelection:t,onSelectionChange:n})=>{const[s,r]=o.useReducer(vt,{selectedIds:new Set(t??[]),lastSelectedId:t?.[t.length-1]??null}),a=o.useMemo(()=>Array.from(s.selectedIds),[s.selectedIds]);o.useEffect(()=>{n?.(a)},[a,n]);const c=o.useCallback(l=>s.selectedIds.has(l),[s.selectedIds]),i=o.useCallback(l=>{r({type:"SELECT",payload:l})},[]),d=o.useCallback(l=>{r({type:"SELECT_MULTIPLE",payload:l})},[]),m=o.useCallback(l=>{r({type:"ADD_TO_SELECTION",payload:l})},[]),u=o.useCallback(l=>{r({type:"REMOVE_FROM_SELECTION",payload:l})},[]),y=o.useCallback(l=>{r({type:"TOGGLE_SELECTION",payload:l})},[]),x=o.useCallback(()=>{r({type:"CLEAR_SELECTION"})},[]),f=o.useCallback(l=>{r({type:"SELECT_ALL",payload:l})},[]),p=o.useMemo(()=>({selectedIds:a,lastSelectedId:s.lastSelectedId,selectionCount:s.selectedIds.size,hasSelection:s.selectedIds.size>0,isSelected:c,select:i,selectMultiple:d,addToSelection:m,removeFromSelection:u,toggleSelection:y,clearSelection:x,selectAll:f}),[a,s.lastSelectedId,s.selectedIds.size,c,i,d,m,u,y,x,f]);return o.createElement(_e.Provider,{value:p},e)},kt=(e,t)=>{switch(t.type){case"PUSH":{const n=[...e.past,e.present];return n.length>e.maxHistorySize&&n.shift(),{...e,past:n,present:t.payload,future:[]}}case"UNDO":{if(e.past.length===0)return e;const n=e.past[e.past.length-1],s=e.past.slice(0,-1);return{...e,past:s,present:n,future:[e.present,...e.future]}}case"REDO":{if(e.future.length===0)return e;const n=e.future[0],s=e.future.slice(1);return{...e,past:[...e.past,e.present],present:n,future:s}}case"CLEAR":return{...e,past:[],present:e.present,future:[]};case"SET_PRESENT":return{...e,present:t.payload};case"SET_MAX_SIZE":return{...e,maxHistorySize:t.payload};default:return e}},Ae=o.createContext(null),Pe=()=>{const e=o.useContext(Ae);if(!e)throw new Error("useHistory must be used within a HistoryProvider");return e},$e=({children:e,initialElements:t=[],initialConnections:n=[],maxHistorySize:s=50,onStateChange:r})=>{const[a,c]=o.useReducer(kt,{past:[],present:{elements:t,connections:n,timestamp:Date.now()},future:[],maxHistorySize:s});o.useEffect(()=>{r?.(a.present.elements,a.present.connections)},[a.present,r]);const i=o.useCallback((p,l)=>{c({type:"PUSH",payload:{elements:p,connections:l,timestamp:Date.now()}})},[]),d=o.useCallback(()=>{c({type:"UNDO"})},[]),m=o.useCallback(()=>{c({type:"REDO"})},[]),u=o.useCallback(()=>{c({type:"CLEAR"})},[]),y=o.useCallback((p,l)=>{c({type:"SET_PRESENT",payload:{elements:p,connections:l,timestamp:Date.now()}})},[]),x=o.useCallback(p=>{c({type:"SET_MAX_SIZE",payload:p})},[]),f=o.useMemo(()=>({canUndo:a.past.length>0,canRedo:a.future.length>0,historySize:a.past.length,futureSize:a.future.length,present:a.present,pushState:i,undo:d,redo:m,clearHistory:u,setPresent:y,setMaxHistorySize:x}),[a.past.length,a.future.length,a.present,i,d,m,u,y,x]);return o.createElement(Ae.Provider,{value:f},e)},wt={width:800,height:600,grid:{enabled:!1,size:20,snap:!1,visible:!1},readonly:!1},Ct=(e,t)=>{switch(t.type){case"ADD_ELEMENT":return{...e,elements:[...e.elements,t.payload]};case"ADD_ELEMENTS":return{...e,elements:[...e.elements,...t.payload]};case"UPDATE_ELEMENT":return{...e,elements:e.elements.map(n=>n.id===t.payload.id?{...n,...t.payload.updates}:n)};case"UPDATE_ELEMENTS":return{...e,elements:e.elements.map(n=>t.payload.ids.includes(n.id)?{...n,...t.payload.updates}:n)};case"REMOVE_ELEMENT":{const n=t.payload;return{...e,elements:e.elements.filter(s=>s.id!==n),connections:e.connections.filter(s=>s.fromId!==n&&s.toId!==n)}}case"REMOVE_ELEMENTS":{const n=new Set(t.payload);return{...e,elements:e.elements.filter(s=>!n.has(s.id)),connections:e.connections.filter(s=>!n.has(s.fromId)&&!n.has(s.toId))}}case"MOVE_ELEMENT":return{...e,elements:e.elements.map(n=>n.id===t.payload.id?{...n,x:t.payload.x,y:t.payload.y}:n)};case"MOVE_ELEMENTS":return{...e,elements:e.elements.map(n=>t.payload.ids.includes(n.id)?{...n,x:n.x+t.payload.deltaX,y:n.y+t.payload.deltaY}:n)};case"RESIZE_ELEMENT":return{...e,elements:e.elements.map(n=>n.id===t.payload.id?{...n,width:t.payload.width,height:t.payload.height,...t.payload.x!==void 0&&{x:t.payload.x},...t.payload.y!==void 0&&{y:t.payload.y}}:n)};case"BRING_TO_FRONT":return{...e,elements:be(e.elements,t.payload)};case"SEND_TO_BACK":return{...e,elements:Ie(e.elements,t.payload)};case"MOVE_UP":return{...e,elements:ct(e.elements,t.payload)};case"MOVE_DOWN":return{...e,elements:lt(e.elements,t.payload)};case"SET_ELEMENTS":return{...e,elements:t.payload};case"ADD_CONNECTION":return{...e,connections:[...e.connections,t.payload]};case"UPDATE_CONNECTION":return{...e,connections:e.connections.map(n=>n.id===t.payload.id?{...n,...t.payload.updates}:n)};case"REMOVE_CONNECTION":return{...e,connections:e.connections.filter(n=>n.id!==t.payload)};case"SET_CONNECTIONS":return{...e,connections:t.payload};case"UPDATE_CONFIG":return{...e,config:{...e.config,...t.payload}};case"CLEAR_CANVAS":return{...e,elements:[],connections:[]};case"LOAD_STATE":return{...e,elements:t.payload.elements,connections:t.payload.connections};default:return e}},Be=o.createContext(null),G=()=>{const e=o.useContext(Be);if(!e)throw new Error("useCanvas must be used within a CanvasProvider");return e},We=({children:e,initialElements:t=[],initialConnections:n=[],config:s,onChange:r})=>{const[a,c]=o.useReducer(Ct,{elements:t,connections:n,config:{...wt,...s}});o.useEffect(()=>{r?.(a.elements,a.connections)},[a.elements,a.connections,r]);const i=o.useCallback(E=>a.elements.find(b=>b.id===E),[a.elements]),d=o.useCallback(E=>a.elements.filter(b=>b.type===E),[a.elements]),m=o.useCallback(E=>{const b=E.id??H(),_=a.elements.length>0?Math.max(...a.elements.map(D=>D.zIndex)):0;return c({type:"ADD_ELEMENT",payload:{...E,id:b,zIndex:E.zIndex??_+1}}),b},[a.elements]),u=o.useCallback(E=>{const b=a.elements.length>0?Math.max(...a.elements.map(D=>D.zIndex)):0,_=E.map((D,F)=>({...D,id:D.id??H(),zIndex:D.zIndex??b+1+F}));return c({type:"ADD_ELEMENTS",payload:_}),_.map(D=>D.id)},[a.elements]),y=o.useCallback((E,b)=>{c({type:"UPDATE_ELEMENT",payload:{id:E,updates:b}})},[]),x=o.useCallback((E,b)=>{c({type:"UPDATE_ELEMENTS",payload:{ids:E,updates:b}})},[]),f=o.useCallback(E=>{c({type:"REMOVE_ELEMENT",payload:E})},[]),p=o.useCallback(E=>{c({type:"REMOVE_ELEMENTS",payload:E})},[]),l=o.useCallback((E,b,_)=>{c({type:"MOVE_ELEMENT",payload:{id:E,x:b,y:_}})},[]),z=o.useCallback((E,b,_)=>{c({type:"MOVE_ELEMENTS",payload:{ids:E,deltaX:b,deltaY:_}})},[]),v=o.useCallback((E,b,_,D,F)=>{c({type:"RESIZE_ELEMENT",payload:{id:E,width:b,height:_,x:D,y:F}})},[]),g=o.useCallback(E=>{c({type:"BRING_TO_FRONT",payload:E})},[]),S=o.useCallback(E=>{c({type:"SEND_TO_BACK",payload:E})},[]),C=o.useCallback(E=>{c({type:"MOVE_UP",payload:E})},[]),k=o.useCallback(E=>{c({type:"MOVE_DOWN",payload:E})},[]),h=o.useCallback(E=>{c({type:"SET_ELEMENTS",payload:E})},[]),T=o.useCallback(E=>a.connections.find(b=>b.id===E),[a.connections]),N=o.useCallback(E=>a.connections.filter(b=>b.fromId===E||b.toId===E),[a.connections]),M=o.useCallback(E=>{const b=E.id??H();return c({type:"ADD_CONNECTION",payload:{...E,id:b}}),b},[]),A=o.useCallback((E,b)=>{c({type:"UPDATE_CONNECTION",payload:{id:E,updates:b}})},[]),w=o.useCallback(E=>{c({type:"REMOVE_CONNECTION",payload:E})},[]),I=o.useCallback(E=>{c({type:"SET_CONNECTIONS",payload:E})},[]),R=o.useCallback(E=>{c({type:"UPDATE_CONFIG",payload:E})},[]),O=o.useCallback(()=>{c({type:"CLEAR_CANVAS"})},[]),Z=o.useCallback((E,b)=>{c({type:"LOAD_STATE",payload:{elements:E,connections:b}})},[]),Q=o.useMemo(()=>({elements:a.elements,connections:a.connections,config:a.config,getElementById:i,getElementsByType:d,addElement:m,addElements:u,updateElement:y,updateElements:x,removeElement:f,removeElements:p,moveElement:l,moveElements:z,resizeElement:v,bringToFront:g,sendToBack:S,moveUp:C,moveDown:k,setElements:h,getConnectionById:T,getConnectionsForElement:N,addConnection:M,updateConnection:A,removeConnection:w,setConnections:I,updateConfig:R,clearCanvas:O,loadState:Z}),[a.elements,a.connections,a.config,i,d,m,u,y,x,f,p,l,z,v,g,S,C,k,h,T,N,M,A,w,I,R,O,Z]);return o.createElement(Be.Provider,{value:Q},e)},Ze=({children:e,initialElements:t=[],initialConnections:n=[],config:s,theme:r="light",initialViewport:a,maxHistorySize:c=50,onElementsChange:i,onSelectionChange:d,elements:m,connections:u,selectedIds:y})=>{const x=m??t,f=u??n;return P.jsx(Ne,{theme:r,children:P.jsx(De,{initialViewport:a,children:P.jsx(Le,{initialSelection:y,onSelectionChange:d,children:P.jsx($e,{initialElements:x,initialConnections:f,maxHistorySize:c,children:P.jsx(We,{initialElements:x,initialConnections:f,config:s,onChange:i,children:e})})})})})},Ve=(e={})=>{const{onDragStart:t,onDrag:n,onDragEnd:s,disabled:r=!1,threshold:a=3}=e,[c,i]=o.useState({isDragging:!1,startPosition:null,currentPosition:null,delta:{x:0,y:0}}),d=o.useRef(null),m=o.useRef(!1),{screenToCanvas:u}=X(),y=o.useCallback(v=>{if("touches"in v){const g=v.touches[0]||v.changedTouches[0];return u({x:g.clientX,y:g.clientY})}return u({x:v.clientX,y:v.clientY})},[u]),x=o.useCallback(v=>{if(!d.current)return;const g=y(v),S={x:g.x-d.current.x,y:g.y-d.current.y};if(!m.current){if(Math.sqrt(S.x**2+S.y**2)<a)return;m.current=!0,t?.(d.current)}i({isDragging:!0,startPosition:d.current,currentPosition:g,delta:S}),n?.(g,S)},[y,a,t,n]),f=o.useCallback(v=>{if(!d.current)return;const g=y(v),S={x:g.x-d.current.x,y:g.y-d.current.y};m.current&&s?.(g,S),i({isDragging:!1,startPosition:null,currentPosition:null,delta:{x:0,y:0}}),d.current=null,m.current=!1,document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",f),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",f)},[y,x,s]),p=o.useCallback((v,g)=>{if(r)return;const S=u({x:v,y:g});d.current=S,m.current=!1,i({isDragging:!1,startPosition:S,currentPosition:S,delta:{x:0,y:0}}),document.addEventListener("mousemove",x),document.addEventListener("mouseup",f),document.addEventListener("touchmove",x,{passive:!1}),document.addEventListener("touchend",f)},[r,u,x,f]),l=o.useCallback(v=>{v.button===0&&(v.preventDefault(),v.stopPropagation(),p(v.clientX,v.clientY))},[p]),z=o.useCallback(v=>{if(v.touches.length!==1)return;const g=v.touches[0];p(g.clientX,g.clientY)},[p]);return{dragState:c,handlers:{onMouseDown:l,onTouchStart:z},isDragging:c.isDragging}},Ue=(e={})=>{const{onResizeStart:t,onResize:n,onResizeEnd:s,disabled:r=!1,minWidth:a=20,minHeight:c=20,maxWidth:i=1/0,maxHeight:d=1/0,maintainAspectRatio:m=!1,aspectRatio:u}=e,[y,x]=o.useState({isResizing:!1,handle:null,startBounds:null,currentBounds:null}),f=o.useRef(null),{screenToCanvas:p}=X(),l=o.useCallback(C=>{if("touches"in C){const k=C.touches[0]||C.changedTouches[0];return p({x:k.clientX,y:k.clientY})}return p({x:C.clientX,y:C.clientY})},[p]),z=o.useCallback(C=>{if(!f.current)return{x:0,y:0,width:0,height:0};const{position:k,bounds:h,handle:T}=f.current,N=C.x-k.x,M=C.y-k.y;let A=h.x,w=h.y,I=h.width,R=h.height;switch(T){case"nw":A=h.x+N,w=h.y+M,I=h.width-N,R=h.height-M;break;case"n":w=h.y+M,R=h.height-M;break;case"ne":w=h.y+M,I=h.width+N,R=h.height-M;break;case"e":I=h.width+N;break;case"se":I=h.width+N,R=h.height+M;break;case"s":R=h.height+M;break;case"sw":A=h.x+N,I=h.width-N,R=h.height+M;break;case"w":A=h.x+N,I=h.width-N;break}if(I<a&&(T.includes("w")&&(A=h.x+h.width-a),I=a),R<c&&(T.includes("n")&&(w=h.y+h.height-c),R=c),I>i&&(I=i),R>d&&(R=d),m&&f.current.aspectRatio){const O=f.current.aspectRatio;I/R>O?I=R*O:R=I/O}return{x:A,y:w,width:I,height:R}},[a,c,i,d,m]),v=o.useCallback(C=>{if(!f.current)return;const k=l(C),h=z(k);x(T=>({...T,currentBounds:h})),n?.(h)},[l,z,n]),g=o.useCallback(C=>{if(!f.current)return;const k=l(C),h=z(k);s?.(h),x({isResizing:!1,handle:null,startBounds:null,currentBounds:null}),f.current=null,document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",g),document.removeEventListener("touchmove",v),document.removeEventListener("touchend",g)},[l,z,v,s]),S=o.useCallback((C,k,h)=>{if(r)return;h.preventDefault(),h.stopPropagation();const T="touches"in h?h.touches[0].clientX:h.clientX,N="touches"in h?h.touches[0].clientY:h.clientY,M=p({x:T,y:N});f.current={position:M,bounds:k,handle:C,aspectRatio:u??k.width/k.height},x({isResizing:!0,handle:C,startBounds:k,currentBounds:k}),t?.(C),document.addEventListener("mousemove",v),document.addEventListener("mouseup",g),document.addEventListener("touchmove",v,{passive:!1}),document.addEventListener("touchend",g)},[r,p,u,t,v,g]);return{resizeState:y,startResize:S,isResizing:y.isResizing}},Fe=e=>{const{id:t,disabled:n=!1,onSelect:s}=e,{isSelected:r,select:a,addToSelection:c,removeFromSelection:i,toggleSelection:d,clearSelection:m}=Y(),u=r(t),y=o.useCallback(()=>{n||(a(t),s?.(!0))},[n,t,a,s]),x=o.useCallback(()=>{n||(i(t),s?.(!1))},[n,t,i,s]),f=o.useCallback(()=>{if(n)return;const l=!u;d(t),s?.(l)},[n,t,u,d,s]),p=o.useCallback(l=>{n||(l.stopPropagation(),l.ctrlKey||l.metaKey?(d(t),s?.(!u)):l.shiftKey?(c(t),s?.(!0)):(a(t),s?.(!0)))},[n,t,u,d,c,a,s]);return{isSelected:u,handlers:{onClick:p},select:y,deselect:x,toggle:f}},St=(e,t)=>{const n=e.key.toLowerCase()===t.key.toLowerCase();t.ctrl?e.ctrlKey:!e.ctrlKey||t.meta,t.meta?e.metaKey:!e.metaKey||t.ctrl;const s=t.shift?e.shiftKey:!e.shiftKey,r=t.alt?e.altKey:!e.altKey,a=t.ctrl||t.meta?!!(t.ctrl&&(e.ctrlKey||e.metaKey))||!!(t.meta&&e.metaKey):!e.ctrlKey&&!e.metaKey;return n&&a&&s&&r},je=(e={})=>{const{shortcuts:t=[],enabled:n=!0,targetRef:s}=e,r=o.useRef(t);r.current=t;const a=o.useCallback(c=>{if(n){for(const i of r.current)if(St(c,i)){i.preventDefault!==!1&&c.preventDefault(),i.action();return}}},[n]);o.useEffect(()=>{const c=s?.current??document;return c.addEventListener("keydown",a),()=>{c.removeEventListener("keydown",a)}},[a,s])},He=e=>{const t=[];e.undo&&t.push({key:"z",ctrl:!0,action:e.undo}),e.redo&&(t.push({key:"z",ctrl:!0,shift:!0,action:e.redo}),t.push({key:"y",ctrl:!0,action:e.redo})),e.delete&&(t.push({key:"Delete",action:e.delete}),t.push({key:"Backspace",action:e.delete})),e.selectAll&&t.push({key:"a",ctrl:!0,action:e.selectAll}),e.copy&&t.push({key:"c",ctrl:!0,action:e.copy}),e.paste&&t.push({key:"v",ctrl:!0,action:e.paste}),e.cut&&t.push({key:"x",ctrl:!0,action:e.cut}),e.escape&&t.push({key:"Escape",action:e.escape}),e.zoomIn&&(t.push({key:"+",ctrl:!0,action:e.zoomIn}),t.push({key:"=",ctrl:!0,action:e.zoomIn})),e.zoomOut&&t.push({key:"-",ctrl:!0,action:e.zoomOut}),e.resetZoom&&t.push({key:"0",ctrl:!0,action:e.resetZoom}),je({shortcuts:t})},Ke=()=>{const e=G(),t=Y(),n=Pe(),s=o.useRef(null),r=o.useCallback(()=>{n.pushState(e.elements,e.connections)},[n,e.elements,e.connections]),a=o.useCallback(g=>(r(),e.addElement(g)),[e,r]),c=o.useCallback((g,S)=>{r(),e.updateElement(g,S)},[e,r]),i=o.useCallback(g=>{r(),e.removeElement(g)},[e,r]),d=o.useCallback(()=>{t.selectedIds.length!==0&&(r(),e.removeElements(t.selectedIds),t.clearSelection())},[e,t,r]),m=o.useCallback((g,S)=>{t.selectedIds.length!==0&&(r(),e.moveElements(t.selectedIds,g,S))},[e,t,r]),u=o.useCallback(()=>{if(t.selectedIds.length===0)return[];r();const S=e.elements.filter(k=>t.selectedIds.includes(k.id)).map(k=>({...k,id:void 0,x:k.x+20,y:k.y+20})),C=e.addElements(S);return t.selectMultiple(C),C},[e,t,r]),y=o.useCallback(g=>(r(),e.addConnection(g)),[e,r]),x=o.useCallback(g=>{r(),e.removeConnection(g)},[e,r]),f=o.useCallback(()=>{if(t.selectedIds.length===0)return;const g=e.elements.filter(k=>t.selectedIds.includes(k.id)),S=new Set(t.selectedIds),C=e.connections.filter(k=>S.has(k.fromId)&&S.has(k.toId));s.current={elements:g,connections:C}},[e.elements,e.connections,t.selectedIds]),p=o.useCallback(()=>{f(),d()},[f,d]),l=o.useCallback(()=>{if(!s.current)return;r();const g=new Map,S=s.current.elements.map(k=>({...k,id:void 0,x:k.x+20,y:k.y+20})),C=e.addElements(S);s.current.elements.forEach((k,h)=>{g.set(k.id,C[h])}),s.current.connections.forEach(k=>{const h=g.get(k.fromId),T=g.get(k.toId);h&&T&&e.addConnection({...k,id:void 0,fromId:h,toId:T})}),t.selectMultiple(C)},[e,t,r]),z=o.useCallback(()=>{n.canUndo&&(n.undo(),e.loadState(n.present.elements,n.present.connections))},[n,e]),v=o.useCallback(()=>{n.canRedo&&(n.redo(),e.loadState(n.present.elements,n.present.connections))},[n,e]);return{addElement:a,updateElement:c,removeElement:i,removeSelected:d,moveSelected:m,duplicateSelected:u,addConnection:y,removeConnection:x,copy:f,cut:p,paste:l,hasCopied:s.current!==null,undo:z,redo:v,canUndo:n.canUndo,canRedo:n.canRedo}},te=8,se=o.forwardRef(({element:e,children:t,className:n,style:s,disabled:r=!1,showHandles:a=!0,onSelect:c,onDragStart:i,onDrag:d,onDragEnd:m,onResizeStart:u,onResize:y,onResizeEnd:x},f)=>{const{updateElement:p}=G(),{theme:l}=L(),z=e.locked||r,{isSelected:v,handlers:g}=Fe({id:e.id,disabled:z,onSelect:c}),{isDragging:S,handlers:C}=Ve({disabled:z||!v,onDragStart:()=>{i?.()},onDrag:(w,I)=>{const R=e.x+I.x,O=e.y+I.y;d?.(R,O)},onDragEnd:(w,I)=>{const R=e.x+I.x,O=e.y+I.y;p(e.id,{x:R,y:O}),m?.(R,O)}}),{isResizing:k,startResize:h}=Ue({disabled:z||!v,minWidth:e.minWidth??20,minHeight:e.minHeight??20,maxWidth:e.maxWidth,maxHeight:e.maxHeight,onResizeStart:()=>{u?.()},onResize:w=>{y?.(w.width,w.height,w.x,w.y)},onResizeEnd:w=>{p(e.id,{x:w.x,y:w.y,width:w.width,height:w.height}),x?.(w.width,w.height,w.x,w.y)}}),T=o.useMemo(()=>!v||!a||z?[]:Se({x:0,y:0,width:e.width,height:e.height},te),[v,a,z,e.width,e.height]),N=o.useCallback((w,I)=>{h(w,{x:e.x,y:e.y,width:e.width,height:e.height},I)},[h,e]),M=o.useCallback(w=>{g.onClick(w),v&&C.onMouseDown(w)},[g,C,v]),A={cursor:S?"grabbing":v?"grab":"pointer",opacity:e.visible===!1?.5:1,...s};return o.createElement("g",{ref:f,className:K("canvas-element",n,{"canvas-element--selected":v,"canvas-element--dragging":S,"canvas-element--resizing":k,"canvas-element--locked":e.locked}),transform:`translate(${e.x}, ${e.y})${e.rotation?` rotate(${e.rotation}, ${e.width/2}, ${e.height/2})`:""}`,style:A,onMouseDown:M,onTouchStart:C.onTouchStart,"data-element-id":e.id,"data-element-type":e.type},t,v&&o.createElement("rect",{className:"canvas-element__selection",x:-2,y:-2,width:e.width+4,height:e.height+4,fill:"none",stroke:l.colors.selection.stroke,strokeWidth:1,strokeDasharray:"4 2",pointerEvents:"none"}),T.map(w=>o.createElement("rect",{key:w.position,className:`canvas-element__handle canvas-element__handle--${w.position}`,x:w.x,y:w.y,width:te,height:te,fill:l.colors.handle.fill,stroke:l.colors.handle.stroke,strokeWidth:1,cursor:bt(w.position),onMouseDown:I=>N(w.position,I)})))});se.displayName="ElementBase";function bt(e){return{nw:"nwse-resize",n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize"}[e]}function W(e){const t=o.forwardRef((n,s)=>{const r=n,a=r.element,c=r.disabled,i=r.showHandles,d=r.onSelect,m=r.onDragStart,u=r.onDrag,y=r.onDragEnd,x=r.onResizeStart,f=r.onResize,p=r.onResizeEnd,l=r.className,z=r.style,{element:v,disabled:g,showHandles:S,onSelect:C,onDragStart:k,onDrag:h,onDragEnd:T,onResizeStart:N,onResize:M,onResizeEnd:A,className:w,style:I,...R}=r,[O,Z]=o.useState({isSelected:!1,isDragging:!1,isResizing:!1}),Q=o.useCallback(B=>{Z(j=>({...j,isSelected:B})),d?.(B)},[d]),E=o.useCallback(()=>{Z(B=>({...B,isDragging:!0})),m?.()},[m]),b=o.useCallback((B,j)=>{Z(ee=>({...ee,isDragging:!1})),y?.(B,j)},[y]),_=o.useCallback(()=>{Z(B=>({...B,isResizing:!0})),x?.()},[x]),D=o.useCallback((B,j,ee,Qe)=>{Z(et=>({...et,isResizing:!1})),p?.(B,j,ee,Qe)},[p]),F={element:a,...O};return P.jsx(se,{ref:s,element:a,disabled:c,showHandles:i,className:l,style:z,onSelect:Q,onDragStart:E,onDrag:u,onDragEnd:b,onResizeStart:_,onResize:f,onResizeEnd:D,children:P.jsx(e,{...F,...R})})});return t.displayName=`withElementBehavior(${e.displayName||e.name||"Component"})`,t}const It=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r}=e;return o.createElement("rect",{width:n,height:s,fill:r?.fill??t.colors.element.fill,stroke:r?.stroke??t.colors.element.stroke,strokeWidth:r?.strokeWidth??t.strokeWidth.normal,rx:r?.cornerRadius??0,ry:r?.cornerRadius??0,opacity:r?.opacity??1})},J=W(It);J.displayName="Rectangle";const Tt=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r}=e,a=n/2,c=s/2,i=n/2,d=s/2;return o.createElement("ellipse",{cx:a,cy:c,rx:i,ry:d,fill:r?.fill??t.colors.element.fill,stroke:r?.stroke??t.colors.element.stroke,strokeWidth:r?.strokeWidth??t.strokeWidth.normal,opacity:r?.opacity??1})},U=W(Tt);U.displayName="Ellipse";const Xe=U;Xe.displayName="Circle";const Ye=U;Ye.displayName="Oval";const zt=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r}=e,a=[`${n/2},0`,`${n},${s/2}`,`${n/2},${s}`,`0,${s/2}`].join(" ");return o.createElement("polygon",{points:a,fill:r?.fill??t.colors.element.fill,stroke:r?.stroke??t.colors.element.stroke,strokeWidth:r?.strokeWidth??t.strokeWidth.normal,opacity:r?.opacity??1})},oe=W(zt);oe.displayName="Diamond";const Rt=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r,text:a="",fontSize:c,fontFamily:i,fontWeight:d,textAlign:m}=e,u=()=>{switch(m){case"right":return"end";case"center":return"middle";default:return"start"}},y=()=>{switch(m){case"right":return n;case"center":return n/2;default:return 0}};return o.createElement("g",null,o.createElement("rect",{width:n,height:s,fill:"transparent"}),o.createElement("text",{x:y(),y:s/2,dominantBaseline:"central",textAnchor:u(),fill:r?.fill??t.colors.text.primary,fontSize:c??t.fontSize.md,fontFamily:i??"sans-serif",fontWeight:d??"normal",opacity:r?.opacity??1},a))},re=W(Rt);re.displayName="TextElement";const Nt=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r,points:a,lineType:c="solid"}=e,d=(a??[{x:0,y:0},{x:n,y:s}]).map((u,y)=>y===0?`M ${u.x} ${u.y}`:`L ${u.x} ${u.y}`).join(" "),m=()=>{switch(c){case"dashed":return"8 4";case"dotted":return"2 2";default:return}};return o.createElement("g",null,o.createElement("path",{d,fill:"none",stroke:"transparent",strokeWidth:10}),o.createElement("path",{d,fill:"none",stroke:r?.stroke??t.colors.element.stroke,strokeWidth:r?.strokeWidth??t.strokeWidth.normal,strokeDasharray:m(),strokeLinecap:"round",strokeLinejoin:"round",opacity:r?.opacity??1}))},ae=W(Nt);ae.displayName="Line";const Mt=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r,label:a}=e,c=Math.min(n,s)*.15,i=n/2,d=c*2+4,m=s*.6,u=d+(m-d)*.3,y=n*.4,x=n*.35,f=s-4,p=r?.stroke??t.colors.element.stroke,l=r?.strokeWidth??t.strokeWidth.normal;return o.createElement("g",null,o.createElement("rect",{width:n,height:s,fill:"transparent"}),o.createElement("circle",{cx:i,cy:c+2,r:c,fill:r?.fill??"none",stroke:p,strokeWidth:l}),o.createElement("line",{x1:i,y1:d,x2:i,y2:m,stroke:p,strokeWidth:l}),o.createElement("line",{x1:i-y,y1:u,x2:i+y,y2:u,stroke:p,strokeWidth:l}),o.createElement("line",{x1:i,y1:m,x2:i-x,y2:s*.85,stroke:p,strokeWidth:l}),o.createElement("line",{x1:i,y1:m,x2:i+x,y2:s*.85,stroke:p,strokeWidth:l}),a&&o.createElement("text",{x:i,y:f,textAnchor:"middle",dominantBaseline:"text-bottom",fill:r?.fill??t.colors.text.primary,fontSize:t.fontSize.sm,fontFamily:"sans-serif"},a))},ce=W(Mt);ce.displayName="Actor";const Ot=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r,label:a}=e,c=n/2,i=40,d=r?.stroke??t.colors.element.stroke,m=r?.strokeWidth??t.strokeWidth.normal;return o.createElement("g",null,o.createElement("rect",{x:0,y:0,width:n,height:i,fill:r?.fill??t.colors.element.fill,stroke:d,strokeWidth:m}),a&&o.createElement("text",{x:c,y:i/2,textAnchor:"middle",dominantBaseline:"central",fill:t.colors.text.primary,fontSize:t.fontSize.sm,fontFamily:"sans-serif"},a),o.createElement("line",{x1:c,y1:i,x2:c,y2:s,stroke:d,strokeWidth:m,strokeDasharray:"8 4"}))},le=W(Ot);le.displayName="Lifeline";const Dt=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r,label:a,messageType:c="sync"}=e,i=r?.stroke??t.colors.connection.line,d=r?.strokeWidth??t.strokeWidth.normal,m=10,u=s/2,y=()=>{switch(c){case"return":return"8 4";case"create":return"4 2";default:return}},x=()=>c==="async"?o.createElement("polyline",{points:`${n-m},${u-m/2} ${n},${u} ${n-m},${u+m/2}`,fill:"none",stroke:i,strokeWidth:d}):o.createElement("polygon",{points:`${n},${u} ${n-m},${u-m/2} ${n-m},${u+m/2}`,fill:i,stroke:i,strokeWidth:1});return o.createElement("g",null,o.createElement("rect",{width:n,height:s,fill:"transparent"}),o.createElement("line",{x1:0,y1:u,x2:n-(c==="async"?0:m/2),y2:u,stroke:i,strokeWidth:d,strokeDasharray:y()}),x(),a&&o.createElement("text",{x:n/2,y:u-8,textAnchor:"middle",dominantBaseline:"text-bottom",fill:t.colors.text.primary,fontSize:t.fontSize.sm,fontFamily:"sans-serif"},a))},ie=W(Dt);ie.displayName="Message";const _t=({element:e})=>{const{theme:t}=L(),{width:n,height:s,style:r}=e;return o.createElement("rect",{width:n||12,height:s,fill:r?.fill??t.colors.element.fill,stroke:r?.stroke??t.colors.element.stroke,strokeWidth:r?.strokeWidth??t.strokeWidth.normal})},de=W(_t);de.displayName="ActivationBar";const we={rectangle:J,ellipse:U,circle:U,diamond:oe,text:re,line:ae,actor:ce,lifeline:le,message:ie,activationBar:de,custom:J},ue=o.forwardRef(({width:e,height:t,className:n,style:s,showGrid:r,gridSize:a,onCanvasClick:c,onCanvasDoubleClick:i,children:d},m)=>{const{elements:u,config:y}=G(),{clearSelection:x}=Y(),{viewport:f}=X(),{theme:p}=L(),l=e??y.width,z=t??y.height,v=r??y.grid?.visible,g=a??y.grid?.size??20,S=o.useMemo(()=>q(u),[u]),C=o.useCallback(T=>{T.target===T.currentTarget&&(x(),c?.(T))},[x,c]),k=()=>{if(!v)return null;const T="canvas-grid-pattern";return o.createElement(o.Fragment,null,o.createElement("defs",null,o.createElement("pattern",{id:T,width:g,height:g,patternUnits:"userSpaceOnUse"},o.createElement("path",{d:`M ${g} 0 L 0 0 0 ${g}`,fill:"none",stroke:p.colors.grid.line,strokeWidth:.5}))),o.createElement("rect",{width:"100%",height:"100%",fill:`url(#${T})`}))},h=T=>{const N=we[T.type]??we.custom;return o.createElement(N,{key:T.id,element:T})};return o.createElement("svg",{ref:m,className:K("canvas-drawing",n),width:l,height:z,viewBox:`0 0 ${l} ${z}`,style:{backgroundColor:p.colors.background,cursor:"default",userSelect:"none",...s},onClick:C,onDoubleClick:i},o.createElement("g",{transform:`translate(${f.pan.x}, ${f.pan.y}) scale(${f.zoom})`},k(),S.map(h),d))});ue.displayName="DrawingCanvas";const Ge=o.forwardRef(({width:e,height:t,readonly:n=!1,showGrid:s,gridSize:r,enableKeyboardShortcuts:a=!0,className:c,style:i,children:d},m)=>{const u=o.useRef(null),y=G(),x=Y(),f=X(),p=Ke();return He(a?{undo:p.undo,redo:p.redo,delete:p.removeSelected,selectAll:()=>x.selectAll(y.elements.map(l=>l.id)),copy:p.copy,paste:p.paste,cut:p.cut,escape:x.clearSelection,zoomIn:f.zoomIn,zoomOut:f.zoomOut,resetZoom:f.resetViewport}:{}),o.useImperativeHandle(m,()=>({addElement:p.addElement,updateElement:p.updateElement,removeElement:p.removeElement,getElement:y.getElementById,getElementsByType:y.getElementsByType,select:x.select,selectMultiple:x.selectMultiple,clearSelection:x.clearSelection,getSelectedIds:()=>x.selectedIds,zoomIn:f.zoomIn,zoomOut:f.zoomOut,setZoom:f.setZoom,resetViewport:f.resetViewport,undo:p.undo,redo:p.redo,canUndo:p.canUndo,canRedo:p.canRedo,toJSON:()=>({elements:y.elements,connections:y.connections}),toSVG:()=>u.current?.outerHTML??""}),[y,x,f,p]),P.jsxs("div",{className:K("canvas-container",c,{"canvas-container--readonly":n}),style:{position:"relative",overflow:"hidden",...i},tabIndex:0,children:[P.jsx(ue,{ref:u,width:e,height:t,showGrid:s,gridSize:r}),d]})});Ge.displayName="CanvasInner";const Je=o.forwardRef(({elements:e,connections:t,selectedIds:n,defaultElements:s=[],defaultConnections:r=[],config:a,theme:c="light",initialViewport:i,maxHistorySize:d,onChange:m,onSelectionChange:u,...y},x)=>P.jsx(Ze,{initialElements:s,initialConnections:r,elements:e,connections:t,selectedIds:n,config:a,theme:c,initialViewport:i,maxHistorySize:d,onElementsChange:m,onSelectionChange:u,children:P.jsx(Ge,{...y,ref:x})}));Je.displayName="Canvas";const Ce={rectangle:{width:120,height:80},ellipse:{width:120,height:80},circle:{width:80,height:80},diamond:{width:100,height:100},text:{width:100,height:30},line:{width:100,height:2},actor:{width:60,height:100},lifeline:{width:100,height:300},message:{width:150,height:30},activationBar:{width:12,height:60},custom:{width:100,height:100}},$=(e,t={})=>{const n=Ce[e]??Ce.custom;return{id:t.id??H(),type:e,x:t.x??0,y:t.y??0,width:t.width??n.width,height:t.height??n.height,zIndex:t.zIndex??0,style:t.style,locked:t.locked??!1,visible:t.visible??!0,data:t.data}},me=(e={})=>$("rectangle",e),pe=(e={})=>$("ellipse",e),he=(e={})=>{const t=e.width??e.height??80;return $("circle",{...e,width:t,height:t})},ye=(e={})=>$("diamond",e),fe=(e={})=>{const{text:t,fontSize:n,fontFamily:s,fontWeight:r,textAlign:a,...c}=e;return{...$("text",c),type:"text",text:t??"",fontSize:n,fontFamily:s,fontWeight:r,textAlign:a}},ge=(e={})=>{const{points:t,lineType:n,...s}=e;return{...$("line",s),type:"line",points:t,lineType:n??"solid"}},Ee=(e={})=>{const{label:t,...n}=e;return{...$("actor",n),type:"actor",label:t}},xe=(e={})=>{const{label:t,...n}=e;return{...$("lifeline",n),type:"lifeline",label:t}},ve=(e={})=>{const{label:t,messageType:n,fromId:s,toId:r,...a}=e;return{...$("message",a),type:"message",label:t,messageType:n??"sync",fromId:s,toId:r}},ke=(e={})=>$("activationBar",e),qe=(e,t={})=>{switch(e){case"rectangle":return me(t);case"ellipse":return pe(t);case"circle":return he(t);case"diamond":return ye(t);case"text":return fe(t);case"line":return ge(t);case"actor":return Ee(t);case"lifeline":return xe(t);case"message":return ve(t);case"activationBar":return ke(t);default:return $(e,t)}},Lt={create:qe,rectangle:me,ellipse:pe,circle:he,diamond:ye,text:fe,line:ge,actor:Ee,lifeline:xe,message:ve,activationBar:ke};exports.ActivationBar=de;exports.Actor=ce;exports.Canvas=Je;exports.CanvasProvider=We;exports.Circle=Xe;exports.CombinedCanvasProvider=Ze;exports.Diamond=oe;exports.DrawingCanvas=ue;exports.ElementBase=se;exports.ElementFactory=Lt;exports.Ellipse=U;exports.HistoryProvider=$e;exports.Lifeline=le;exports.Line=ae;exports.Message=ie;exports.Oval=Ye;exports.Rectangle=J;exports.SelectionProvider=Le;exports.TextElement=re;exports.ThemeProvider=Ne;exports.ViewportProvider=De;exports.boundsIntersect=st;exports.bringToFront=be;exports.createActivationBar=ke;exports.createActor=Ee;exports.createCircle=he;exports.createDiamond=ye;exports.createElement=qe;exports.createEllipse=pe;exports.createLifeline=xe;exports.createLine=ge;exports.createMessage=ve;exports.createRectangle=me;exports.createText=fe;exports.cx=K;exports.darkTheme=ze;exports.deepMerge=ne;exports.deserializeFromJSON=pt;exports.distance=tt;exports.downloadAsFile=ft;exports.exportToSVG=ht;exports.generateId=H;exports.getResizeHandles=Se;exports.getThemeCSSVariables=gt;exports.isPointInBounds=nt;exports.lightTheme=V;exports.sendToBack=Ie;exports.serializeToJSON=mt;exports.snapToGrid=ot;exports.sortByZIndex=q;exports.useCanvas=G;exports.useCanvasActions=Ke;exports.useCanvasKeyboardShortcuts=He;exports.useDraggable=Ve;exports.useHistory=Pe;exports.useKeyboard=je;exports.useResizable=Ue;exports.useSelectable=Fe;exports.useSelection=Y;exports.useTheme=L;exports.useViewport=X;exports.validateCanvasData=Te;exports.withElementBehavior=W;
//# sourceMappingURL=index.cjs.map
